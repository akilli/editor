class e{constructor(e,t){if(!(e instanceof j&&t&&"string"==typeof t))throw"Invalid argument";this.editor=e,this.name=t}}class t extends e{constructor(e,t){super(e,t),this.element=this.editor.elements.get(this.name)||null,this.dialog=this.editor.dialogs.get(this.name)||null}execute(){this.dialog?this.dialog.open(e=>this.insert(e),this.oldData()):this.insert()}insert(e={}){this.element&&this.element.insert(e)}oldData(){const e={},t=this.editor.getSelectedElement();return t instanceof HTMLElement&&t.tagName.toLowerCase()===this.element.name&&Array.from(t.attributes).forEach(t=>e[t.nodeName]=t.nodeValue),e}}class n extends e{convert(e){throw"Not implemented"}}class i extends e{open(e,t={}){this.editor.document.querySelectorAll("dialog.editor-dialog").forEach(e=>e.parentElement.removeChild(e));const n=this.editor.window.getSelection(),i=n.rangeCount>0?n.getRangeAt(0):null,r=this.editor.createElement("dialog",{class:"editor-dialog"}),a=this.editor.createElement("form"),o=this.editor.createElement("fieldset"),s=this.editor.createElement("button",{type:"button","data-action":"cancel"},this.editor.t("Cancel")),l=this.editor.createElement("button",{"data-action":"save"},this.editor.t("Save")),d=()=>{i&&(n.removeAllRanges(),n.addRange(i)),r.parentElement.removeChild(r)};r.appendChild(a),r.addEventListener("click",e=>{e.target===r&&d()}),"boolean"!=typeof r.open&&this.polyfill(r),r.open=!0,o.insertAdjacentHTML("beforeend",this.getFieldsetHtml()),Object.getOwnPropertyNames(t).forEach(e=>{o.elements[e]&&(o.elements[e].value=t[e])}),a.appendChild(o),a.addEventListener("submit",t=>{t.preventDefault(),d();const n={};Array.from(o.elements).forEach(e=>n[e.name]=e.value),e(n)}),s.addEventListener("click",d),a.appendChild(s),a.appendChild(l),this.editor.element.appendChild(r)}getFieldsetHtml(){throw"Not implemented"}polyfill(e){Object.defineProperty(e,"open",{get:function(){return this.hasAttribute("open")},set:function(e){e?this.setAttribute("open",""):this.removeAttribute("open")}})}}class r extends e{constructor(e,t,n){if(super(e,t),!n||"string"!=typeof n)throw"Invalid argument";this.tagName=n}create(e={}){return this.editor.createElement(this.tagName,e)}insert(e={}){this.editor.insert(this.create(e))}}class a extends e{filter(e,t=!1){throw"Not implemented"}}class o extends e{observe(e){throw"Not implemented"}}class s extends e{constructor(e,t,n,{attributes:i=[],children:r=[],editable:a=!1,empty:o=!1,enter:s=null}={}){if(super(e,t),!n||"string"!=typeof n)throw"Invalid argument";this.group=n,this.children=Array.isArray(r)?r:[],this.attributes=Array.isArray(i)?i:[],this.editable=Boolean(a),this.empty=Boolean(o),this.enter=s&&"string"==typeof s?s:null}}class l extends t{constructor(e){super(e,"link")}insert({href:e=null}={}){const t=this.editor.getSelectedElement(),n=t instanceof HTMLAnchorElement?t:null;e&&n?n.setAttribute("href",e):e?this.element.insert({href:e}):n&&n.parentElement.replaceChild(this.editor.createText(n.textContent),n)}}const d=[e=>new t(e,"bold"),e=>new t(e,"italic"),e=>new t(e,"definition"),e=>new t(e,"quote"),e=>new t(e,"cite"),e=>new t(e,"mark"),e=>new t(e,"keyboard"),e=>new l(e),e=>new t(e,"paragraph"),e=>new t(e,"heading"),e=>new t(e,"subheading"),e=>new t(e,"unorderedlist"),e=>new t(e,"orderedlist"),e=>new t(e,"blockquote"),e=>new t(e,"image"),e=>new t(e,"video"),e=>new t(e,"audio"),e=>new t(e,"iframe"),e=>new t(e,"table"),e=>new t(e,"details")];class c extends n{constructor(e,t,n){if(super(e,t),!n||"string"!=typeof n)throw"Invalid argument";this.target=n}convert(e){const t=this.editor.createElement(this.target);return t.innerHTML=e.innerHTML,t}}class h extends n{convert(e){return this.editor.createText(e.textContent)}}const m=[e=>new h(e,"abbr"),e=>new c(e,"b","strong"),e=>new h(e,"code"),e=>new h(e,"data"),e=>new c(e,"div","p"),e=>new c(e,"em","i"),e=>new h(e,"ins"),e=>new h(e,"samp"),e=>new h(e,"small"),e=>new h(e,"span"),e=>new h(e,"time"),e=>new h(e,"u"),e=>new c(e,"var","i")];class f extends i{getFieldsetHtml(){return`\n            <legend>${this.editor.t("Audio")}</legend>\n            <div data-attr="src">\n                <label for="editor-src">${this.editor.t("URL")}</label>\n                <input id="editor-src" name="src" type="text" pattern="(https?|/).+" placeholder="${this.editor.t("Insert URL to media element")}" />\n            </div>\n            <div data-attr="width">\n                <label for="editor-width">${this.editor.t("Width")}</label>\n                <input id="editor-width" name="width" type="number" />\n            </div>\n            <div data-attr="height">\n                <label for="editor-height">${this.editor.t("Height")}</label>\n                <input id="editor-height" name="height" type="number" />\n            </div>\n        `}}class u extends i{constructor(e,t){if(super(e,t),!this.editor.config[this.name]||!this.editor.config[this.name].browser)throw"Invalid argument";this.url=this.editor.config[this.name].browser,this.opts=Object.assign({alwaysRaised:"yes",dependent:"yes",height:`${this.editor.window.screen.height}`,location:"no",menubar:"no",minimizable:"no",modal:"yes",resizable:"yes",scrollbars:"yes",toolbar:"no",width:`${this.editor.window.screen.width}`},this.editor.config.browser||{})}open(e,t={}){const n=Object.entries(this.opts).map(e=>`${e[0]}=${e[1]}`).join(","),i=this.editor.window.open(this.url,this.name,n),r=this.editor.createElement("a",{href:this.url});this.editor.window.addEventListener("message",t=>{t.origin===r.origin&&t.source===i&&(e(t.data),i.close())},!1)}}class g extends i{getFieldsetHtml(){return`\n            <legend>${this.editor.t("Iframe")}</legend>\n            <div data-attr="src">\n                <label for="editor-src">${this.editor.t("URL")}</label>\n                <input id="editor-src" name="src" type="text" pattern="(https?|/).+" placeholder="${this.editor.t("Insert URL to media element")}" />\n            </div>\n            <div data-attr="width">\n                <label for="editor-width">${this.editor.t("Width")}</label>\n                <input id="editor-width" name="width" type="number" />\n            </div>\n            <div data-attr="height">\n                <label for="editor-height">${this.editor.t("Height")}</label>\n                <input id="editor-height" name="height" type="number" />\n            </div>\n        `}}class p extends i{getFieldsetHtml(){return`\n            <legend>${this.editor.t("Image")}</legend>\n            <div data-attr="src">\n                <label for="editor-src">${this.editor.t("URL")}</label>\n                <input id="editor-src" name="src" type="text" pattern="(https?|/).+" placeholder="${this.editor.t("Insert URL to media element")}" />\n            </div>\n            <div data-attr="alt">\n                <label for="editor-alt">${this.editor.t("Alternative text")}</label>\n                <input id="editor-alt" name="alt" type="text" placeholder="${this.editor.t("Replacement text for use when media elements are not available")}" />\n            </div>\n            <div data-attr="width">\n                <label for="editor-width">${this.editor.t("Width")}</label>\n                <input id="editor-width" name="width" type="number" />\n            </div>\n            <div data-attr="height">\n                <label for="editor-height">${this.editor.t("Height")}</label>\n                <input id="editor-height" name="height" type="number" />\n            </div>\n        `}}class w extends i{getFieldsetHtml(){return`\n            <legend>${this.editor.t("Table")}</legend>\n            <div data-attr="rows" data-required>\n                <label for="editor-rows">${this.editor.t("Rows")}</label>\n                <input id="editor-rows" name="rows" type="number" value="1" required="required" min="1" />\n            </div>\n            <div data-attr="cols" data-required>\n                <label for="editor-cols">${this.editor.t("Columns")}</label>\n                <input id="editor-cols" name="cols" type="number" value="1" required="required" min="1" />\n            </div>\n        `}}class b extends i{getFieldsetHtml(){return`\n            <legend>${this.editor.t("Video")}</legend>\n            <div data-attr="src">\n                <label for="editor-src">${this.editor.t("URL")}</label>\n                <input id="editor-src" name="src" type="text" pattern="(https?|/).+" placeholder="${this.editor.t("Insert URL to media element")}" />\n            </div>\n            <div data-attr="width">\n                <label for="editor-width">${this.editor.t("Width")}</label>\n                <input id="editor-width" name="width" type="number" />\n            </div>\n            <div data-attr="height">\n                <label for="editor-height">${this.editor.t("Height")}</label>\n                <input id="editor-height" name="height" type="number" />\n            </div>\n        `}}const E=[e=>e.config.audio.browser?new u(e,"audio"):new f(e,"audio"),e=>e.config.iframe.browser?new u(e,"iframe"):new g(e,"iframe"),e=>e.config.image.browser?new u(e,"image"):new p(e,"image"),e=>new w(e,"table"),e=>e.config.video.browser?new u(e,"video"):new b(e,"video")];class v extends r{constructor(e){super(e,"blockquote","blockquote")}create({caption:e=""}={}){const t=this.editor.createElement("figure",{class:"quote"}),n=this.editor.createElement("blockquote"),i=this.editor.createElement("figcaption");return n.appendChild(this.editor.createElement("p")),t.appendChild(n),i.innerHTML=e,t.appendChild(i),t}}class y extends r{constructor(e){super(e,"details","details")}create(e={}){const t=this.editor.createElement("details");return t.appendChild(this.editor.createElement("summary")),t.appendChild(this.editor.createElement("p")),t}}class T extends r{create(e={}){const t=this.editor.createElement(this.tagName);return t.appendChild(this.editor.createElement("li")),t}}const L={audio:{controls:"controls"},iframe:{allowfullscreen:"allowfullscreen"},video:{controls:"controls"}};class x extends r{create({caption:e="",...t}={}){if(!t.src)throw"No media element";const n=this.editor.createElement("a",{href:t.src});t.src=n.origin===this.editor.origin?n.pathname:n.href,Object.assign(t,L[this.tagName]||{});const i=this.editor.createElement("figure",{class:this.name}),r=this.editor.createElement(this.tagName,t),a=this.editor.createElement("figcaption");return i.appendChild(r),a.innerHTML=e,i.appendChild(a),i}}class C extends r{constructor(e){super(e,"table","table")}create({rows:e=1,cols:t=1,caption:n=""}={}){if(e<=0||t<=0)throw"Invalid argument";const i=this.editor.createElement("figure",{class:"table"}),r=this.editor.createElement("table"),a=this.editor.createElement("figcaption");return i.appendChild(r),a.innerHTML=n,i.appendChild(a),["thead","tbody","tfoot"].forEach(n=>{const i=this.editor.createElement(n),a="thead"===n?"th":"td",o="tbody"===n?e:1;let s;r.appendChild(i);for(let e=0;e<o;e++){s=this.editor.createElement("tr"),i.appendChild(s);for(let e=0;e<t;++e)s.appendChild(this.editor.createElement(a))}}),i}}const H=[e=>new r(e,"bold","strong"),e=>new r(e,"italic","i"),e=>new r(e,"definition","dfn"),e=>new r(e,"quote","q"),e=>new r(e,"cite","cite"),e=>new r(e,"mark","mark"),e=>new r(e,"keyboard","kbd"),e=>new r(e,"link","a"),e=>new r(e,"paragraph","p"),e=>new r(e,"heading","h2"),e=>new r(e,"subheading","h3"),e=>new T(e,"subheading","ul"),e=>new T(e,"orderedlist","ol"),e=>new v(e),e=>new x(e,"image","img"),e=>new x(e,"video","video"),e=>new x(e,"audio","audio"),e=>new x(e,"iframe","iframe"),e=>new C(e),e=>new y(e)];class N extends a{filter(e,t=!1){e.querySelectorAll(":scope > br ").forEach(t=>{(e.firstChild.isSameNode(t)||t.previousSibling instanceof HTMLBRElement||e.lastChild.isSameNode(t))&&e.removeChild(t)}),e.lastChild instanceof HTMLBRElement&&e.removeChild(e.lastChild)}}class M extends a{filter(e,t=!1){const n=t||this.editor.content.isSameNode(e),i=t?"root":this.editor.getTagName(e);e.normalize(),Array.from(e.childNodes).forEach(t=>{if(t instanceof HTMLElement&&(t=this.editor.convert(t)),t instanceof HTMLElement){const r=t.tagName,a=this.editor.getTag(r),o=t.textContent.trim();if(a)if(this.editor.allowed(r,i)||n&&"text"===a.group)if(Array.from(t.attributes).forEach(e=>{a.attributes.includes(e.name)||t.removeAttribute(e.name)}),t.hasChildNodes()&&this.editor.filter(t),t.hasChildNodes()||a.empty||t instanceof HTMLTableCellElement){if(n&&"text"===a.group){const n=this.editor.createElement("p");n.innerHTML=t.outerHTML,e.replaceChild(n,t)}}else e.removeChild(t);else n&&o?e.replaceChild(this.editor.createElement("p",{},o),t):o?e.replaceChild(this.editor.createText(o),t):e.removeChild(t);else e.removeChild(t)}else t instanceof Text?n&&t.textContent.trim()?e.replaceChild(this.editor.createElement("p",{},t.textContent.trim()),t):n&&e.removeChild(t):e.removeChild(t)})}}class A extends a{filter(e,t=!1){e.querySelectorAll("figure > figcaption:only-child").forEach(e=>e.parentElement.removeChild(e))}}class k extends a{filter(e,t=!1){if(e instanceof HTMLTableRowElement&&!e.querySelector("th:not(:empty), td:not(:empty)")||e instanceof HTMLTableElement&&e.querySelector("thead, tfoot")&&!e.querySelector("tbody"))for(;e.firstChild;)e.removeChild(e.firstChild)}}const S=[e=>new M(e,"content"),e=>new N(e,"break"),e=>new A(e,"figure"),e=>new k(e,"table")];class R extends o{observe(e){e.forEach(e=>e.addedNodes.forEach(e=>{e instanceof HTMLDetailsElement?this.initDetails(e):e instanceof HTMLElement&&"summary"===e.tagName.toLowerCase()?this.initSummary(e):e instanceof HTMLElement&&e.querySelectorAll("details").forEach(e=>this.initDetails(e))}))}initDetails(e){let t=e.firstElementChild;if(t instanceof HTMLElement&&"summary"===t.tagName.toLowerCase())this.initSummary(t),1===e.childElementCount&&e.appendChild(this.editor.createElement("p"));else if(t instanceof HTMLElement){const n=this.editor.createElement("summary");e.insertBefore(n,t),this.initSummary(n)}}initSummary(e){const t=()=>{e.textContent.trim()||(e.textContent=this.editor.t("Details"))};t(),e.addEventListener("blur",t),e.addEventListener("keydown",e=>{" "===e.key&&(e.preventDefault(),e.cancelBubble=!0)}),e.addEventListener("keyup",e=>{" "===e.key&&(e.preventDefault(),e.cancelBubble=!0,this.editor.insertText(" "))})}}class D extends o{constructor(e,t){super(e,t),this.editables=[...this.editor.tags].reduce((e,t)=>(t[1].editable&&e.push(t[1].name),e),[])}observe(e){e.forEach(e=>e.addedNodes.forEach(e=>{e instanceof HTMLElement&&this.editables.includes(e.tagName.toLowerCase())?this.toEditable(e):e instanceof HTMLElement&&e.querySelectorAll(this.editables.join(", ")).forEach(e=>this.toEditable(e))}))}toEditable(e){e.contentEditable="true",e.focus(),e.addEventListener("keydown",e=>{this.onKeydownEnter(e),this.onKeydownBackspace(e)}),e.addEventListener("keyup",e=>this.onKeyupEnter(e))}onKeydownEnter(e){"Enter"!==e.key||e.shiftKey&&this.editor.allowed("br",e.target.tagName)||(e.preventDefault(),e.cancelBubble=!0)}onKeyupEnter(e){let t;if("Enter"===e.key&&!e.shiftKey&&(t=this.editor.getTag(e.target.tagName))&&t.enter){let n,i=e.target;e.preventDefault(),e.cancelBubble=!0;do{if(n=this.editor.getTagName(i.parentElement),this.editor.allowed(t.enter,n)){i.insertAdjacentElement("afterend",this.editor.createElement(t.enter));break}}while((i=i.parentElement)&&this.editor.content.contains(i)&&!this.editor.content.isSameNode(i))}}onKeydownBackspace(e){const t=this.editor.getSelectedWidget(),n=["blockquote","details","ol","ul"].includes(e.target.parentElement.tagName.toLowerCase())&&("summary"!==e.target.tagName.toLowerCase()||e.target.matches(":only-child"));if("Backspace"===e.key&&!e.shiftKey&&!e.target.textContent&&t&&(t.isSameNode(e.target)||n)){const n=t.isSameNode(e.target)||e.target.matches(":only-child")?t:e.target;n.previousElementSibling&&this.editor.focusEnd(n.previousElementSibling),n.parentElement.removeChild(n),e.preventDefault(),e.cancelBubble=!0}}}class q extends o{observe(e){e.forEach(e=>e.addedNodes.forEach(e=>{e instanceof HTMLElement&&"figure"===e.tagName.toLowerCase()&&!e.querySelector(":scope > figcaption")&&e.appendChild(this.editor.createElement("figcaption"))}))}}class I extends o{observe(e){e.forEach(e=>e.addedNodes.forEach(e=>{e instanceof HTMLTableElement?this.initTable(e):e instanceof HTMLElement&&e.querySelectorAll("table").forEach(e=>this.initTable(e))}))}initTable(e){this.sections(e),this.keyboard(e)}sections(e){if(e.tBodies.length>0&&e.tBodies[0].rows[0]&&(!e.tHead||!e.tFoot)){const t=e.tBodies[0].rows[0].cells.length;let n;if(!e.tHead){n=e.createTHead().insertRow();for(let e=0;e<t;e++)n.appendChild(this.editor.createElement("th"))}if(!e.tFoot){n=e.createTFoot().insertRow();for(let e=0;e<t;e++)n.insertCell()}}}keyboard(e){e.addEventListener("keydown",t=>{const n=t.target,i=n.parentElement,r=i.parentElement;if(n instanceof HTMLTableCellElement&&i instanceof HTMLTableRowElement&&(r instanceof HTMLTableElement||r instanceof HTMLTableSectionElement)&&(t.altKey||t.ctrlKey)&&["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(t.key)){const a=i.cells.length,o=r.rows.length,s=r instanceof HTMLTableElement?i.rowIndex:i.sectionRowIndex;let l;if(t.altKey&&("ArrowLeft"===t.key&&n.cellIndex>0||"ArrowRight"===t.key&&n.cellIndex<a-1))l=n.cellIndex+("ArrowLeft"===t.key?-1:1),Array.from(e.rows).forEach(e=>e.deleteCell(l));else if(t.altKey&&("ArrowUp"===t.key&&s>0||"ArrowDown"===t.key&&s<o-1))l=s+("ArrowUp"===t.key?-1:1),r.deleteRow(l);else if(!t.ctrlKey||"ArrowLeft"!==t.key&&"ArrowRight"!==t.key){if(t.ctrlKey&&("ArrowUp"===t.key||"ArrowDown"===t.key)){l=s+("ArrowUp"===t.key?0:1);const e=r.insertRow(l);for(let t=0;t<a;t++)e.insertCell()}}else l=n.cellIndex+("ArrowLeft"===t.key?0:1),Array.from(e.rows).forEach(e=>{e.querySelector(":scope > td")?e.insertCell(l):e.insertBefore(this.editor.createElement("th"),e.cells[l])});t.preventDefault(),t.cancelBubble=!0}})}}class $ extends o{observe(e){e.forEach(e=>e.addedNodes.forEach(e=>{e instanceof HTMLElement&&e.parentElement instanceof HTMLElement&&e.parentElement.isSameNode(this.editor.content)&&(e.tabIndex=0,this.keyboard(e),this.dragndrop(e))}))}keyboard(e){e.addEventListener("keyup",t=>{this.editor.document.activeElement.isSameNode(e)&&("Delete"!==t.key||e.isContentEditable?e.draggable&&"ArrowUp"===t.key&&e.previousElementSibling?(e.previousElementSibling.insertAdjacentHTML("beforebegin",e.outerHTML),e.parentElement.removeChild(e),t.preventDefault(),t.cancelBubble=!0):e.draggable&&"ArrowDown"===t.key&&e.nextElementSibling&&(e.nextElementSibling.insertAdjacentHTML("afterend",e.outerHTML),e.parentElement.removeChild(e),t.preventDefault(),t.cancelBubble=!0):(e.parentElement.removeChild(e),t.preventDefault(),t.cancelBubble=!0))})}dragndrop(e){const t="text/x-editor-name",n=()=>{const t=e.hasAttribute("draggable");this.editor.content.querySelectorAll("[draggable]").forEach(e=>{e.removeAttribute("draggable"),e.hasAttribute("contenteditable")&&e.setAttribute("contenteditable","true")}),t||(e.setAttribute("draggable","true"),e.hasAttribute("contenteditable")&&e.setAttribute("contenteditable","false"))},i=n=>{const i=n.dataTransfer.getData(t);i&&this.editor.allowed(i,"root")&&(n.preventDefault(),e.setAttribute("data-dragover",""),n.dataTransfer.dropEffect="move")};e.addEventListener("dblclick",n),e.addEventListener("dragstart",n=>{n.dataTransfer.effectAllowed="move",n.dataTransfer.setData(t,e.tagName.toLowerCase()),n.dataTransfer.setData("text/x-editor-html",e.outerHTML)}),e.addEventListener("dragend",t=>{"move"===t.dataTransfer.dropEffect&&e.parentElement.removeChild(e),n()}),e.addEventListener("dragenter",i),e.addEventListener("dragover",i),e.addEventListener("dragleave",()=>e.removeAttribute("data-dragover")),e.addEventListener("drop",n=>{const i=n.dataTransfer.getData(t),r=n.dataTransfer.getData("text/x-editor-html");n.preventDefault(),e.removeAttribute("data-dragover"),i&&this.editor.allowed(i,"root")&&r&&e.insertAdjacentHTML("beforebegin",r)})}}const B=[e=>new D(e,"editable"),e=>new R(e,"details"),e=>new q(e,"figure"),e=>new I(e,"table"),e=>new $(e,"widget")],U=[e=>new s(e,"root","root",{children:["details","figure","heading","list","p"]}),e=>new s(e,"p","p",{children:["br","text"],editable:!0,enter:"p"}),e=>new s(e,"h2","heading",{editable:!0,enter:"p"}),e=>new s(e,"h3","heading",{editable:!0,enter:"p"}),e=>new s(e,"ul","list",{children:["li"]}),e=>new s(e,"ol","list",{children:["li"]}),e=>new s(e,"li","li",{children:["br","text"],editable:!0,enter:"li"}),e=>new s(e,"figure","figure",{attributes:["class"],children:["blockquote","figcaption","media","table"]}),e=>new s(e,"figcaption","figcaption",{children:["text"],editable:!0,enter:"p"}),e=>new s(e,"blockquote","blockquote",{children:["p"]}),e=>new s(e,"img","media",{attributes:["alt","height","src","width"],empty:!0}),e=>new s(e,"video","media",{attributes:["controls","height","src","width"],empty:!0}),e=>new s(e,"audio","media",{attributes:["controls","height","src","width"],empty:!0}),e=>new s(e,"iframe","media",{attributes:["allowfullscreen","height","src","width"],empty:!0}),e=>new s(e,"table","table",{children:["tablesection"]}),e=>new s(e,"thead","tablesection",{children:["tr"]}),e=>new s(e,"tbody","tablesection",{children:["tr"]}),e=>new s(e,"tfoot","tablesection",{children:["tr"]}),e=>new s(e,"tr","tr",{children:["tablecell"]}),e=>new s(e,"th","tablecell",{children:["br","text"],editable:!0}),e=>new s(e,"td","tablecell",{children:["br","text"],editable:!0}),e=>new s(e,"details","details",{children:["figure","list","p","summary"]}),e=>new s(e,"summary","summary",{editable:!0,enter:"p"}),e=>new s(e,"strong","text"),e=>new s(e,"i","text"),e=>new s(e,"dfn","text"),e=>new s(e,"kbd","text"),e=>new s(e,"mark","text"),e=>new s(e,"q","text"),e=>new s(e,"cite","text"),e=>new s(e,"a","text",{attributes:["href"]}),e=>new s(e,"br","br",{empty:!0})],K={de:{"Alternative text":"Alternativtext",Audio:"Audio",Cancel:"Abbrechen",Columns:"Spalten",Details:"Details","Element is not allowed here":"Element ist hier nicht erlaubt",Height:"Höhe",Ifrane:"Iframe",Image:"Bild","Insert URL to add a link or leave empty to unlink":"URL eingeben um zu verlinken oder leer lassen um Link zu entfernen","Insert URL to media element":"URL zum Medienelement eingeben","Invalid argument":"Ungültiges Argument",Link:"Link","No element name":"Kein Elementname","No HTML element":"Kein HTML-Element","No media element":"Kein Medienelement","Not implemented":"Nicht implementiert","Replacement text for use when media elements are not available":"Ersatztext, falls Medienelemente nicht verfügbar sind",Rows:"Zeilen",Save:"Speichern",Table:"Tabelle",URL:"URL",Video:"Video",Width:"Breite"}};class j{constructor(e,l={}){if(!(e instanceof HTMLElement))throw"No HTML element";this.orig=e,this.document=this.orig.ownerDocument,this.window=this.document.defaultView,this.origin=this.window.origin||this.window.location.origin,this.element=this.createElement("div",{class:"editor"}),this.content=this.createElement("div",{class:"editor-content"}),this.toolbar=this.createElement("div",{class:"editor-toolbar"}),this.orig.hidden=!0,this.orig.insertAdjacentElement("afterend",this.element),this.element.appendChild(this.toolbar),this.element.appendChild(this.content),this.config=l,this.i18n=K[this.config.lang]||{},this.tags=this.configMap(U,s),this.elements=this.configMap(H,r),this.converters=this.configMap(m,n),this.dialogs=this.configMap(E,i),this.commands=this.configMap(d,t),this.observers=this.configMap(B,o),this.filters=this.configMap(S,a)}configMap(t,n){if(!Array.isArray(t))throw"Invalid argument";const i=new Map;return t.forEach(t=>{if(!("function"==typeof t&&(t=t(this))&&t instanceof n&&t instanceof e))throw"Invalid argument";i.set(t.name,t)}),i}init(){this.initObserver(),this.initContent(),this.initToolbar()}initObserver(){this.observers.forEach(e=>this.register(t=>e.observe(t)))}initContent(){this.orig instanceof HTMLTextAreaElement?(this.content.innerHTML=this.orig.value.replace("/&nbsp;/g"," "),this.orig.form.addEventListener("submit",()=>this.save())):this.content.innerHTML=this.orig.innerHTML,this.filter(this.content)}initToolbar(){for(let e of this.commands.entries()){const t=this.createElement("button",{type:"button","data-cmd":e[0],title:e[0]},e[0]);t.addEventListener("click",()=>{this.window.getSelection().containsNode(this.content,!0)||this.content.focus(),e[1].execute()}),this.toolbar.appendChild(t)}}register(e,t={childList:!0,subtree:!0}){if("function"!=typeof e)throw"Invalid argument";new MutationObserver(e).observe(this.content,t)}getData(){const e=this.content.cloneNode(!0);return this.filter(e,!0),e.innerHTML}save(){this.orig instanceof HTMLTextAreaElement?this.orig.value=this.getData():this.orig.innerHTML=this.getData()}insertText(e){this.document.execCommand("inserttext",!1,e)}insert(e){let t;if(!(e instanceof HTMLElement&&(t=this.getTag(e.tagName))))throw"Invalid HTML element";"text"===t.group?this.formatText(e):this.insertWidget(e)}insertWidget(e){if(!(e instanceof HTMLElement))throw"Invalid HTML element";if(!this.allowed(e.tagName,"root"))throw"Element is not allowed here";this.content.appendChild(e)}formatText(e){if(!(e instanceof HTMLElement))throw"Invalid HTML element";const t=this.window.getSelection(),n=t.anchorNode instanceof Text?t.anchorNode.parentElement:t.anchorNode,i=this.getSelectedEditable();if(t.isCollapsed||!t.toString().trim()||!(n instanceof HTMLElement)||!i)return;const r=t.getRangeAt(0),a=this.getTag(n.tagName),o=a&&"text"!==a.group?n:n.parentElement;r.startContainer instanceof Text&&!r.startContainer.parentElement.isSameNode(o)&&r.setStartBefore(r.startContainer.parentElement),r.endContainer instanceof Text&&!r.endContainer.parentElement.isSameNode(o)&&r.setEndAfter(r.endContainer.parentElement);const s=r.toString(),l=r.cloneContents().childNodes;let d=Array.from(l).every(t=>t instanceof Text&&!t.textContent.trim()||t instanceof HTMLElement&&t.tagName===e.tagName);r.deleteContents(),!(o.isContentEditable&&this.allowed(e.tagName,o.tagName)&&s.trim())||a&&d?r.insertNode(this.createText(s)):(e.textContent=s,r.insertNode(e)),o.normalize()}createElement(e,t={},n=""){const i=this.document.createElement(e);i.textContent=n;for(let[e,n]of Object.entries(t))n&&i.setAttribute(e,`${n}`);return i}createText(e){return this.document.createTextNode(e)}getSelectedElement(){const e=this.window.getSelection(),t=e.anchorNode instanceof Text?e.anchorNode.parentElement:e.anchorNode,n=e.focusNode instanceof Text?e.focusNode.parentElement:e.focusNode;return t instanceof HTMLElement&&n instanceof HTMLElement&&t.isSameNode(n)&&this.content.contains(t)?t:null}getSelectedEditable(){const e=this.window.getSelection(),t=e.anchorNode instanceof Text?e.anchorNode.parentElement:e.anchorNode,n=e.focusNode instanceof Text?e.focusNode.parentElement:e.focusNode;if(t instanceof HTMLElement&&n instanceof HTMLElement){const e=t.closest("[contenteditable=true]"),i=n.closest("[contenteditable=true]");if(e instanceof HTMLElement&&i instanceof HTMLElement&&e.isSameNode(i)&&this.content.contains(e))return e}return null}getSelectedWidget(){const e=this.getSelectedElement();return e?e.closest("div.editor-content > *"):null}focusEnd(e){if(!(e instanceof HTMLElement))throw"No HTML element";const t=this.document.createRange(),n=this.window.getSelection();e.focus(),t.selectNodeContents(e),t.collapse(),n.removeAllRanges(),n.addRange(t)}filter(e,t=!1){if(!(e instanceof HTMLElement))throw"No HTML element";this.filters.forEach(n=>n.filter(e,t))}getTagName(e){if(!(e instanceof HTMLElement))throw"No HTML element";return this.content.isSameNode(e)?"root":e.tagName}getTag(e){return this.tags.get(e.toLowerCase())||null}allowed(e,t){const n=this.getTag(e),i=this.getTag(t);return n&&i&&i.children.includes(n.group)}convert(e){if(!(e instanceof HTMLElement))throw"No HTML element";const t=this.converters.get(e.tagName.toLowerCase());if(!t)return e;const n=t.convert(e);return e.parentElement.replaceChild(n,e),n}t(e){return this.i18n[e]||e}static create(e,t={}){const n=new j(e,t);return n.init(),n}}export default j;
