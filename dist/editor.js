class y{constructor(a,b,c=null){this.editor=void 0,this.name=void 0,this.tag=null,this.dialog=null;if(!(a instanceof t)||!b||typeof b!=="string"||c&&typeof c!=="string")throw"Invalid argument";this.editor=a,this.name=b,this.tag=c?this.editor.tags.get(c):null,this.dialog=this.editor.dialogs.get(b)}execute(){this.dialog?this._openDialog():this._insert(this._selectedAttributes())}_insert(a={}){if(this.tag){Object.keys(a).forEach(c=>this.tag.attributes.includes(c)&&a[c]||delete a[c]);const b=this._selectedElement();this.tag.group!=="format"?this.editor.insert(this.editor.createElement(this.tag.name,{attributes:a})):b&&Object.keys(a).length>0?b.parentElement.replaceChild(this.editor.createElement(this.tag.name,{attributes:a,html:b.textContent}),b):b?b.parentElement.replaceChild(this.editor.createText(b.textContent),b):this.editor.format(this.editor.createElement(this.tag.name,{attributes:a}))}}_openDialog(){this.dialog.open(a=>this._insert(a),this._selectedAttributes())}_selectedElement(){const a=this.editor.getSelectedElement();return a&&a.localName===this.tag?.name?a:null}_selectedAttributes(){const a=this._selectedElement(),b={};return a&&this.tag&&Array.from(a.attributes).forEach(c=>{this.tag.attributes.includes(c.nodeName)&&(b[c.nodeName]=c.nodeValue)}),b}}class D extends Map{constructor(a=[]){super();a.forEach(b=>this.set(b))}get(a){return super.get(a)||null}set(a){if(!(a instanceof y))throw"Invalid argument";super.set(a.name,a)}execute(a){this.get(a).execute()}}class E extends Map{constructor(a=[]){super();a.forEach(b=>this.set(b))}get(a){return super.get(a)||null}set(a){if(!(a instanceof o))throw"Invalid argument";super.set(a.name,a)}}class z{constructor(a){this.element=void 0;if(!(a instanceof HTMLElement))throw"Invalid argument";this.element=a,this.register(this.__observe.bind(this))}dispatch(a,b,c){if(!a||typeof a!=="string"||!(b instanceof HTMLElement)||!(c instanceof HTMLElement))throw"Invalid argument";this.element.dispatchEvent(new CustomEvent(a,{detail:{element:b,target:c}}))}register(a,b={childList:!0,subtree:!0}){if(typeof a!=="function")throw"Invalid argument";const c=new MutationObserver(a);c.observe(this.element,b)}__dispatch(a,b,c){b instanceof HTMLElement&&c instanceof HTMLElement&&(this.dispatch(a,b,c),this.dispatch(`${a}${b.localName.replace("-","")}`,b,c))}__observe(a){a.forEach(b=>{b.addedNodes.forEach(c=>{c instanceof HTMLElement&&(this.__dispatch("insert",c,b.target),Array.from(c.getElementsByTagName("*")).forEach(e=>this.__dispatch("insert",e,b.target)))}),b.removedNodes.forEach(c=>c instanceof HTMLElement&&this.__dispatch("delete",c,b.target))})}}class s{constructor(a){this.editor=void 0;if(!(a instanceof t))throw"Invalid argument";this.editor=a}filter(a){throw"Not implemented"}}class F extends Set{add(a){if(!(a instanceof s))throw"Invalid argument";super.add(a)}filter(a){if(!(a instanceof HTMLElement))throw"Invalid argument";this.forEach(b=>{a.normalize(),b.filter(a)})}}class A{constructor({name:a,group:b,...c}={}){this.name=void 0,this.group=void 0,this.children=[],this.attributes=[],this.alignable=!1,this.deletable=!1,this.editable=!1,this.empty=!1,this.focusable=!1,this.navigable=!1,this.slotable=!1,this.sortable=!1,this.enter=null;const e=f=>f&&typeof f==="string",d=f=>typeof f==="undefined"||f&&typeof f==="string",g=f=>typeof f==="undefined"||Array.isArray(f)&&!f.find(j=>!e(j));if(!e(a)||!e(b)||!d(c.enter)||!g(c.children)||!g(c.attributes))throw"Invalid argument";this.name=a,this.group=b,this.children=c.children||[],this.attributes=c.attributes||[],this.alignable=c.alignable===!0,this.deletable=c.deletable===!0,this.editable=c.editable===!0,this.empty=c.empty===!0,this.focusable=c.focusable===!0,this.navigable=c.navigable===!0,this.slotable=c.slotable===!0,this.sortable=c.sortable===!0,this.enter=c.enter||null}}class h{constructor(a){this.editor=void 0;if(!(a instanceof t))throw"Invalid argument";this.editor=a}static get name(){throw"Missing plugin name"}static get dependencies(){return[]}static get config(){return{}}init(){throw"Not implemented"}_(a){return this.editor.translator.translate(this.constructor.name,a)}_i18n(a){a[this.editor.config.base.lang]&&this.editor.translator.set(this.constructor.name,a[this.editor.config.base.lang])}_command(a){this.editor.commands.set(new y(this.editor,this.constructor.name,a))}_tag(a){this.editor.tags.set(new A(a))}_toolbar(a,b=null){if(!a||typeof a!=="string"||b&&typeof b!=="string")throw"Invalid argument";a=this._(a),this.editor.toolbar.appendChild(this.editor.createElement("button",{attributes:{type:"button","data-command":this.constructor.name,title:a,"data-key":b},html:a}))}}class G extends Map{constructor(a=[]){super();a.forEach(b=>this.set(b))}get(a){return super.get(a)||null}set(a){if(!(a instanceof h))throw"Invalid argument";super.set(a.constructor.name,a)}init(){this.forEach(a=>a.init())}}class H extends Map{constructor(a=[]){super();a.forEach(b=>this.set(b))}has(a){return super.has(a instanceof HTMLElement?a.localName:a)}get(a){return super.get(a instanceof HTMLElement?a.localName:a)||null}set(a){if(!(a instanceof A))throw"Invalid argument";super.set(a.name,a)}allowed(a,b){return!!this.get(a)?.children.includes(this.get(b)?.group)}}class I extends Map{get(a){return super.get(a)||null}set(a,b){if(!a||typeof a!=="string"||!(b instanceof Object))throw"Invalid argument";super.set(a,b)}translate(a,b){return this.get(a)?.[b]||b}}class t{constructor(a,b={}){this.orig=void 0,this.document=void 0,this.window=void 0,this.element=void 0,this.toolbar=void 0,this.root=void 0,this.toolbarEvents=void 0,this.rootEvents=void 0,this.config={},this.translator=new I(),this.tags=new H(),this.filters=new F(),this.dialogs=new E(),this.commands=new D(),this.plugins=new G();if(!(a instanceof HTMLElement)||!(b instanceof Object))throw"Invalid argument";this.orig=a,this.document=this.orig.ownerDocument,this.window=this.document.defaultView,this.toolbar=this.createElement("editor-toolbar",{attributes:{role:"toolbar"}}),this.root=this.createElement("editor-root"),this.element=this.createElement("akilli-editor"),this.element.appendChild(this.toolbar),this.element.appendChild(this.root),this.toolbarEvents=new z(this.toolbar),this.rootEvents=new z(this.root),this.config=b}static get defaultConfig(){return{}}init(){const a=this.config;this.config={};let b=this.constructor.defaultConfig.base?.plugins||[];Array.isArray(a.base?.plugins)&&(b=b.filter(d=>a.base.plugins.includes(d.name)));const c=new Set(),e=d=>{d.dependencies&&d.dependencies.forEach(e),c.add(d)};b.map(e),c.forEach(d=>{Object.entries(d.config).forEach(([g,f])=>{this.config.hasOwnProperty(d.name)||(this.config[d.name]={}),this.config[d.name][g]=a[d.name]?.[g]||this.constructor.defaultConfig[d.name]?.[g]||f}),this.plugins.set(new d(this))}),this.plugins.init()}load(){this.orig instanceof HTMLTextAreaElement?(this.orig.form.addEventListener("submit",()=>this.save()),this.setHtml(this.orig.value.replace("/&nbsp;/g"," "))):this.setHtml(this.orig.innerHTML),this.orig.insertAdjacentElement("afterend",this.element),this.orig.hidden=!0}destroy(){this.element.parentElement.removeChild(this.element),this.orig.hidden=!1}getHtml(){const a=this.createElement(this.root.localName,{html:this.root.innerHTML});return this.filters.filter(a),this.rootEvents.dispatch("gethtml",a,this.root),a.innerHTML}setHtml(a){const b=this.createElement(this.root.localName,{html:a});this.rootEvents.dispatch("sethtml",b,this.root),this.filters.filter(b),this.root.innerHTML=b.innerHTML}save(){this.orig instanceof HTMLTextAreaElement?this.orig.value=this.getHtml():this.orig.innerHTML=this.getHtml()}insert(a){if(!(a instanceof HTMLElement))throw"Invalid argument";const b=this.getSelectedEditable();if(b&&b instanceof HTMLSlotElement&&this.tags.allowed(b.parentElement,a))b.insertAdjacentElement("beforebegin",a);else if(this.tags.allowed(this.root,a))this.root.appendChild(a);else throw"Invalid argument"}insertText(a){const b=this.getSelectedEditable();if(b){const c=this.window.getSelection().getRangeAt(0);c.deleteContents(),c.insertNode(this.createText(a)),c.collapse(),b.normalize()}}format(a){if(!(a instanceof HTMLElement))throw"Invalid argument";const b=this.window.getSelection(),c=b.anchorNode instanceof Text?b.anchorNode.parentElement:b.anchorNode,e=this.getSelectedEditable();if(b.isCollapsed||!b.toString().trim()||!(c instanceof HTMLElement)||!e)return;const d=b.getRangeAt(0),g=this.tags.get(c),f=!g||g.group==="format"?c.parentElement:c;d.startContainer instanceof Text&&d.startContainer.parentElement!==f&&d.setStartBefore(d.startContainer.parentElement),d.endContainer instanceof Text&&d.endContainer.parentElement!==f&&d.setEndAfter(d.endContainer.parentElement);const j=d.toString(),m=d.cloneContents().childNodes,p=Array.from(m).every(n=>n instanceof Text&&!n.textContent.trim()||n instanceof HTMLElement&&n.localName===a.localName);d.deleteContents(),f.isContentEditable&&this.tags.allowed(f,a)&&j.trim()&&(!g||!p)?(a.textContent=j,d.insertNode(a)):d.insertNode(this.createText(j)),f.normalize()}closest(a,b,c={}){if(!(a instanceof HTMLElement)||!this.contains(a.parentElement))throw"Invalid argument";let e=a,d=a.parentElement;do if(this.tags.allowed(d,b)){const g=this.createElement(b,c);return e.insertAdjacentElement("afterend",g),g}while((e=d)&&(d=d.parentElement)&&this.contains(d));return null}wrap(a,b,c={}){let e;if(a instanceof HTMLElement)a.parentElement.localName!==b&&(e=this.closest(a,b,c))&&e.appendChild(a);else throw"Invalid argument"}contains(a){if(!(a instanceof HTMLElement))throw"Invalid argument";return this.root.contains(a)||a.closest(this.root.localName)?.parentElement===null}registerElement(a,b,c=null){typeof this.window.customElements.get(a)==="undefined"&&this.window.customElements.define(a,b,c?{extends:c}:null)}createElement(a,{attributes:b={},html:c=""}={}){const e=this.document.createElement(a);return e.innerHTML=c,Object.entries(b).forEach(([d,g])=>{g&&e.setAttribute(d,`${g}`)}),e}createText(a){return this.document.createTextNode(a)}getSelectedElement(){const a=this.window.getSelection(),b=a.anchorNode instanceof Text?a.anchorNode.parentElement:a.anchorNode,c=a.focusNode instanceof Text?a.focusNode.parentElement:a.focusNode;return b instanceof HTMLElement&&c instanceof HTMLElement&&b===c&&this.contains(b)?b:null}getSelectedEditable(){const a=this.window.getSelection(),b=a.anchorNode instanceof Text?a.anchorNode.parentElement:a.anchorNode,c=a.focusNode instanceof Text?a.focusNode.parentElement:a.focusNode;if(b instanceof HTMLElement&&c instanceof HTMLElement){const e=b.closest("[contenteditable=true]"),d=c.closest("[contenteditable=true]");if(e instanceof HTMLElement&&e===d&&this.contains(e))return e}return null}focusEnd(a){if(!(a instanceof HTMLElement))throw"Invalid argument";const b=this.document.createRange(),c=this.window.getSelection();a.focus(),b.selectNodeContents(a),b.collapse(),c.removeAllRanges(),c.addRange(b)}isKey(a,b,{alt:c=!1,ctrl:e=!1,shift:d=!1}={}){return(Array.isArray(b)&&b.includes(a.key)||a.key===b)&&a.altKey===c&&a.ctrlKey===e&&a.shiftKey===d}url(a){const b=this.window.origin||this.window.location.origin,c=this.createElement("a",{attributes:{href:a}});return b===c.origin?c.pathname:c.href}static create(a,b={}){const c=new this(a,b);return c.init(),c.load(),c}}class o{constructor(a,b){this.editor=void 0,this.name=void 0;if(!(a instanceof t)||!b||typeof b!=="string")throw"Invalid argument";this.editor=a,this.name=b}open(a,b={}){const c=()=>Array.from(this.editor.element.getElementsByTagName("editor-dialog")).forEach(l=>{l.parentElement.removeChild(l)}),e=this.editor.window.getSelection(),d=e.rangeCount>0?e.getRangeAt(0):null,g=()=>{d&&(e.removeAllRanges(),e.addRange(d)),c()};c();const f=this.editor.createElement("editor-dialog");f.addEventListener("close",g);const j=this.editor.createElement("fieldset");j.insertAdjacentHTML("beforeend",this._getHtml()),Object.entries(b).forEach(([l,r])=>{j.elements[l]&&(j.elements[l].value=r)});const m=this.editor.createElement("button",{html:this._("Save")}),p=this.editor.createElement("button",{attributes:{type:"button"},html:this._("Cancel")});p.addEventListener("click",g);const n=this.editor.createElement("form");n.addEventListener("submit",l=>{l.preventDefault(),l.stopPropagation(),g();const r={};Array.from(j.elements).forEach(v=>r[v.name]=v.value),a(r)}),n.appendChild(j),n.appendChild(p),n.appendChild(m),f.appendChild(n),f.show(),this.editor.element.appendChild(f)}_(a){return this.editor.translator.translate(this.name,a)}_getHtml(){return""}}class J extends o{constructor(a){super(a,"audio")}_getHtml(){return`
            <legend>${this._("Audio")}</legend>
            <div data-required>
                <label for="editor-src">${this._("URL")}</label>
                <input id="editor-src" name="src" type="text" pattern="(https?|/).+" placeholder="${this._("Insert URL to media element")}" required />
            </div>
            <div>
                <label for="editor-width">${this._("Width")}</label>
                <input id="editor-width" name="width" type="number" />
            </div>
            <div>
                <label for="editor-height">${this._("Height")}</label>
                <input id="editor-height" name="height" type="number" />
            </div>
        `}}class k{constructor(a){this.editor=void 0;if(!(a instanceof t))throw"Invalid argument";this.editor=a}handleEvent(a){typeof this[a.type]==="function"&&this[a.type](a)}}class K extends k{constructor(a){super(a);this.editor.root.addEventListener("sethtml",this),this.editor.root.addEventListener("insertaudio",this)}sethtml(a){Array.from(a.detail.element.getElementsByTagName("audio")).forEach(b=>this.__init(b))}insertaudio(a){this.__init(a.detail.element)}__init(a){const b=a.getAttribute("src");b?(a.setAttribute("src",this.editor.url(b)),a.controls=!0,this.editor.wrap(a,"figure",{attributes:{class:"audio"}})):a.parentElement.removeChild(a)}}class L extends k{constructor(a){super(a);this.editor.root.addEventListener("insert",this)}insert(a){a.detail.element.hasAttribute("data-alignable")&&a.detail.element.addEventListener("keydown",this)}keydown(a){const b={ArrowUp:null,ArrowLeft:"left",ArrowDown:"center",ArrowRight:"right"};a.target===a.currentTarget&&this.editor.isKey(a,Object.keys(b),{shift:!0})&&(a.preventDefault(),a.stopPropagation(),a.target.classList.remove(...Object.values(b)),b[a.key]&&a.target.classList.add(b[a.key]))}}class M extends s{filter(a){const b=this.editor.tags.get(a),c=this.editor.tags.allowed(a,"p"),e=b.editable||b.group==="format";let d=[];const g=(f=null)=>{c&&d.length>0&&(a.insertBefore(this.editor.createElement("p",{html:d.join(" ")}),f),d=[])};Array.from(a.childNodes).forEach(f=>{const j=f.textContent.trim();if(f instanceof HTMLElement){f=this.__convert(f);const m=this.editor.tags.get(f);m&&this.editor.tags.allowed(a,f)?(g(f),this.__element(f,m)):m&&m.group==="format"&&c?(f=this.__element(f,m))&&(d.push(f.outerHTML),a.removeChild(f)):!e&&j&&c?(d.push(j),a.removeChild(f)):e&&j?a.replaceChild(this.editor.createText(j),f):a.removeChild(f)}else f instanceof Text?(!e&&j&&c&&d.push(j),(!e||!j)&&a.removeChild(f)):f instanceof Node&&a.removeChild(f)}),g()}__convert(a){const b=this.editor.config.base.filter[a.localName];if(!b)return a;const c=this.editor.createElement(b,{html:a.innerHTML});return a.parentElement.replaceChild(c,a),c}__element(a,b){return Array.from(a.attributes).forEach(c=>!b.attributes.includes(c.name)&&a.removeAttribute(c.name)),a.hasChildNodes()&&this.editor.filters.filter(a),a.hasChildNodes()||b.empty?a:(a.parentElement.removeChild(a),null)}}class N extends k{constructor(a){super(a);this.editor.root.addEventListener("insert",this)}insert(a){a.detail.element.hasAttribute("data-deletable")&&a.detail.element.addEventListener("keydown",this)}keydown(a){a.target===a.currentTarget&&this.editor.isKey(a,"Delete",{ctrl:!0})&&(a.target.previousElementSibling instanceof HTMLElement&&this.editor.focusEnd(a.target.previousElementSibling),a.target.parentElement.removeChild(a.target),a.preventDefault(),a.stopPropagation())}}class O extends HTMLElement{constructor(){super();this.addEventListener("keydown",a=>a.key==="Escape"&&this.close()),this.addEventListener("click",a=>a.target===this&&this.close())}connectedCallback(){this.setAttribute("role","dialog"),this.tabIndex=-1,this.focus()}get open(){return this.hasAttribute("open")}set open(a){a===!0?this.setAttribute("open",""):this.removeAttribute("open")}show(){this.open=!0,this.dispatchEvent(new CustomEvent("show",{detail:{element:this,target:this}}))}close(){this.open=!1,this.dispatchEvent(new CustomEvent("close",{detail:{element:this,target:this}}))}}class P extends k{constructor(a){super(a);this.editor.root.addEventListener("insert",this)}insert(a){a.detail.element.isContentEditable&&a.detail.element.addEventListener("keydown",this)}keydown(a){if(this.editor.isKey(a,"Enter",{shift:!0})&&!this.editor.tags.allowed(a.target,"br"))a.preventDefault(),a.stopPropagation();else if(this.editor.isKey(a,"Enter")){a.preventDefault(),a.stopPropagation();let b=this.editor.tags.get(a.target)?.enter;b&&(a.target.textContent.trim()||!a.target.hasAttribute("data-deletable")?this.editor.closest(a.target,b):a.target instanceof HTMLParagraphElement||(this.editor.closest(a.target,"p"),a.target.parentElement.removeChild(a.target)))}else this.editor.isKey(a,"Backspace")&&!a.target.textContent&&a.target.hasAttribute("data-deletable")?(a.target.previousElementSibling instanceof HTMLElement&&this.editor.focusEnd(a.target.previousElementSibling),a.target.parentElement.removeChild(a.target),a.preventDefault(),a.stopPropagation()):/^[A-Z]$/.test(a.key)&&this.editor.isKey(a,a.key,{alt:!0,shift:!0})&&(a.preventDefault(),a.stopPropagation(),this.editor.toolbar.querySelector(`button[data-key=${a.key.toLowerCase()}]`)?.click())}}class Q extends k{constructor(a){super(a);this.editor.root.addEventListener("insert",this)}insert(a){a.detail.element.hasAttribute("data-focusable")&&a.detail.element.focus()}}class R extends k{constructor(a){super(a);this.editor.root.addEventListener("insert",this)}insert(a){a.detail.element.hasAttribute("data-navigable")&&(a.detail.element.tabIndex=0,a.detail.element.addEventListener("keydown",this))}keydown(a){if(a.target===a.currentTarget&&this.editor.isKey(a,["ArrowUp","ArrowDown","Home","End"])&&this.__enabled(a.target)){const b=a.target.previousElementSibling,c=a.target.nextElementSibling,e=a.target.parentElement.firstElementChild,d=a.target.parentElement.lastElementChild,g=a.target===e,f=a.target===d;a.key==="ArrowUp"&&!g&&b.hasAttribute("data-navigable")?b.focus():a.key==="ArrowDown"&&!f&&c.hasAttribute("data-navigable")?c.focus():(a.key==="Home"||a.key==="ArrowDown"&&f)&&e.hasAttribute("data-navigable")?e.focus():(a.key==="End"||a.key==="ArrowUp"&&g)&&d.hasAttribute("data-navigable")&&d.focus(),a.preventDefault(),a.stopPropagation()}}__enabled(a){if(!a.isContentEditable)return!0;const b=this.editor.window.getSelection(),c=this.editor.getSelectedEditable(),e=this.editor.getSelectedElement();return b.isCollapsed&&b.anchorOffset===0&&[c,a.firstChild].includes(e)}}class S extends k{constructor(a){super(a);this.editor.root.addEventListener("insert",this)}insert(a){a.detail.element instanceof HTMLSlotElement?a.detail.element.addEventListener("keydown",this):a.detail.element.hasAttribute("data-slotable")&&!a.detail.element.querySelector(":scope > slot")&&a.detail.element.appendChild(this.editor.createElement("slot"))}keydown(a){a.preventDefault(),a.stopPropagation()}}class T extends k{constructor(a){super(a);this.editor.root.addEventListener("insert",this)}insert(a){a.detail.element.hasAttribute("data-sortable")&&(a.detail.element.addEventListener("keydown",this),a.detail.element.addEventListener("pointerdown",this),a.detail.element.addEventListener("pointermove",this),a.detail.element.addEventListener("pointerup",this))}keydown(a){if(a.target===a.currentTarget&&this.editor.isKey(a,["ArrowUp","ArrowDown","Home","End"],{ctrl:!0})){const b=a.target.parentElement,c=a.target.previousElementSibling,e=a.target.nextElementSibling,d=b.firstElementChild,g=b.lastElementChild,f=a.target===d,j=a.target===g;a.key==="ArrowUp"&&!f&&c.hasAttribute("data-sortable")?(c.insertAdjacentHTML("beforebegin",a.target.outerHTML),b.removeChild(a.target)):a.key==="ArrowDown"&&!j&&e.hasAttribute("data-sortable")?(e.insertAdjacentHTML("afterend",a.target.outerHTML),b.removeChild(a.target)):(a.key==="Home"&&!f||a.key==="ArrowDown"&&j)&&d.hasAttribute("data-sortable")?(d.insertAdjacentHTML("beforebegin",a.target.outerHTML),b.removeChild(a.target)):(a.key==="End"&&!j||a.key==="ArrowUp"&&f)&&g.hasAttribute("data-sortable")&&(g.insertAdjacentHTML("afterend",a.target.outerHTML),b.removeChild(a.target)),a.preventDefault(),a.stopPropagation()}}pointerdown(a){a.target.setAttribute("data-sort",""),a.target.setPointerCapture(a.pointerId)}pointermove(a){const b=this.editor.document.elementFromPoint(a.x,a.y);a.target!==b&&(this.__sortover(),this.__sortable(b)&&b.setAttribute("data-sortover",""))}pointerup(a){const b=this.editor.document.elementFromPoint(a.x,a.y);this.__sortover(),a.target.removeAttribute("data-sort"),a.target.releasePointerCapture(a.pointerId),a.target!==b&&this.__sortable(b)&&this.editor.tags.allowed(b.parentElement,a.target)&&b.insertAdjacentElement("beforebegin",a.target)}__sortover(){this.editor.root.querySelectorAll("[data-sortover]").forEach(a=>a.removeAttribute("data-sortover"))}__sortable(a){return a instanceof HTMLElement&&a.hasAttribute("data-sortable")&&this.editor.contains(a)&&a!==this.editor.root}}class U extends k{constructor(a){super(a);this.editor.root.addEventListener("insert",this)}insert(a){const b=this.editor.tags.get(a.detail.element);b&&(b.editable&&(a.detail.element.contentEditable="true"),["alignable","deletable","focusable","navigable","slotable","sortable"].forEach(c=>{b[c]&&(a.detail.element.dataset[c]="")}))}}class V extends k{constructor(a){super(a);this.editor.toolbar.addEventListener("insertbutton",this)}insertbutton(a){if(a.detail.element.dataset.key){const b=this.editor.translator.translate("base","Alt"),c=this.editor.translator.translate("base","Shift");a.detail.element.title+=` [${b} + ${c} + ${a.detail.element.dataset.key}]`}a.detail.element.getAttribute("data-command")&&a.detail.element.addEventListener("click",this),a.detail.element.parentElement===this.editor.toolbar&&(a.detail.element.tabIndex=-1,a.detail.element.addEventListener("keydown",this))}click(a){this.editor.commands.execute(a.target.getAttribute("data-command"))}keydown(a){if(this.editor.isKey(a,["ArrowLeft","ArrowRight","Home","End"])){const b=a.target.previousElementSibling,c=a.target.nextElementSibling,e=a.target.parentElement.firstElementChild,d=a.target.parentElement.lastElementChild,g=a.target===e,f=a.target===d;a.key==="ArrowLeft"&&!g?b.focus():a.key==="ArrowRight"&&!f?c.focus():a.key==="Home"||a.key==="ArrowRight"&&f?e.focus():(a.key==="End"||a.key==="ArrowLeft"&&g)&&d.focus(),a.preventDefault(),a.stopPropagation()}}}const W={de:{Alt:"Alt",Shift:"Umschalt"}};class i extends h{static get name(){return"base"}static get config(){return{browser:{},filter:{},lang:null,plugins:[],tags:[]}}init(){this._i18n(W),this.editor.registerElement("editor-dialog",O),this._tag({name:"editor-root",group:"root",children:["audio","block","container","figure","heading","iframe","image","list","paragraph","quote","table","video"]}),this._tag({name:"slot",group:"slot",editable:!0,focusable:!0,navigable:!0}),new V(this.editor),new U(this.editor),new P(this.editor),new N(this.editor),new R(this.editor),new T(this.editor),new L(this.editor),new Q(this.editor),new S(this.editor),this.editor.filters.add(new M(this.editor))}}class w extends o{constructor(a,b,c){super(a,b);this.url=void 0,this.opts=Object.assign({alwaysRaised:"yes",dependent:"yes",height:`${this.editor.window.screen.height}`,location:"no",menubar:"no",minimizable:"no",modal:"yes",resizable:"yes",scrollbars:"yes",toolbar:"no",width:`${this.editor.window.screen.width}`},this.editor.config.base.browser);if(!c||typeof c!=="string")throw"Invalid argument";this.url=c}open(a,b={}){const c=Object.entries(this.opts).map(f=>`${f[0]}=${f[1]}`).join(","),e=this.editor.createElement("a",{attributes:{href:this.url}}),d=new URL(e.href);Object.entries(b).forEach(([f,j])=>d.searchParams.set(f,`${j}`));const g=this.editor.window.open(d.toString(),this.name,c);this.editor.window.addEventListener("message",f=>{f.origin===d.origin&&f.source===g&&(a(f.data),g.close())},!1)}}class X extends s{filter(a){a.querySelectorAll("figure > figcaption:only-child").forEach(b=>b.parentElement.removeChild(b))}}class Y extends k{constructor(a){super(a);this.editor.root.addEventListener("insertfigure",this)}insertfigure(a){a.detail.element.querySelector(":scope > figcaption")||a.detail.element.appendChild(this.editor.createElement("figcaption"))}}class u extends h{static get name(){return"figure"}static get dependencies(){return[i]}init(){this._tag({name:"figure",group:"figure",children:["audio","caption","iframe","image","quote","table","video"],attributes:["class"],alignable:!0,deletable:!0,focusable:!0,navigable:!0,sortable:!0}),this._tag({name:"figcaption",group:"caption",children:["format"],editable:!0,navigable:!0,enter:"p"}),new Y(this.editor),this.editor.filters.add(new X(this.editor))}}const Z={de:{Audio:"Audio",Cancel:"Abbrechen",Height:"Höhe","Insert URL to media element":"URL zum Medienelement eingeben",Save:"Speichern",URL:"URL",Width:"Breite"}};class _ extends h{static get name(){return"audio"}static get dependencies(){return[i,u]}static get config(){return{browser:null}}init(){this._i18n(Z),this._tag({name:"audio",group:"audio",attributes:["controls","height","src","width"],empty:!0,navigable:!0}),new K(this.editor),this.editor.config.audio.browser?this.editor.dialogs.set(new w(this.editor,"audio",this.editor.config.audio.browser)):this.editor.dialogs.set(new J(this.editor)),this._command("audio"),this._toolbar("Audio")}}class $ extends o{constructor(a){super(a,"block")}_getHtml(){return`
            <legend>${this._("Block")}</legend>
            <div data-required>
                <label for="editor-id">${this._("ID")}</label>
                <input id="editor-id" name="id" type="text" required />
            </div>
        `}}class aa extends HTMLElement{constructor(){super();this.attachShadow({mode:"open"})}get content(){return this.shadowRoot.innerHTML}set content(a){this.shadowRoot.innerHTML=a}}class ba extends k{constructor(a){super(a);this.editor.root.addEventListener("sethtml",this),this.editor.root.addEventListener("inserteditorblock",this)}sethtml(a){Array.from(a.detail.element.getElementsByTagName("editor-block")).forEach(b=>b.id||b.parentElement.removeChild(b))}async inserteditorblock(a){if(a.detail.element.id){if(!this.editor.config.block.api)return}else{a.detail.element.parentElement.removeChild(a.detail.element);return}try{const b=await fetch(this.editor.config.block.api.replace("{id}",a.detail.element.id),{mode:"no-cors"});if(b.ok){let c="";this.editor.config.block.css&&(c=this.editor.config.block.css.split(",").map(d=>`<link rel="stylesheet" href="${d}">`).join(""));const e=await b.text();a.detail.element.content=c+e}}catch(b){console.error(b)}}}const B={de:{Cancel:"Abbrechen",Height:"Höhe",Ifrane:"Iframe","Insert URL to media element":"URL zum Medienelement eingeben",Save:"Speichern",URL:"URL",Width:"Breite"}};class ca extends h{static get name(){return"block"}static get dependencies(){return[i]}static get config(){return{api:null,browser:null,css:null}}init(){this._i18n(B),this.editor.registerElement("editor-block",aa),this._tag({name:"editor-block",group:"block",attributes:["id"],deletable:!0,empty:!0,focusable:!0,navigable:!0,sortable:!0}),new ba(this.editor),this.editor.config.block.browser?this.editor.dialogs.set(new w(this.editor,"block",this.editor.config.block.browser)):this.editor.dialogs.set(new $(this.editor)),this._command("editor-block"),this._toolbar("Block")}}class da extends s{filter(a){a instanceof HTMLElement&&a.localName==="figure"&&a.classList.contains("quote")&&a.querySelector(":scope > blockquote")&&!a.querySelector(":scope > figcaption")&&(a.insertAdjacentElement("beforebegin",a.querySelector(":scope > blockquote")),a.innerHTML="")}}class ea extends k{constructor(a){super(a);this.editor.root.addEventListener("insertblockquote",this),this.editor.root.addEventListener("deleteblockquote",this)}insertblockquote(a){this.editor.wrap(a.detail.element,"figure",{attributes:{class:"quote"}})}deleteblockquote(a){a.detail.target.localName==="figure"&&a.detail.target.classList.contains("quote")&&a.detail.target.parentElement.removeChild(a.detail.target)}}class fa extends s{filter(a){a.innerHTML=a.innerHTML.replace(/^\s*(<br\s*\/?>\s*)+/gi,"").replace(/\s*(<br\s*\/?>\s*)+$/gi,""),a instanceof HTMLParagraphElement?a.outerHTML=a.outerHTML.replace(/\s*(<br\s*\/?>\s*){2,}/gi,"</p><p>"):a.innerHTML=a.innerHTML.replace(/\s*(<br\s*\/?>\s*){2,}/gi,"<br>")}}class x extends h{static get name(){return"break"}static get dependencies(){return[i]}init(){this._tag({name:"br",group:"break",empty:!0}),this.editor.filters.add(new fa(this.editor))}}const ga={de:{"Block Quote":"Blockzitat"}};class ha extends h{static get name(){return"blockquote"}static get dependencies(){return[i,x,u]}init(){this._i18n(ga),this._tag({name:"blockquote",group:"quote",children:["break","format"],deletable:!0,editable:!0,navigable:!0,enter:"p"}),new ea(this.editor),this._command("blockquote"),this._toolbar("Block Quote"),this.editor.filters.add(new da(this.editor))}}const ia={de:{bold:"fett"}};class ja extends h{static get name(){return"bold"}static get dependencies(){return[i]}init(){this._i18n(ia),this._tag({name:"b",group:"format"}),this._command("b"),this._toolbar("bold","b")}}const ka={de:{citation:"Zitatquelle"}};class la extends h{static get name(){return"cite"}static get dependencies(){return[i]}init(){this._i18n(ka),this._tag({name:"cite",group:"format"}),this._command("cite"),this._toolbar("citation","z")}}const ma={de:{code:"Quelltext"}};class na extends h{static get name(){return"code"}static get dependencies(){return[i]}init(){this._i18n(ma),this._tag({name:"code",group:"format"}),this._command("code"),this._toolbar("code","c")}}const oa={de:{definition:"Definition"}};class pa extends h{static get name(){return"definition"}static get dependencies(){return[i]}init(){this._i18n(oa),this._tag({name:"dfn",group:"format"}),this._command("dfn"),this._toolbar("definition","d")}}class qa extends s{filter(a){a.querySelectorAll("summary:not(:first-child)").forEach(b=>b.parentElement.removeChild(b)),a.querySelectorAll("summary:only-child").forEach(b=>b.parentElement.removeChild(b))}}class ra extends k{constructor(a){super(a);this.editor.root.addEventListener("insertdetails",this),this.editor.root.addEventListener("insertsummary",this)}insertdetails(a){a.detail.element.open=!0,a.detail.element.querySelector(":scope > summary:first-child")||a.detail.element.insertAdjacentElement("afterbegin",this.editor.createElement("summary"))}insertsummary(a){this.__empty(a.detail.element),a.detail.element.addEventListener("blur",this),a.detail.element.addEventListener("keydown",this)}blur(a){this.__empty(a.target)}keydown(a){this.editor.isKey(a," ")?(a.preventDefault(),a.stopPropagation(),this.editor.insertText(" ")):this.editor.isKey(a,"Enter")&&(a.preventDefault(),a.stopPropagation(),a.target.parentElement.open=!0)}__empty(a){a.textContent.trim()?a.querySelectorAll("br:not(:last-child)").forEach(b=>b.parentElement.removeChild(b)):a.textContent=this.editor.translator.translate("details","Details"),a.lastElementChild instanceof HTMLBRElement||a.appendChild(this.editor.createElement("br"))}}const sa={de:{Details:"Details"}};class ta extends h{static get name(){return"details"}static get dependencies(){return[i]}init(){this._i18n(sa),this._tag({name:"details",group:"container",children:["audio","figure","iframe","image","list","paragraph","quote","summary","table","video"],deletable:!0,focusable:!0,navigable:!0,slotable:!0,sortable:!0}),this._tag({name:"summary",group:"summary",editable:!0,navigable:!0,enter:"p"}),new ra(this.editor),this._command("details"),this._toolbar("Details"),this.editor.filters.add(new qa(this.editor))}}class ua extends o{constructor(a){super(a,"division")}_getHtml(){return`
            <legend>${this._("Division")}</legend>
            <div>
                <label for="editor-class">${this._("CSS class")}</label>
                <input id="editor-class" name="class" type="text" placeholder="${this._("Insert CSS class")}" />
            </div>
        `}}const va={de:{Cancel:"Abbrechen","CSS class":"CSS-Klasse",Division:"Division","Insert CSS class":"CSS-Klasse eingeben",Save:"Speichern"}};class wa extends h{static get name(){return"division"}static get dependencies(){return[i]}init(){this._i18n(va),this._tag({name:"div",group:"container",children:["audio","block","figure","iframe","image","quote","table","video"],attributes:["class"],deletable:!0,focusable:!0,navigable:!0,slotable:!0,sortable:!0}),this.editor.dialogs.set(new ua(this.editor)),this._command("div"),this._toolbar("Division")}}const xa={de:{emphasized:"betont"}};class ya extends h{static get name(){return"emphasis"}static get dependencies(){return[i]}init(){this._i18n(xa),this._tag({name:"em",group:"format"}),this._command("em"),this._toolbar("emphasized","e")}}const za={de:{Heading:"Überschrift"}};class Aa extends h{static get name(){return"heading"}static get dependencies(){return[i]}init(){this._i18n(za),this._tag({name:"h2",group:"heading",deletable:!0,editable:!0,focusable:!0,navigable:!0,sortable:!0,enter:"p"}),this._command("h2"),this._toolbar("Heading")}}class Ba extends o{constructor(a){super(a,"iframe")}_getHtml(){return`
            <legend>${this._("Iframe")}</legend>
            <div data-required>
                <label for="editor-src">${this._("URL")}</label>
                <input id="editor-src" name="src" type="text" pattern="(https?|/).+" placeholder="${this._("Insert URL to media element")}" required />
            </div>
            <div>
                <label for="editor-width">${this._("Width")}</label>
                <input id="editor-width" name="width" type="number" />
            </div>
            <div>
                <label for="editor-height">${this._("Height")}</label>
                <input id="editor-height" name="height" type="number" />
            </div>
        `}}class Ca extends k{constructor(a){super(a);this.editor.root.addEventListener("sethtml",this),this.editor.root.addEventListener("insertiframe",this)}sethtml(a){Array.from(a.detail.element.getElementsByTagName("iframe")).forEach(b=>this.__init(b))}insertiframe(a){this.__init(a.detail.element)}__init(a){const b=a.getAttribute("src");b?(a.setAttribute("src",this.editor.url(b)),a.allowFullscreen=!0,this.editor.wrap(a,"figure",{attributes:{class:"iframe"}})):a.parentElement.removeChild(a)}}class Da extends h{static get name(){return"iframe"}static get dependencies(){return[i,u]}static get config(){return{browser:null}}init(){this._i18n(B),this._tag({name:"iframe",group:"iframe",attributes:["allowfullscreen","height","src","width"],empty:!0,navigable:!0}),new Ca(this.editor),this.editor.config.iframe.browser?this.editor.dialogs.set(new w(this.editor,"iframe",this.editor.config.iframe.browser)):this.editor.dialogs.set(new Ba(this.editor)),this._command("iframe"),this._toolbar("Iframe")}}class Ea extends o{constructor(a){super(a,"image")}_getHtml(){return`
            <legend>${this._("Image")}</legend>
            <div data-required>
                <label for="editor-src">${this._("URL")}</label>
                <input id="editor-src" name="src" type="text" pattern="(https?|/).+" placeholder="${this._("Insert URL to media element")}" required />
            </div>
            <div>
                <label for="editor-alt">${this._("Alternative text")}</label>
                <input id="editor-alt" name="alt" type="text" placeholder="${this._("Replacement text for use when media elements are not available")}" />
            </div>
            <div>
                <label for="editor-width">${this._("Width")}</label>
                <input id="editor-width" name="width" type="number" />
            </div>
            <div>
                <label for="editor-height">${this._("Height")}</label>
                <input id="editor-height" name="height" type="number" />
            </div>
        `}}class Fa extends k{constructor(a){super(a);this.editor.root.addEventListener("sethtml",this),this.editor.root.addEventListener("insertimg",this)}sethtml(a){Array.from(a.detail.element.getElementsByTagName("img")).forEach(b=>this.__init(b))}insertimg(a){this.__init(a.detail.element)}__init(a){const b=a.getAttribute("src");b?(a.setAttribute("src",this.editor.url(b)),this.editor.wrap(a,"figure",{attributes:{class:"image"}})):a.parentElement.removeChild(a)}}const Ga={de:{"Alternative text":"Alternativtext",Cancel:"Abbrechen",Height:"Höhe",Image:"Bild","Insert URL to media element":"URL zum Medienelement eingeben","Replacement text for use when media elements are not available":"Ersatztext, falls Medienelemente nicht verfügbar sind",Save:"Speichern",URL:"URL",Width:"Breite"}};class Ha extends h{static get name(){return"image"}static get dependencies(){return[i,u]}static get config(){return{browser:null}}init(){this._i18n(Ga),this._tag({name:"img",group:"image",attributes:["alt","height","src","width"],empty:!0,navigable:!0}),new Fa(this.editor),this.editor.config.image.browser?this.editor.dialogs.set(new w(this.editor,"image",this.editor.config.image.browser)):this.editor.dialogs.set(new Ea(this.editor)),this._command("img"),this._toolbar("Image")}}const Ia={de:{italic:"kursiv"}};class Ja extends h{static get name(){return"italic"}static get dependencies(){return[i]}init(){this._i18n(Ia),this._tag({name:"i",group:"format"}),this._command("i"),this._toolbar("italic","i")}}const Ka={de:{"user input":"Benutzereingabe"}};class La extends h{static get name(){return"keyboard"}static get dependencies(){return[i]}init(){this._i18n(Ka),this._tag({name:"kbd",group:"format"}),this._command("kbd"),this._toolbar("user input","k")}}class Ma extends o{constructor(a){super(a,"link")}_getHtml(){return`
            <legend>${this._("Link")}</legend>
            <div>
                <label for="editor-href">${this._("URL")}</label>
                <input id="editor-href" name="href" type="text" pattern="(https?|/|mailto:).+" placeholder="${this._("Insert URL to add a link or leave empty to unlink")}" />
            </div>
        `}}class Na extends k{constructor(a){super(a);this.editor.root.addEventListener("sethtml",this),this.editor.root.addEventListener("inserta",this)}sethtml(a){Array.from(a.detail.element.getElementsByTagName("a")).forEach(b=>this.__init(b))}inserta(a){this.__init(a.detail.element)}__init(a){const b=a.getAttribute("href");b?(a.setAttribute("href",this.editor.url(b)),a.addEventListener("click",()=>this.editor.toolbar.querySelector("button[data-command=link").click())):a.parentElement.replaceChild(this.editor.createText(a.textContent),a)}}const Oa={de:{Cancel:"Abbrechen","Insert URL to add a link or leave empty to unlink":"URL eingeben um zu verlinken oder leer lassen um Link zu entfernen",Link:"Link",Save:"Speichern",URL:"URL"}};class Pa extends h{static get name(){return"link"}static get dependencies(){return[i]}init(){this._i18n(Oa),this._tag({name:"a",group:"format",attributes:["href"]}),new Na(this.editor),this.editor.dialogs.set(new Ma(this.editor)),this._command("a"),this._toolbar("Link","l")}}const Qa={de:{mark:"markiert"}};class Ra extends h{static get name(){return"mark"}static get dependencies(){return[i]}init(){this._i18n(Qa),this._tag({name:"mark",group:"format"}),this._command("mark"),this._toolbar("mark","m")}}class Sa extends k{constructor(a){super(a);this.editor.root.addEventListener("sethtml",this),this.editor.root.addEventListener("insertli",this),this.editor.root.addEventListener("deleteli",this),this.editor.root.addEventListener("insertol",this),this.editor.root.addEventListener("insertul",this)}sethtml(a){Array.from(a.detail.element.getElementsByTagName("li")).forEach(b=>this.__init(b))}insertli(a){this.__init(a.detail.element)}deleteli(a){a.detail.target.children.length===0&&a.detail.target.parentElement.removeChild(a.detail.target)}insertol(a){a.detail.element.children.length===0&&a.detail.element.appendChild(this.editor.createElement("li"))}insertul(a){this.insertol(a)}__init(a){!(a.parentElement instanceof HTMLOListElement)&&!(a.parentElement instanceof HTMLUListElement)&&this.editor.wrap(a,"ul")}}class C extends h{static get name(){return"list"}static get dependencies(){return[i,x]}init(){this._tag({name:"li",group:"listitem",children:["break","format"],deletable:!0,editable:!0,focusable:!0,navigable:!0,sortable:!0,enter:"li"}),new Sa(this.editor)}}const Ta={de:{"Ordered List":"Geordnete Liste"}};class Ua extends h{static get name(){return"orderedlist"}static get dependencies(){return[i,C]}init(){this._i18n(Ta),this._tag({name:"ol",group:"list",children:["listitem"],deletable:!0,focusable:!0,navigable:!0,sortable:!0}),this._command("ol"),this._toolbar("Ordered List")}}class Va extends k{constructor(a){super(a);this.editor.root.addEventListener("sethtml",this),this.editor.root.addEventListener("insertp",this)}sethtml(a){Array.from(a.detail.element.getElementsByTagName("p")).forEach(b=>this.__init(b))}insertp(a){this.__init(a.detail.element)}__init(a){a.addEventListener("paste",this)}paste(a){this.editor.window.setTimeout(()=>this.editor.filters.filter(a.target))}}const Wa={de:{Paragraph:"Absatz"}};class Xa extends h{static get name(){return"paragraph"}static get dependencies(){return[i,x]}init(){this._i18n(Wa),this._tag({name:"p",group:"paragraph",children:["break","format"],deletable:!0,editable:!0,focusable:!0,navigable:!0,sortable:!0,enter:"p"}),new Va(this.editor),this._command("p"),this._toolbar("Paragraph")}}const Ya={de:{quote:"Zitat"}};class Za extends h{static get name(){return"quote"}static get dependencies(){return[i]}init(){this._i18n(Ya),this._tag({name:"q",group:"format"}),this._command("q"),this._toolbar("quote","q")}}const _a={de:{"sample output":"Beispielausgabe"}};class $a extends h{static get name(){return"sample"}static get dependencies(){return[i]}init(){this._i18n(_a),this._tag({name:"samp",group:"format"}),this._command("samp"),this._toolbar("sample output","o")}}class ab extends o{constructor(a){super(a,"section")}_getHtml(){return`
            <legend>${this._("Section")}</legend>
            <div>
                <label for="editor-class">${this._("CSS class")}</label>
                <input id="editor-class" name="class" type="text" placeholder="${this._("Insert CSS class")}" />
            </div>
        `}}const bb={de:{Cancel:"Abbrechen","CSS class":"CSS-Klasse","Insert CSS class":"CSS-Klasse eingeben",Save:"Speichern",Section:"Sektion"}};class cb extends h{static get name(){return"section"}static get dependencies(){return[i]}init(){this._i18n(bb),this._tag({name:"section",group:"container",children:["audio","figure","heading","iframe","image","list","paragraph","quote","table","video"],attributes:["class"],deletable:!0,focusable:!0,navigable:!0,slotable:!0,sortable:!0}),this.editor.dialogs.set(new ab(this.editor)),this._command("section"),this._toolbar("Section")}}const db={de:{small:"klein"}};class eb extends h{static get name(){return"small"}static get dependencies(){return[i]}init(){this._i18n(db),this._tag({name:"small",group:"format"}),this._command("small"),this._toolbar("small","w")}}const fb={de:{strikethrough:"durchgestrichen"}};class gb extends h{static get name(){return"strikethrough"}static get dependencies(){return[i]}init(){this._i18n(fb),this._tag({name:"s",group:"format"}),this._command("s"),this._toolbar("strikethrough","r")}}const hb={de:{"strongly emphasized":"stark betont"}};class ib extends h{static get name(){return"strong"}static get dependencies(){return[i]}init(){this._i18n(hb),this._tag({name:"strong",group:"format"}),this._command("strong"),this._toolbar("strongly emphasized","s")}}const jb={de:{Subheading:"Unterüberschrift"}};class kb extends h{static get name(){return"subheading"}static get dependencies(){return[i]}init(){this._i18n(jb),this._tag({name:"h3",group:"heading",deletable:!0,editable:!0,focusable:!0,navigable:!0,sortable:!0,enter:"p"}),this._command("h3"),this._toolbar("Subheading")}}const lb={de:{subscript:"tiefgestellt"}};class mb extends h{static get name(){return"subscript"}static get dependencies(){return[i]}init(){this._i18n(lb),this._tag({name:"sub",group:"format"}),this._command("sub"),this._toolbar("subscript","x")}}const nb={de:{superscript:"hochgestellt"}};class ob extends h{static get name(){return"superscript"}static get dependencies(){return[i]}init(){this._i18n(nb),this._tag({name:"sup",group:"format"}),this._command("sup"),this._toolbar("superscript","y")}}class pb extends y{constructor(a){super(a,"table","table")}_insert({rows:a=1,cols:b=1}={}){a=a>1?a:1,b=b>1?b:1;const c=this.editor.createElement("figure",{attributes:{class:"table"}}),e=this.editor.createElement("table"),d=this.editor.createElement("tbody");for(let g=0;g<a;g++){const f=this.editor.createElement("tr");d.appendChild(f);for(let j=0;j<b;++j)f.appendChild(this.editor.createElement("td"))}e.appendChild(d),c.appendChild(e),this.editor.insert(c)}}class qb extends o{constructor(a){super(a,"table")}_getHtml(){return`
            <legend>${this._("Table")}</legend>
            <div data-required>
                <label for="editor-rows">${this._("Rows")}</label>
                <input id="editor-rows" name="rows" type="number" value="1" min="1" required />
            </div>
            <div data-required>
                <label for="editor-cols">${this._("Columns")}</label>
                <input id="editor-cols" name="cols" type="number" value="1" min="1" required />
            </div>
        `}}class rb extends s{filter(a){a instanceof HTMLElement&&a.localName==="figure"&&a.classList.contains("table")&&a.querySelector(":scope > table")&&!a.querySelector(":scope > figcaption")?(a.insertAdjacentElement("beforebegin",a.querySelector(":scope > table")),a.innerHTML=""):a instanceof HTMLTableElement&&a.querySelector(":scope > thead, :scope > tfoot")&&!a.querySelector(":scope > tbody")?a.innerHTML="":a instanceof HTMLTableSectionElement&&a.rows.length<=0?a.innerHTML="":a instanceof HTMLTableRowElement&&!a.querySelector(":scope > th:not(:empty), :scope > td:not(:empty)")&&(a.innerHTML="")}}class sb extends k{constructor(a){super(a);this.editor.root.addEventListener("inserttable",this),this.editor.root.addEventListener("inserttd",this),this.editor.root.addEventListener("insertth",this)}inserttable(a){this.editor.wrap(a.detail.element,"figure",{attributes:{class:"table"}}),a.detail.element.tBodies.length>0&&a.detail.element.tBodies[0].rows[0]&&(!a.detail.element.tHead||!a.detail.element.tFoot)&&(a.detail.element.tHead||this.__row(a.detail.element.createTHead(),a.detail.element.tBodies[0].rows[0].cells.length),a.detail.element.tFoot||this.__row(a.detail.element.createTFoot(),a.detail.element.tBodies[0].rows[0].cells.length))}inserttd(a){a.detail.element.addEventListener("keydown",this)}insertth(a){a.detail.element.addEventListener("keydown",this)}keydown(a){const b=a.target,c=b.parentElement,e=c.parentElement,d=e instanceof HTMLTableElement?e:e.parentElement,g=["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"],f=this.editor.isKey(a,g.concat(["Home","End"])),j=this.editor.isKey(a,g,{alt:!0}),m=this.editor.isKey(a,g,{alt:!0,shift:!0});if(b instanceof HTMLTableCellElement&&c instanceof HTMLTableRowElement&&(e instanceof HTMLTableElement||e instanceof HTMLTableSectionElement)&&d instanceof HTMLTableElement&&(f||j||m)){const p=c.cells.length,n=e.rows.length,l=e instanceof HTMLTableElement?c.rowIndex:c.sectionRowIndex,r=b.cellIndex===0,v=b.cellIndex===p-1,Gb=c.rowIndex===0,Hb=c.rowIndex===d.rows.length-1;a.preventDefault(),a.stopPropagation(),f?a.key==="ArrowLeft"&&!r&&!b.textContent?c.cells[b.cellIndex-1].focus():a.key==="ArrowRight"&&!v&&!b.textContent?c.cells[b.cellIndex+1].focus():(a.key==="Home"||a.key==="ArrowRight"&&v)&&!b.textContent?c.cells[0].focus():(a.key==="End"||a.key==="ArrowLeft"&&r)&&!b.textContent?c.cells[p-1].focus():a.key==="ArrowUp"&&!Gb?d.rows[c.rowIndex-1].cells[b.cellIndex].focus():a.key==="ArrowUp"?d.rows[d.rows.length-1].cells[b.cellIndex].focus():a.key==="ArrowDown"&&!Hb?d.rows[c.rowIndex+1].cells[b.cellIndex].focus():a.key==="ArrowDown"&&d.rows[0].cells[b.cellIndex].focus():j?a.key==="ArrowLeft"?Array.from(d.rows).forEach(q=>this.__cell(q,q.cells[b.cellIndex])):a.key==="ArrowRight"?Array.from(d.rows).forEach(q=>this.__cell(q,q.cells[b.cellIndex+1])):a.key==="ArrowUp"?this.__row(e,p,l):a.key==="ArrowDown"&&this.__row(e,p,l+1):m&&(a.key==="ArrowLeft"&&!r?Array.from(d.rows).forEach(q=>q.deleteCell(b.cellIndex-1)):a.key==="ArrowRight"&&!v?Array.from(d.rows).forEach(q=>q.deleteCell(b.cellIndex+1)):a.key==="ArrowUp"&&l>0?e.deleteRow(l-1):a.key==="ArrowDown"&&l<n-1&&e.deleteRow(l+1))}}__row(a,b,c=0){const e=a.insertRow(c);for(let d=0;d<b;d++)this.__cell(e)}__cell(a,b=null){const c=a.parentElement.localName==="thead"?"th":"td";a.insertBefore(this.editor.createElement(c),b)}}const tb={de:{Cancel:"Abbrechen",Columns:"Spalten",Rows:"Zeilen",Save:"Speichern",Table:"Tabelle"}};class ub extends h{static get name(){return"table"}static get dependencies(){return[i,x,u]}init(){this._i18n(tb),this._tag({name:"table",group:"table",children:["tablesection"],deletable:!0,navigable:!0,sortable:!0}),this._tag({name:"thead",group:"tablesection",children:["tablerow"]}),this._tag({name:"tbody",group:"tablesection",children:["tablerow"]}),this._tag({name:"tfoot",group:"tablesection",children:["tablerow"]}),this._tag({name:"tr",group:"tablerow",children:["tablecell"]}),this._tag({name:"th",group:"tablecell",children:["break","format"],editable:!0,empty:!0}),this._tag({name:"td",group:"tablecell",children:["break","format"],editable:!0,empty:!0}),new sb(this.editor),this.editor.filters.add(new rb(this.editor)),this.editor.dialogs.set(new qb(this.editor)),this.editor.commands.set(new pb(this.editor)),this._toolbar("Table")}}const vb={de:{underline:"unterstrichen"}};class wb extends h{static get name(){return"underline"}static get dependencies(){return[i]}init(){this._i18n(vb),this._tag({name:"u",group:"format"}),this._command("u"),this._toolbar("underline","u")}}const xb={de:{"Unordered List":"Ungeordnete Liste"}};class yb extends h{static get name(){return"unorderedlist"}static get dependencies(){return[i,C]}init(){this._i18n(xb),this._tag({name:"ul",group:"list",children:["listitem"],deletable:!0,focusable:!0,navigable:!0,sortable:!0}),this._command("ul"),this._toolbar("Unordered List")}}const zb={de:{variable:"Variable"}};class Ab extends h{static get name(){return"variable"}static get dependencies(){return[i]}init(){this._i18n(zb),this._tag({name:"var",group:"format"}),this._command("var"),this._toolbar("variable","v")}}class Bb extends o{constructor(a){super(a,"video")}_getHtml(){return`
            <legend>${this._("Video")}</legend>
            <div data-required>
                <label for="editor-src">${this._("URL")}</label>
                <input id="editor-src" name="src" type="text" pattern="(https?|/).+" placeholder="${this._("Insert URL to media element")}" required />
            </div>
            <div>
                <label for="editor-width">${this._("Width")}</label>
                <input id="editor-width" name="width" type="number" />
            </div>
            <div>
                <label for="editor-height">${this._("Height")}</label>
                <input id="editor-height" name="height" type="number" />
            </div>
        `}}class Cb extends k{constructor(a){super(a);this.editor.root.addEventListener("sethtml",this),this.editor.root.addEventListener("insertvideo",this)}sethtml(a){Array.from(a.detail.element.getElementsByTagName("video")).forEach(b=>this.__init(b))}insertvideo(a){this.__init(a.detail.element)}__init(a){const b=a.getAttribute("src");b?(a.setAttribute("src",this.editor.url(b)),a.controls=!0,this.editor.wrap(a,"figure",{attributes:{class:"video"}})):a.parentElement.removeChild(a)}}const Db={de:{Cancel:"Abbrechen",Height:"Höhe","Insert URL to media element":"URL zum Medienelement eingeben",Save:"Speichern",URL:"URL",Video:"Video",Width:"Breite"}};class Eb extends h{static get name(){return"video"}static get dependencies(){return[i,u]}static get config(){return{browser:null}}init(){this._i18n(Db),this._tag({name:"video",group:"video",attributes:["controls","height","src","width"],empty:!0,navigable:!0}),new Cb(this.editor),this.editor.config.video.browser?this.editor.dialogs.set(new w(this.editor,"video",this.editor.config.video.browser)):this.editor.dialogs.set(new Bb(this.editor)),this._command("video"),this._toolbar("Video")}}class Fb extends t{static get defaultConfig(){return{base:{plugins:[_,ca,ha,ja,la,na,pa,ta,wa,ya,Aa,Da,Ha,Ja,La,Pa,Ra,Ua,Xa,Za,$a,cb,eb,gb,ib,kb,mb,ob,ub,wb,yb,Ab,Eb]}}}}export default Fb;
