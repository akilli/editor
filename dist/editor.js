var ni=Object.defineProperty,l=(e,t,i)=>(typeof t!="symbol"&&(t+=""),t in e?ni(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i);class S{constructor(e,t,i=null){l(this,"_editor");l(this,"name");l(this,"_tag",null);l(this,"_dialog",null);if(!(e instanceof _)||!t||typeof t!="string"||i&&typeof i!="string")throw"Invalid argument";this._editor=e,this.name=t,this._tag=i?this._editor.tags.get(i):null,this._dialog=this._editor.dialogs.get(t)}execute(){this._dialog?this._openDialog():this._insert(this._selectedAttributes())}_insert(e={}){if(this._tag){Object.keys(e).forEach(i=>this._tag.attributes.includes(i)&&e[i]||delete e[i]);const t=this._selectedElement();this._tag.group!=="format"?this._editor.insert(this._editor.createElement(this._tag.name,{attributes:e})):t&&Object.keys(e).length>0?t.parentElement.replaceChild(this._editor.createElement(this._tag.name,{attributes:e,html:t.textContent}),t):t?t.parentElement.replaceChild(this._editor.createText(t.textContent),t):this._editor.format(this._editor.createElement(this._tag.name,{attributes:e}))}}_openDialog(){this._dialog.open(e=>this._insert(e),this._selectedAttributes())}_selectedElement(){const e=this._editor.getSelectedElement();return e&&e.localName===this._tag?.name?e:null}_selectedAttributes(){const e=this._selectedElement(),t={};return e&&this._tag&&Array.from(e.attributes).forEach(i=>{this._tag.attributes.includes(i.nodeName)&&(t[i.nodeName]=i.nodeValue)}),t}}class H{constructor(e=[]){l(this,"__items",new Map);e.forEach(t=>this.set(t))}get(e){return this.__items.get(e)||null}set(e){if(!(e instanceof S))throw"Invalid argument";this.__items.set(e.name,e)}execute(e){this.get(e).execute()}}class A{constructor(e=[]){l(this,"__items",new Map);e.forEach(t=>this.set(t))}get(e){return this.__items.get(e)||null}set(e){if(!(e instanceof p))throw"Invalid argument";this.__items.set(e.name,e)}}class T{constructor(e){l(this,"__element");if(!(e instanceof HTMLElement))throw"Invalid argument";this.__element=e,this.register(this.__observe.bind(this))}dispatch(e,t,i){if(!e||typeof e!="string"||!(t instanceof HTMLElement)||!(i instanceof HTMLElement))throw"Invalid argument";this.__element.dispatchEvent(new CustomEvent(e,{detail:{element:t,target:i}}))}register(e,t={childList:!0,subtree:!0}){if(typeof e!="function")throw"Invalid argument";const i=new MutationObserver(e);i.observe(this.__element,t)}__dispatch(e,t,i){t instanceof HTMLElement&&i instanceof HTMLElement&&(this.dispatch(e,t,i),this.dispatch(`${e}${t.localName.replace("-","")}`,t,i))}__observe(e){e.forEach(t=>{t.addedNodes.forEach(i=>{i instanceof HTMLElement&&(this.__dispatch("insert",i,t.target),Array.from(i.getElementsByTagName("*")).forEach(r=>this.__dispatch("insert",r,t.target)))}),t.removedNodes.forEach(i=>i instanceof HTMLElement&&this.__dispatch("delete",i,t.target))})}}class g{constructor(e){l(this,"_editor");if(!(e instanceof _))throw"Invalid argument";this._editor=e}filter(e){throw"Not implemented"}}class I{constructor(){l(this,"__items",new Set)}add(e){if(!(e instanceof g))throw"Invalid argument";this.__items.add(e)}filter(e){if(!(e instanceof HTMLElement))throw"Invalid argument";this.__items.forEach(t=>{e.normalize(),t.filter(e)})}}class v{constructor({name:e,group:t,...i}={}){l(this,"name");l(this,"group");l(this,"children",[]);l(this,"attributes",[]);l(this,"alignable",!1);l(this,"arbitrary",!1);l(this,"deletable",!1);l(this,"editable",!1);l(this,"empty",!1);l(this,"focusable",!1);l(this,"navigable",!1);l(this,"slotable",!1);l(this,"sortable",!1);l(this,"enter",null);const r=o=>o&&typeof o=="string",s=o=>typeof o=="undefined"||o&&typeof o=="string",d=o=>typeof o=="undefined"||Array.isArray(o)&&!o.find(c=>!r(c));if(!r(e)||!r(t)||!s(i.enter)||!d(i.children)||!d(i.attributes))throw"Invalid argument";this.name=e,this.group=t,this.children=i.children||[],this.attributes=i.attributes||[],this.arbitrary=i.arbitrary===!0,this.alignable=i.alignable===!0,this.deletable=i.deletable===!0,this.editable=i.editable===!0,this.empty=i.empty===!0,this.focusable=i.focusable===!0,this.navigable=i.navigable===!0,this.slotable=i.slotable===!0,this.sortable=i.sortable===!0,this.enter=i.enter||null}}class n{constructor(e){l(this,"_editor");if(!(e instanceof _))throw"Invalid argument";this._editor=e}static get name(){throw"Missing plugin name"}static get dependencies(){return[]}static get config(){return{}}init(){throw"Not implemented"}_(e){return this._editor.translator.translate(this.constructor.name,e)}_i18n(e){e[this._editor.config.base.lang]&&this._editor.translator.set(this.constructor.name,e[this._editor.config.base.lang])}_command(e){this._editor.commands.set(new S(this._editor,this.constructor.name,e))}_tag(e){this._editor.tags.set(new v(e))}_toolbar(e,t=null,i=!1){if(!e||typeof e!="string"||t&&typeof t!="string")throw"Invalid argument";e=this._(e);const r=this._editor.createElement("button",{attributes:{type:"button","data-command":this.constructor.name,title:e,"data-key":t},html:e});i?this._editor.formats.appendChild(r):this._editor.toolbar.appendChild(r)}}class B{constructor(e=[]){l(this,"__items",new Map);e.forEach(t=>this.set(t))}get(e){return this.__items.get(e)||null}set(e){if(!(e instanceof n))throw"Invalid argument";this.__items.set(e.constructor.name,e)}init(){this.__items.forEach(e=>e.init())}}class P{constructor(e=[]){l(this,"__items",new Map);e.forEach(t=>this.set(t))}get(e){return this.__items.get(e instanceof HTMLElement?e.localName:e)||null}set(e){if(!(e instanceof v))throw"Invalid argument";this.__items.set(e.name,e)}allowed(e,t,i=!1){const r=i?t:this.get(t)?.group;return!!this.get(e)?.children.includes(r)}}class O{constructor(){l(this,"__items",new Map)}get(e){return this.__items.get(e)||null}set(e,t){if(!e||typeof e!="string"||!(t instanceof Object))throw"Invalid argument";this.__items.set(e,t)}translate(e,t){return this.get(e)?.[t]||t}}class _{constructor(e,t={}){l(this,"orig");l(this,"document");l(this,"window");l(this,"element");l(this,"toolbar");l(this,"toolbarEvents");l(this,"formats");l(this,"formatsEvents");l(this,"root");l(this,"rootEvents");l(this,"config",{});l(this,"translator",new O);l(this,"tags",new P);l(this,"filters",new I);l(this,"dialogs",new A);l(this,"commands",new H);l(this,"plugins",new B);if(!(e instanceof HTMLElement)||!(t instanceof Object))throw"Invalid argument";this.orig=e,this.document=this.orig.ownerDocument,this.window=this.document.defaultView,this.element=this.createElement("akilli-editor"),this.toolbar=this.createElement("editor-toolbar",{attributes:{role:"toolbar"}}),this.element.appendChild(this.toolbar),this.toolbarEvents=new T(this.toolbar),this.formats=this.createElement("editor-formats",{attributes:{role:"toolbar"}}),this.formats.hidden=!0,this.element.appendChild(this.formats),this.formatsEvents=new T(this.formats),this.root=this.createElement("editor-root"),this.element.appendChild(this.root),this.rootEvents=new T(this.root),this.config=t}static get defaultConfig(){return{}}init(){const e=this.config;this.config={};const t=this.constructor.defaultConfig.base?.plugins||[];let i=t;Array.isArray(e.base?.plugins)&&e.base.plugins.length>0&&(i=[],e.base.plugins.forEach(d=>{const o=t.find(c=>c.name===d);o&&i.push(o)}));const r=new Set,s=d=>{d.dependencies&&d.dependencies.forEach(s),r.add(d)};i.map(s),r.forEach(d=>{Object.entries(d.config).forEach(([o,c])=>{this.config.hasOwnProperty(d.name)||(this.config[d.name]={}),this.config[d.name][o]=e[d.name]?.[o]||this.constructor.defaultConfig[d.name]?.[o]||c}),this.plugins.set(new d(this))}),this.plugins.init()}load(){this.orig instanceof HTMLTextAreaElement?(this.orig.form.addEventListener("submit",()=>this.save()),this.setHtml(this.orig.value.replace("/&nbsp;/g"," "))):this.setHtml(this.orig.innerHTML),this.orig.insertAdjacentElement("afterend",this.element),this.orig.hidden=!0}destroy(){this.element.parentElement.removeChild(this.element),this.orig.hidden=!1}getHtml(){const e=this.createElement(this.root.localName,{html:this.root.innerHTML});return this.filters.filter(e),this.rootEvents.dispatch("gethtml",e,this.root),e.innerHTML}setHtml(e){const t=this.createElement(this.root.localName,{html:e});this.rootEvents.dispatch("sethtml",t,this.root),this.filters.filter(t),this.root.innerHTML=t.innerHTML}save(){this.orig instanceof HTMLTextAreaElement?this.orig.value=this.getHtml():this.orig.innerHTML=this.getHtml()}insert(e){if(!(e instanceof HTMLElement))throw"Invalid argument";const t=this.getSelectedEditable();if(t&&t instanceof HTMLSlotElement&&this.tags.allowed(t.parentElement,e))t.insertAdjacentElement("beforebegin",e);else if(t)this.closest(t,e)?.insertAdjacentElement("afterend",e),t.hasAttribute("data-deletable")&&!t.textContent.trim()&&t.parentElement.removeChild(t);else if(this.tags.allowed(this.root,e))this.root.appendChild(e);else throw"Invalid argument"}insertText(e){const t=this.getSelectedEditable();if(t){const i=this.window.getSelection().getRangeAt(0);i.deleteContents(),i.insertNode(this.createText(e)),i.collapse(),t.normalize()}}format(e){if(!(e instanceof HTMLElement))throw"Invalid argument";const t=this.window.getSelection(),i=t.rangeCount>0?t.getRangeAt(0):null,r=this.getSelectedEditable();if(!i||i.collapsed||!i.toString().trim()||!r||!this.tags.allowed(r,e))return;i.startContainer instanceof Text&&i.startContainer.parentElement!==r&&i.setStartBefore(i.startContainer.parentElement),i.endContainer instanceof Text&&i.endContainer.parentElement!==r&&i.setEndAfter(i.endContainer.parentElement);const s=i.toString(),d=Array.from(i.cloneContents().childNodes).every(o=>o instanceof Text&&!o.textContent.trim()||o instanceof HTMLElement&&o.localName===e.localName);i.deleteContents(),d?i.insertNode(this.createText(s)):(e.textContent=s,i.insertNode(e)),r.normalize()}arbitrary(e){return e instanceof HTMLElement&&(e===this.root||e.hasAttribute("data-arbitrary"))}closest(e,t){if(!(e instanceof HTMLElement)||!this.contains(e.parentElement))throw"Invalid argument";let i=e,r=e.parentElement;do if(this.arbitrary(r)&&this.tags.allowed(r,t))return i;while((i=r)&&(r=r.parentElement)&&this.contains(r));return null}wrap(e,t,i={}){let r;if(e instanceof HTMLElement){if(e.parentElement.localName!==t&&(r=this.closest(e,t))){const s=this.createElement(t,i);r.insertAdjacentElement("afterend",s),s.appendChild(e)}}else throw"Invalid argument"}contains(e){if(!(e instanceof HTMLElement))throw"Invalid argument";return this.root.contains(e)||e.closest(this.root.localName)?.parentElement===null}registerElement(e,t,i=null){typeof this.window.customElements.get(e)=="undefined"&&this.window.customElements.define(e,t,i?{extends:i}:null)}createElement(e,{attributes:t={},html:i=""}={}){const r=this.document.createElement(e);return r.innerHTML=i,Object.entries(t).forEach(([s,d])=>d&&r.setAttribute(s,`${d}`)),r}createText(e){return this.document.createTextNode(e)}getSelectedElement(){try{const e=this.window.getSelection(),t=e.anchorNode instanceof Text?e.anchorNode.parentElement:e.anchorNode,i=e.focusNode instanceof Text?e.focusNode.parentElement:e.focusNode;if(t instanceof HTMLElement&&i instanceof HTMLElement&&t===i&&this.contains(t))return t}catch(e){this.window.console.error(e)}return null}getSelectedEditable(){try{const e=this.window.getSelection(),t=e.anchorNode instanceof Text?e.anchorNode.parentElement:e.anchorNode,i=e.focusNode instanceof Text?e.focusNode.parentElement:e.focusNode;if(t instanceof HTMLElement&&i instanceof HTMLElement){const r=t.closest("[contenteditable=true]"),s=i.closest("[contenteditable=true]");if(r instanceof HTMLElement&&r===s&&this.contains(r))return r}}catch(e){this.window.console.error(e)}return null}focusEnd(e){if(!(e instanceof HTMLElement))throw"Invalid argument";const t=this.document.createRange(),i=this.window.getSelection();e.focus(),t.selectNodeContents(e),t.collapse(),i.removeAllRanges(),i.addRange(t)}isKey(e,t,{alt:i=!1,ctrl:r=!1,shift:s=!1}={}){return(Array.isArray(t)&&t.includes(e.key)||e.key===t)&&e.altKey===i&&e.ctrlKey===r&&e.shiftKey===s}url(e){const t=this.window.origin||this.window.location.origin,i=this.createElement("a",{attributes:{href:e}});return t===i.origin?i.pathname:i.href}static create(e,t={}){const i=new this(e,t);return i.init(),i.load(),i}}class p{constructor(e,t){l(this,"_editor");l(this,"name");if(!(e instanceof _)||!t||typeof t!="string")throw"Invalid argument";this._editor=e,this.name=t}open(e,t={}){const i=()=>Array.from(this._editor.element.getElementsByTagName("editor-dialog")).forEach(h=>{h.parentElement.removeChild(h)}),r=this._editor.window.getSelection(),s=r.rangeCount>0?r.getRangeAt(0):null,d=()=>{s&&(r.removeAllRanges(),r.addRange(s)),i()};i();const o=this._editor.createElement("form"),c=this._editor.createElement("fieldset"),E=this._editor.createElement("button",{attributes:{type:"button"},html:this._("Cancel")});E.addEventListener("click",d),o.appendChild(c),o.appendChild(E),o.appendChild(this._editor.createElement("button",{html:this._("Save")})),this._initFieldset(c),o.addEventListener("submit",h=>{h.preventDefault(),h.stopPropagation(),d();const b={};Array.from(c.elements).forEach(D=>b[D.name]=D.value),e(b)}),Object.entries(t).forEach(([h,b])=>c.elements[h]&&(c.elements[h].value=b));const y=this._editor.createElement("editor-dialog");y.addEventListener("close",d),y.appendChild(o),y.show(),this._editor.element.appendChild(y)}_(e){return this._editor.translator.translate(this.name,e)}_initFieldset(e){throw"Not implemented"}_createInput(e,t,i,r={}){if(!e||typeof e!="string"||!t||typeof t!="string"||!i||typeof i!="string")throw"Invalid argument";Object.assign(r,{id:`editor-${e}`,name:e,type:t});const s=this._editor.createElement("div");return s.appendChild(this._editor.createElement("label",{attributes:{for:r.id},html:i})),s.appendChild(this._editor.createElement("input",{attributes:r})),r.required&&s.setAttribute("data-required",""),s}}class F extends p{constructor(e){super(e,"abbreviation")}_initFieldset(e){e.appendChild(this._editor.createElement("legend",{html:this._("Abbreviation")})),e.appendChild(this._createInput("title","text",this._("Full term"),{placeholder:this._("Insert full term or leave empty to remove it")}))}}class m{constructor(e){l(this,"_editor");if(!(e instanceof _))throw"Invalid argument";this._editor=e}handleEvent(e){typeof this[e.type]=="function"&&this[e.type](e)}}class R extends m{constructor(e){super(e);this._editor.root.addEventListener("insert",this)}insert(e){e.detail.element.hasAttribute("data-alignable")&&e.detail.element.addEventListener("keydown",this)}keydown(e){const t={ArrowUp:null,ArrowLeft:"left",ArrowDown:"center",ArrowRight:"right"};e.target===e.currentTarget&&this._editor.isKey(e,Object.keys(t),{shift:!0})&&(e.preventDefault(),e.stopPropagation(),e.target.classList.remove(...Object.values(t)),t[e.key]&&e.target.classList.add(t[e.key]))}}class z extends g{filter(e){const t=this._editor.tags.get(e),i=this._editor.tags.allowed(e,"p"),r=t.editable||t.group==="format";let s=[];const d=(o=null)=>{i&&s.length>0&&(e.insertBefore(this._editor.createElement("p",{html:s.join(" ")}),o),s=[])};Array.from(e.childNodes).forEach(o=>{const c=o.textContent.trim();if(o instanceof HTMLElement){o=this.__convert(o);const E=this._editor.tags.get(o);E&&this._editor.tags.allowed(e,o)?(d(o),this.__element(o,E)):E&&E.group==="format"&&i?(o=this.__element(o,E))&&(s.push(o.outerHTML),e.removeChild(o)):!r&&c&&i?(s.push(c),e.removeChild(o)):r&&c?e.replaceChild(this._editor.createText(c),o):e.removeChild(o)}else o instanceof Text?(!r&&c&&i&&s.push(c),(!r||!c)&&e.removeChild(o)):o instanceof Node&&e.removeChild(o)}),d()}__convert(e){const t=this._editor.config.base.filter[e.localName];if(!t)return e;const i=this._editor.createElement(t,{html:e.innerHTML});return e.parentElement.replaceChild(i,e),i}__element(e,t){return Array.from(e.attributes).forEach(i=>!t.attributes.includes(i.name)&&e.removeAttribute(i.name)),e.hasChildNodes()&&this._editor.filters.filter(e),e.hasChildNodes()||t.empty?e:(e.parentElement.removeChild(e),null)}}class N extends m{constructor(e){super(e);this._editor.root.addEventListener("insert",this)}insert(e){e.detail.element.hasAttribute("data-deletable")&&e.detail.element.addEventListener("keydown",this)}keydown(e){e.target===e.currentTarget&&this._editor.isKey(e,"Delete",{ctrl:!0})&&(e.target.previousElementSibling instanceof HTMLElement&&this._editor.focusEnd(e.target.previousElementSibling),e.target.parentElement.removeChild(e.target),e.preventDefault(),e.stopPropagation())}}class q extends HTMLElement{constructor(){super();this.addEventListener("keydown",e=>e.key==="Escape"&&this.close()),this.addEventListener("click",e=>e.target===this&&this.close())}connectedCallback(){this.setAttribute("role","dialog"),this.tabIndex=-1,this.focus()}get open(){return this.hasAttribute("open")}set open(e){e===!0?this.setAttribute("open",""):this.removeAttribute("open")}show(){this.open=!0,this.dispatchEvent(new CustomEvent("show",{detail:{element:this,target:this}}))}close(){this.open=!1,this.dispatchEvent(new CustomEvent("close",{detail:{element:this,target:this}}))}}class U extends m{constructor(e){super(e);this._editor.root.addEventListener("insert",this)}insert(e){e.detail.element.contentEditable==="true"&&e.detail.element.addEventListener("keydown",this)}keydown(e){if(this._editor.isKey(e,"Enter",{shift:!0})&&!this._editor.tags.allowed(e.target,"br"))e.preventDefault(),e.stopPropagation();else if(this._editor.isKey(e,"Enter")){e.preventDefault(),e.stopPropagation();const t=this._editor.tags.get(e.target)?.enter;t&&(e.target.textContent.trim()||!e.target.hasAttribute("data-deletable")?this._editor.closest(e.target,t)?.insertAdjacentElement("afterend",this._editor.createElement(t)):e.target instanceof HTMLParagraphElement||(this._editor.closest(e.target,"p")?.insertAdjacentElement("afterend",this._editor.createElement("p")),e.target.parentElement.removeChild(e.target)))}else this._editor.isKey(e,"Backspace")&&!e.target.textContent&&e.target.hasAttribute("data-deletable")?(e.target.previousElementSibling instanceof HTMLElement&&this._editor.focusEnd(e.target.previousElementSibling),e.target.parentElement.removeChild(e.target),e.preventDefault(),e.stopPropagation()):/^[A-Z]$/.test(e.key)&&this._editor.isKey(e,e.key,{alt:!0,shift:!0})&&(e.preventDefault(),e.stopPropagation(),this._editor.formats.querySelector(`button[data-key=${e.key.toLowerCase()}]`)?.click())}}class K extends m{constructor(e){super(e);this._editor.root.addEventListener("insert",this)}insert(e){e.detail.element.hasAttribute("data-focusable")&&e.detail.element.focus()}}class V extends m{constructor(e){super(e);this._editor.root.addEventListener("insert",this)}insert(e){e.detail.element.hasAttribute("data-navigable")&&(e.detail.element.tabIndex=0,e.detail.element.addEventListener("keydown",this))}keydown(e){if(e.target===e.currentTarget&&this._editor.isKey(e,["ArrowUp","ArrowDown","Home","End"])&&this.__enabled(e.target)){const t=e.target.previousElementSibling,i=e.target.nextElementSibling,r=e.target.parentElement.firstElementChild,s=e.target.parentElement.lastElementChild,d=e.target===r,o=e.target===s;e.key==="ArrowUp"&&!d&&t.hasAttribute("data-navigable")?t.focus():e.key==="ArrowDown"&&!o&&i.hasAttribute("data-navigable")?i.focus():(e.key==="Home"||e.key==="ArrowDown"&&o)&&r.hasAttribute("data-navigable")?r.focus():(e.key==="End"||e.key==="ArrowUp"&&d)&&s.hasAttribute("data-navigable")&&s.focus(),e.preventDefault(),e.stopPropagation()}}__enabled(e){if(e.contentEditable!=="true")return!0;const t=this._editor.window.getSelection(),i=this._editor.getSelectedEditable(),r=this._editor.getSelectedElement();return t.isCollapsed&&t.anchorOffset===0&&[i,e.firstChild].includes(r)}}class Q extends m{constructor(e){super(e);this._editor.root.addEventListener("insert",this)}insert(e){e.detail.element instanceof HTMLSlotElement?e.detail.element.addEventListener("keydown",this):e.detail.element.hasAttribute("data-slotable")&&!e.detail.element.querySelector(":scope > slot")&&e.detail.element.appendChild(this._editor.createElement("slot"))}keydown(e){e.preventDefault(),e.stopPropagation()}}class $ extends m{constructor(e){super(e);this._editor.root.addEventListener("insert",this)}insert(e){e.detail.element.hasAttribute("data-sortable")&&(e.detail.element.addEventListener("keydown",this),e.detail.element.addEventListener("pointerdown",this),e.detail.element.addEventListener("pointermove",this),e.detail.element.addEventListener("pointerup",this))}keydown(e){if(e.target===e.currentTarget&&this._editor.isKey(e,["ArrowUp","ArrowDown","Home","End"],{ctrl:!0})){const t=e.target.parentElement,i=e.target.previousElementSibling,r=e.target.nextElementSibling,s=t.firstElementChild,d=t.lastElementChild,o=e.target===s,c=e.target===d;e.key==="ArrowUp"&&!o&&i.hasAttribute("data-sortable")?(i.insertAdjacentHTML("beforebegin",e.target.outerHTML),t.removeChild(e.target)):e.key==="ArrowDown"&&!c&&r.hasAttribute("data-sortable")?(r.insertAdjacentHTML("afterend",e.target.outerHTML),t.removeChild(e.target)):(e.key==="Home"&&!o||e.key==="ArrowDown"&&c)&&s.hasAttribute("data-sortable")?(s.insertAdjacentHTML("beforebegin",e.target.outerHTML),t.removeChild(e.target)):(e.key==="End"&&!c||e.key==="ArrowUp"&&o)&&d.hasAttribute("data-sortable")&&(d.insertAdjacentHTML("afterend",e.target.outerHTML),t.removeChild(e.target)),e.preventDefault(),e.stopPropagation()}}pointerdown(e){e.target.hasAttribute("data-sortable")&&(e.target.setAttribute("data-sort",""),e.target.setPointerCapture(e.pointerId))}pointermove(e){const t=this._editor.document.elementFromPoint(e.x,e.y);this.__sortover(),this.__droppable(e.target,t)&&t.setAttribute("data-sortover","")}pointerup(e){if(e.target.hasAttribute("data-sortable")){const t=this._editor.document.elementFromPoint(e.x,e.y);this.__sortover(),e.target.removeAttribute("data-sort"),e.target.releasePointerCapture(e.pointerId),this.__droppable(e.target,t)&&t.insertAdjacentElement("beforebegin",e.target)}}__sortover(){this._editor.root.querySelectorAll("[data-sortover]").forEach(e=>e.removeAttribute("data-sortover"))}__droppable(e,t){return e instanceof HTMLElement&&t instanceof HTMLElement&&this._editor.contains(t)&&![this._editor.root,e].includes(t)&&t.hasAttribute("data-sortable")&&(e.parentElement===t.parentElement||this._editor.arbitrary(e.parentElement)&&this._editor.arbitrary(t.parentElement))&&this._editor.tags.allowed(t.parentElement,e)}}class W extends m{constructor(e){super(e);this._editor.root.addEventListener("insert",this)}insert(e){const t=this._editor.tags.get(e.detail.element);t&&(t.editable&&(e.detail.element.contentEditable="true"),["alignable","arbitrary","deletable","focusable","navigable","slotable","sortable"].forEach(i=>{t[i]&&(e.detail.element.dataset[i]="")}))}}class Z extends m{constructor(e){super(e);this._editor.toolbar.addEventListener("insertbutton",this),this._editor.formats.addEventListener("insertbutton",this),this._editor.document.addEventListener("selectionchange",this)}insertbutton(e){const t=e.detail.element.getAttribute("data-key");if(t){const i=this._editor.translator.translate("base","Alt"),r=this._editor.translator.translate("base","Shift");e.detail.element.title+=` [${i} + ${r} + ${t}]`}e.detail.element.getAttribute("data-command")&&e.detail.element.addEventListener("click",this),e.detail.element.parentElement===this._editor.toolbar&&(e.detail.element.tabIndex=-1,e.detail.element.addEventListener("keydown",this))}click(e){this._editor.commands.execute(e.target.getAttribute("data-command"))}keydown(e){if(this._editor.isKey(e,["ArrowLeft","ArrowRight","Home","End"])){const t=e.target.previousElementSibling,i=e.target.nextElementSibling,r=e.target.parentElement.firstElementChild,s=e.target.parentElement.lastElementChild,d=e.target===r,o=e.target===s;e.key==="ArrowLeft"&&!d?t.focus():e.key==="ArrowRight"&&!o?i.focus():e.key==="Home"||e.key==="ArrowRight"&&o?r.focus():(e.key==="End"||e.key==="ArrowLeft"&&d)&&s.focus(),e.preventDefault(),e.stopPropagation()}}selectionchange(){const e=this._editor.getSelectedEditable();e&&!this._editor.window.getSelection().isCollapsed&&this._editor.tags.allowed(e,"format",!0)?(this._editor.formats.hidden=!1,this._editor.formats.style.top=`${e.offsetTop+e.offsetParent.offsetTop-this._editor.formats.clientHeight}px`):(this._editor.formats.hidden=!0,this._editor.formats.removeAttribute("style"))}}var ft={de:{Alt:"Alt",Shift:"Umschalt"}};class a extends n{static get name(){return"base"}static get config(){return{browser:{},filter:{},lang:null,plugins:[]}}init(){this._i18n(ft),this._editor.registerElement("editor-dialog",q),this._tag({name:"editor-root",group:"root",children:["audio","block","container","figure","heading","iframe","image","list","paragraph","preformat","quote","rule","table","video"]}),this._tag({name:"slot",group:"slot",editable:!0,focusable:!0,navigable:!0,sortable:!0}),new Z(this._editor),new W(this._editor),new U(this._editor),new N(this._editor),new V(this._editor),new $(this._editor),new R(this._editor),new K(this._editor),new Q(this._editor),this._editor.filters.add(new z(this._editor))}}var bt={de:{Abbreviation:"Abk\xFCrzung",Cancel:"Abbrechen","Full term":"Langform","Insert full term or leave empty to remove it":"Langform eingeben oder zum Entfernen leer lassen",Save:"Speichern"}};class G extends n{static get name(){return"abbreviation"}static get dependencies(){return[a]}init(){this._i18n(bt),this._tag({name:"abbr",group:"format",attributes:["title"]}),this._editor.dialogs.set(new F(this._editor)),this._command("abbr"),this._toolbar("Abbreviation","a",!0)}}class J extends p{constructor(e){super(e,"audio")}_initFieldset(e){e.appendChild(this._editor.createElement("legend",{html:this._("Audio")})),e.appendChild(this._createInput("src","text",this._("URL"),{pattern:"(https?|/).+",placeholder:this._("Insert URL to audio"),required:"required"}))}}class X extends m{constructor(e){super(e);this._editor.root.addEventListener("sethtml",this),this._editor.root.addEventListener("insertaudio",this)}sethtml(e){Array.from(e.detail.element.getElementsByTagName("audio")).forEach(t=>this.__init(t))}insertaudio(e){this.__init(e.detail.element)}__init(e){const t=e.getAttribute("src");t?(e.setAttribute("src",this._editor.url(t)),e.controls=!0,this._editor.wrap(e,"figure",{attributes:{class:"audio"}})):e.parentElement.removeChild(e)}}class L extends p{constructor(e,t,i){super(e,t);l(this,"__url");l(this,"opts",Object.assign({alwaysRaised:"yes",dependent:"yes",height:`${this._editor.window.screen.height}`,location:"no",menubar:"no",minimizable:"no",modal:"yes",resizable:"yes",scrollbars:"yes",toolbar:"no",width:`${this._editor.window.screen.width}`},this._editor.config.base.browser));if(!i||typeof i!="string")throw"Invalid argument";this.__url=i}open(e,t={}){const i=Object.entries(this.opts).map(o=>`${o[0]}=${o[1]}`).join(","),r=this._editor.createElement("a",{attributes:{href:this.__url}}),s=new URL(r.href);Object.entries(t).forEach(([o,c])=>s.searchParams.set(o,`${c}`));const d=this._editor.window.open(s.toString(),this.name,i);this._editor.window.addEventListener("message",o=>{o.origin===s.origin&&o.source===d&&(e(o.data),d.close())},!1)}}class Y extends g{filter(e){e.querySelectorAll("figure > figcaption:only-child").forEach(t=>t.parentElement.removeChild(t))}}class ee extends m{constructor(e){super(e);this._editor.root.addEventListener("insertfigure",this)}insertfigure(e){e.detail.element.querySelector(":scope > figcaption")||e.detail.element.appendChild(this._editor.createElement("figcaption"))}}class f extends n{static get name(){return"figure"}static get dependencies(){return[a]}init(){this._tag({name:"figure",group:"figure",children:["audio","caption","iframe","image","preformat","quote","table","video"],attributes:["class"],alignable:!0,deletable:!0,focusable:!0,navigable:!0,sortable:!0}),this._tag({name:"figcaption",group:"caption",children:["format"],editable:!0,navigable:!0,enter:"p"}),new ee(this._editor),this._editor.filters.add(new Y(this._editor))}}var _t={de:{Audio:"Audio",Cancel:"Abbrechen","Insert URL to audio":"URL zur Audiodatei eingeben",Save:"Speichern",URL:"URL"}};class te extends n{static get name(){return"audio"}static get dependencies(){return[a,f]}static get config(){return{browser:null}}init(){this._i18n(_t),this._tag({name:"audio",group:"audio",attributes:["controls","src"],empty:!0,navigable:!0}),new X(this._editor),this._editor.config.audio.browser?this._editor.dialogs.set(new L(this._editor,"audio",this._editor.config.audio.browser)):this._editor.dialogs.set(new J(this._editor)),this._command("audio"),this._toolbar("Audio")}}class ie extends p{constructor(e){super(e,"block")}_initFieldset(e){e.appendChild(this._editor.createElement("legend",{html:this._("Block")})),e.appendChild(this._createInput("id","text",this._("ID"),{required:"required"}))}}class re extends HTMLElement{constructor(){super();this.attachShadow({mode:"open"})}get content(){return this.shadowRoot.innerHTML}set content(e){this.shadowRoot.innerHTML=e}}class ne extends m{constructor(e){super(e);this._editor.root.addEventListener("sethtml",this),this._editor.root.addEventListener("inserteditorblock",this)}sethtml(e){Array.from(e.detail.element.getElementsByTagName("editor-block")).forEach(t=>t.id||t.parentElement.removeChild(t))}async inserteditorblock(e){if(e.detail.element.id){if(!this._editor.config.block.api)return}else{e.detail.element.parentElement.removeChild(e.detail.element);return}try{const t=await fetch(this._editor.config.block.api.replace("{id}",e.detail.element.id),{mode:"no-cors"});if(t.ok){let i="";this._editor.config.block.css&&(i=this._editor.config.block.css.split(",").map(s=>`<link rel="stylesheet" href="${s}">`).join(""));const r=await t.text();e.detail.element.content=i+r}}catch(t){this._editor.window.console.error(t)}}}var C={de:{Cancel:"Abbrechen",Height:"H\xF6he",Ifrane:"Iframe","Insert URL to embedded page":"URL zur eingebetteten Seite eingeben",Save:"Speichern",URL:"URL",Width:"Breite"}};class ae extends n{static get name(){return"block"}static get dependencies(){return[a]}static get config(){return{api:null,browser:null,css:null}}init(){this._i18n(C),this._editor.registerElement("editor-block",re),this._tag({name:"editor-block",group:"block",attributes:["id"],deletable:!0,empty:!0,focusable:!0,navigable:!0,sortable:!0}),new ne(this._editor),this._editor.config.block.browser?this._editor.dialogs.set(new L(this._editor,"block",this._editor.config.block.browser)):this._editor.dialogs.set(new ie(this._editor)),this._command("editor-block"),this._toolbar("Block")}}class se extends g{filter(e){e instanceof HTMLElement&&e.localName==="figure"&&e.classList.contains("quote")&&e.querySelector(":scope > blockquote")&&!e.querySelector(":scope > figcaption")&&(e.insertAdjacentElement("beforebegin",e.querySelector(":scope > blockquote")),e.innerHTML="")}}class oe extends m{constructor(e){super(e);this._editor.root.addEventListener("insertblockquote",this),this._editor.root.addEventListener("deleteblockquote",this)}insertblockquote(e){this._editor.wrap(e.detail.element,"figure",{attributes:{class:"quote"}})}deleteblockquote(e){e.detail.target.localName==="figure"&&e.detail.target.classList.contains("quote")&&e.detail.target.parentElement.removeChild(e.detail.target)}}class le extends g{filter(e){if(e instanceof HTMLPreElement){e.outerHTML=e.outerHTML.replace(/(<br\s*\/?>)/gi,`
`);return}e.innerHTML=e.innerHTML.replace(/^\s*(<br\s*\/?>\s*)+/gi,"").replace(/\s*(<br\s*\/?>\s*)+$/gi,""),e instanceof HTMLParagraphElement?e.outerHTML=e.outerHTML.replace(/\s*(<br\s*\/?>\s*){2,}/gi,"</p><p>"):e.innerHTML=e.innerHTML.replace(/\s*(<br\s*\/?>\s*){2,}/gi,"<br>")}}class w extends n{static get name(){return"break"}static get dependencies(){return[a]}init(){this._tag({name:"br",group:"break",empty:!0}),this._editor.filters.add(new le(this._editor))}}var Et={de:{"Block Quote":"Blockzitat"}};class de extends n{static get name(){return"blockquote"}static get dependencies(){return[a,w,f]}init(){this._i18n(Et),this._tag({name:"blockquote",group:"quote",children:["break","format"],deletable:!0,editable:!0,navigable:!0,enter:"p"}),new oe(this._editor),this._command("blockquote"),this._toolbar("Block Quote"),this._editor.filters.add(new se(this._editor))}}var Lt={de:{bold:"fett"}};class me extends n{static get name(){return"bold"}static get dependencies(){return[a]}init(){this._i18n(Lt),this._tag({name:"b",group:"format"}),this._command("b"),this._toolbar("bold","b",!0)}}var wt={de:{Citation:"Zitatquelle"}};class ce extends n{static get name(){return"cite"}static get dependencies(){return[a]}init(){this._i18n(wt),this._tag({name:"cite",group:"format"}),this._command("cite"),this._toolbar("Citation","z",!0)}}var jt={de:{Code:"Quelltext"}};class pe extends n{static get name(){return"code"}static get dependencies(){return[a]}init(){this._i18n(jt),this._tag({name:"code",group:"format"}),this._command("code"),this._toolbar("Code","c",!0)}}class he extends p{constructor(e){super(e,"data")}_initFieldset(e){e.appendChild(this._editor.createElement("legend",{html:this._("Data")})),e.appendChild(this._createInput("value","text",this._("Machine-readable Value"),{placeholder:this._("Insert value or leave empty to remove it")}))}}var Dt={de:{Cancel:"Abbrechen",Data:"Data","Machine-readable Value":"Maschinenlesbarer Wert","Insert value or leave empty to remove it":"Wert eingeben oder zum Entfernen leer lassen",Save:"Speichern"}};class ue extends n{static get name(){return"data"}static get dependencies(){return[a]}init(){this._i18n(Dt),this._tag({name:"data",group:"format",attributes:["value"]}),this._editor.dialogs.set(new he(this._editor)),this._command("data"),this._toolbar("Data","j",!0)}}var yt={de:{Definition:"Definition"}};class ge extends n{static get name(){return"definition"}static get dependencies(){return[a]}init(){this._i18n(yt),this._tag({name:"dfn",group:"format"}),this._command("dfn"),this._toolbar("Definition","d",!0)}}var St={de:{"Text Deletion":"Textl\xF6schung"}};class fe extends n{static get name(){return"deletion"}static get dependencies(){return[a]}init(){this._i18n(St),this._tag({name:"del",group:"format"}),this._command("del"),this._toolbar("Text Deletion","g",!0)}}class be extends g{filter(e){e.querySelectorAll("summary:not(:first-child)").forEach(t=>t.parentElement.removeChild(t)),e.querySelectorAll("summary:only-child").forEach(t=>t.parentElement.removeChild(t))}}class _e extends m{constructor(e){super(e);this._editor.root.addEventListener("insertdetails",this),this._editor.root.addEventListener("insertsummary",this)}insertdetails(e){e.detail.element.open=!0,e.detail.element.querySelector(":scope > summary:first-child")||e.detail.element.insertAdjacentElement("afterbegin",this._editor.createElement("summary"))}insertsummary(e){this.__empty(e.detail.element),e.detail.element.addEventListener("blur",this),e.detail.element.addEventListener("keydown",this)}blur(e){this.__empty(e.target)}keydown(e){this._editor.isKey(e," ")?(e.preventDefault(),e.stopPropagation(),this._editor.insertText(" ")):this._editor.isKey(e,"Enter")&&(e.preventDefault(),e.stopPropagation(),e.target.parentElement.open=!0)}__empty(e){e.textContent.trim()?e.querySelectorAll("br:not(:last-child)").forEach(t=>t.parentElement.removeChild(t)):e.textContent=this._editor.translator.translate("details","Details"),e.lastElementChild instanceof HTMLBRElement||e.appendChild(this._editor.createElement("br"))}}var Tt={de:{Details:"Details"}};class Ee extends n{static get name(){return"details"}static get dependencies(){return[a]}init(){this._i18n(Tt),this._tag({name:"details",group:"container",children:["audio","figure","iframe","image","list","paragraph","preformat","quote","rule","summary","table","video"],arbitrary:!0,deletable:!0,focusable:!0,navigable:!0,slotable:!0,sortable:!0}),this._tag({name:"summary",group:"summary",editable:!0,navigable:!0,enter:"p"}),new _e(this._editor),this._command("details"),this._toolbar("Details"),this._editor.filters.add(new be(this._editor))}}class Le extends p{constructor(e){super(e,"division")}_initFieldset(e){e.appendChild(this._editor.createElement("legend",{html:this._("Division")})),e.appendChild(this._createInput("class","text",this._("CSS class"),{placeholder:this._("Insert CSS class")}))}}var vt={de:{Cancel:"Abbrechen","CSS class":"CSS-Klasse",Division:"Division","Insert CSS class":"CSS-Klasse eingeben",Save:"Speichern"}};class we extends n{static get name(){return"division"}static get dependencies(){return[a]}init(){this._i18n(vt),this._tag({name:"div",group:"container",children:["audio","block","figure","iframe","image","preformat","quote","rule","table","video"],attributes:["class"],arbitrary:!0,deletable:!0,focusable:!0,navigable:!0,slotable:!0,sortable:!0}),this._editor.dialogs.set(new Le(this._editor)),this._command("div"),this._toolbar("Division")}}var xt={de:{emphasized:"betont"}};class je extends n{static get name(){return"emphasis"}static get dependencies(){return[a]}init(){this._i18n(xt),this._tag({name:"em",group:"format"}),this._command("em"),this._toolbar("emphasized","e",!0)}}var Ct={de:{Heading:"\xDCberschrift"}};class De extends n{static get name(){return"heading"}static get dependencies(){return[a]}init(){this._i18n(Ct),this._tag({name:"h2",group:"heading",deletable:!0,editable:!0,focusable:!0,navigable:!0,sortable:!0,enter:"p"}),this._command("h2"),this._toolbar("Heading")}}var kt={de:{"Horizontal Rule":"Horizontale Linie"}};class ye extends n{static get name(){return"horizontalrule"}static get dependencies(){return[a]}init(){this._i18n(kt),this._tag({name:"hr",group:"rule",deletable:!0,empty:!0,focusable:!0,navigable:!0,sortable:!0}),this._command("hr"),this._toolbar("Horizontal Rule")}}class Se extends p{constructor(e){super(e,"iframe")}_initFieldset(e){e.appendChild(this._editor.createElement("legend",{html:this._("Iframe")})),e.appendChild(this._createInput("src","text",this._("URL"),{pattern:"(https?|/).+",placeholder:this._("Insert URL to embedded page"),required:"required"})),e.appendChild(this._createInput("width","number",this._("Width"))),e.appendChild(this._createInput("height","number",this._("Height")))}}class Te extends m{constructor(e){super(e);this._editor.root.addEventListener("sethtml",this),this._editor.root.addEventListener("insertiframe",this)}sethtml(e){Array.from(e.detail.element.getElementsByTagName("iframe")).forEach(t=>this.__init(t))}insertiframe(e){this.__init(e.detail.element)}__init(e){const t=e.getAttribute("src");t?(e.setAttribute("src",this._editor.url(t)),e.allowFullscreen=!0,this._editor.wrap(e,"figure",{attributes:{class:"iframe"}})):e.parentElement.removeChild(e)}}class ve extends n{static get name(){return"iframe"}static get dependencies(){return[a,f]}static get config(){return{browser:null}}init(){this._i18n(C),this._tag({name:"iframe",group:"iframe",attributes:["allowfullscreen","height","src","width"],empty:!0,navigable:!0}),new Te(this._editor),this._editor.config.iframe.browser?this._editor.dialogs.set(new L(this._editor,"iframe",this._editor.config.iframe.browser)):this._editor.dialogs.set(new Se(this._editor)),this._command("iframe"),this._toolbar("Iframe")}}class xe extends p{constructor(e){super(e,"image")}_initFieldset(e){e.appendChild(this._editor.createElement("legend",{html:this._("Image")})),e.appendChild(this._createInput("src","text",this._("URL"),{pattern:"(https?|/).+",placeholder:this._("Insert URL to image"),required:"required"})),e.appendChild(this._createInput("alt","text",this._("Alternative text"),{placeholder:this._("Replacement text for use when media elements are not available")})),e.appendChild(this._createInput("width","number",this._("Width"))),e.appendChild(this._createInput("height","number",this._("Height")))}}class Ce extends m{constructor(e){super(e);this._editor.root.addEventListener("sethtml",this),this._editor.root.addEventListener("insertimg",this)}sethtml(e){Array.from(e.detail.element.getElementsByTagName("img")).forEach(t=>this.__init(t))}insertimg(e){this.__init(e.detail.element)}__init(e){const t=e.getAttribute("src");t?(e.setAttribute("src",this._editor.url(t)),this._editor.wrap(e,"figure",{attributes:{class:"image"}})):e.parentElement.removeChild(e)}}var Mt={de:{"Alternative text":"Alternativtext",Cancel:"Abbrechen",Height:"H\xF6he",Image:"Bild","Insert URL to image":"URL zur Bilddatei eingeben","Replacement text for use when media elements are not available":"Ersatztext, falls Medienelemente nicht verf\xFCgbar sind",Save:"Speichern",URL:"URL",Width:"Breite"}};class ke extends n{static get name(){return"image"}static get dependencies(){return[a,f]}static get config(){return{browser:null}}init(){this._i18n(Mt),this._tag({name:"img",group:"image",attributes:["alt","height","src","width"],empty:!0,navigable:!0}),new Ce(this._editor),this._editor.config.image.browser?this._editor.dialogs.set(new L(this._editor,"image",this._editor.config.image.browser)):this._editor.dialogs.set(new xe(this._editor)),this._command("img"),this._toolbar("Image")}}var Ht={de:{"Text Insertion":"Texteinf\xFCgung"}};class Me extends n{static get name(){return"insertion"}static get dependencies(){return[a]}init(){this._i18n(Ht),this._tag({name:"ins",group:"format"}),this._command("ins"),this._toolbar("Text Insertion","f",!0)}}var At={de:{italic:"kursiv"}};class He extends n{static get name(){return"italic"}static get dependencies(){return[a]}init(){this._i18n(At),this._tag({name:"i",group:"format"}),this._command("i"),this._toolbar("italic","i",!0)}}var It={de:{"User Input":"Benutzereingabe"}};class Ae extends n{static get name(){return"keyboard"}static get dependencies(){return[a]}init(){this._i18n(It),this._tag({name:"kbd",group:"format"}),this._command("kbd"),this._toolbar("User Input","k",!0)}}class Ie extends p{constructor(e){super(e,"link")}_initFieldset(e){e.appendChild(this._editor.createElement("legend",{html:this._("Link")})),e.appendChild(this._createInput("href","text",this._("URL"),{pattern:"(https?|/|mailto:|tel:).+",placeholder:this._("Insert URL to add a link or leave empty to unlink")}))}}class Be extends m{constructor(e){super(e);this._editor.root.addEventListener("sethtml",this),this._editor.root.addEventListener("inserta",this)}sethtml(e){Array.from(e.detail.element.getElementsByTagName("a")).forEach(t=>this.__init(t))}inserta(e){this.__init(e.detail.element)}__init(e){const t=e.getAttribute("href");t?e.setAttribute("href",this._editor.url(t)):e.parentElement.replaceChild(this._editor.createText(e.textContent),e)}}var Bt={de:{Cancel:"Abbrechen","Insert URL to add a link or leave empty to unlink":"URL zum Verlinken eingeben oder zum Entfernen leer lassen",Link:"Link",Save:"Speichern",URL:"URL"}};class Pe extends n{static get name(){return"link"}static get dependencies(){return[a]}init(){this._i18n(Bt),this._tag({name:"a",group:"format",attributes:["href"]}),new Be(this._editor),this._editor.dialogs.set(new Ie(this._editor)),this._command("a"),this._toolbar("Link","l",!0)}}var Pt={de:{mark:"markiert"}};class Oe extends n{static get name(){return"mark"}static get dependencies(){return[a]}init(){this._i18n(Pt),this._tag({name:"mark",group:"format"}),this._command("mark"),this._toolbar("mark","m",!0)}}class Fe extends m{constructor(e){super(e);this._editor.root.addEventListener("sethtml",this),this._editor.root.addEventListener("insertli",this),this._editor.root.addEventListener("deleteli",this),this._editor.root.addEventListener("insertol",this),this._editor.root.addEventListener("insertul",this)}sethtml(e){Array.from(e.detail.element.getElementsByTagName("li")).forEach(t=>this.__init(t))}insertli(e){this.__init(e.detail.element)}deleteli(e){e.detail.target.children.length===0&&e.detail.target.parentElement.removeChild(e.detail.target)}insertol(e){e.detail.element.children.length===0&&e.detail.element.appendChild(this._editor.createElement("li"))}insertul(e){this.insertol(e)}__init(e){!(e.parentElement instanceof HTMLOListElement)&&!(e.parentElement instanceof HTMLUListElement)&&this._editor.wrap(e,"ul")}}class x extends n{static get name(){return"list"}static get dependencies(){return[a,w]}init(){this._tag({name:"li",group:"listitem",children:["break","format"],deletable:!0,editable:!0,focusable:!0,navigable:!0,sortable:!0,enter:"li"}),new Fe(this._editor)}}var Ot={de:{"Ordered List":"Geordnete Liste"}};class Re extends n{static get name(){return"orderedlist"}static get dependencies(){return[a,x]}init(){this._i18n(Ot),this._tag({name:"ol",group:"list",children:["listitem"],arbitrary:!0,deletable:!0,focusable:!0,navigable:!0,sortable:!0}),this._command("ol"),this._toolbar("Ordered List")}}class ze extends m{constructor(e){super(e);this._editor.root.addEventListener("sethtml",this),this._editor.root.addEventListener("insertp",this)}sethtml(e){Array.from(e.detail.element.getElementsByTagName("p")).forEach(t=>this.__init(t))}insertp(e){this.__init(e.detail.element)}__init(e){e.addEventListener("paste",this)}paste(e){this._editor.window.setTimeout(()=>this._editor.filters.filter(e.target))}}var Ft={de:{Paragraph:"Absatz"}};class Ne extends n{static get name(){return"paragraph"}static get dependencies(){return[a,w]}init(){this._i18n(Ft),this._tag({name:"p",group:"paragraph",children:["break","format"],deletable:!0,editable:!0,focusable:!0,navigable:!0,sortable:!0,enter:"p"}),new ze(this._editor),this._command("p"),this._toolbar("Paragraph")}}class qe extends g{filter(e){e instanceof HTMLElement&&e.localName==="figure"&&e.classList.contains("preformat")&&e.querySelector(":scope > pre")&&!e.querySelector(":scope > figcaption")&&(e.insertAdjacentElement("beforebegin",e.querySelector(":scope > pre")),e.innerHTML="")}}class Ue extends m{constructor(e){super(e);this._editor.root.addEventListener("insertpre",this),this._editor.root.addEventListener("deletepre",this)}insertpre(e){this._editor.wrap(e.detail.element,"figure",{attributes:{class:"preformat"}})}deletepre(e){e.detail.target.localName==="figure"&&e.detail.target.classList.contains("preformat")&&e.detail.target.parentElement.removeChild(e.detail.target)}}var Rt={de:{"Preformatted Text":"Vorformatierter Text"}};class Ke extends n{static get name(){return"preformat"}static get dependencies(){return[a,w,f]}init(){this._i18n(Rt),this._tag({name:"pre",group:"preformat",children:["break"],deletable:!0,editable:!0,navigable:!0,enter:"p"}),new Ue(this._editor),this._command("pre"),this._toolbar("Preformatted Text"),this._editor.filters.add(new qe(this._editor))}}var zt={de:{Quote:"Zitat"}};class Ve extends n{static get name(){return"quote"}static get dependencies(){return[a]}init(){this._i18n(zt),this._tag({name:"q",group:"format"}),this._command("q"),this._toolbar("Quote","q",!0)}}var Nt={de:{"Sample Output":"Beispielausgabe"}};class Qe extends n{static get name(){return"sample"}static get dependencies(){return[a]}init(){this._i18n(Nt),this._tag({name:"samp",group:"format"}),this._command("samp"),this._toolbar("Sample Output","o",!0)}}class $e extends p{constructor(e){super(e,"section")}_initFieldset(e){e.appendChild(this._editor.createElement("legend",{html:this._("Section")})),e.appendChild(this._createInput("class","text",this._("CSS class"),{placeholder:this._("Insert CSS class")}))}}var qt={de:{Cancel:"Abbrechen","CSS class":"CSS-Klasse","Insert CSS class":"CSS-Klasse eingeben",Save:"Speichern",Section:"Sektion"}};class We extends n{static get name(){return"section"}static get dependencies(){return[a]}init(){this._i18n(qt),this._tag({name:"section",group:"container",children:["audio","figure","heading","iframe","image","list","paragraph","preformat","quote","rule","table","video"],attributes:["class"],arbitrary:!0,deletable:!0,focusable:!0,navigable:!0,slotable:!0,sortable:!0}),this._editor.dialogs.set(new $e(this._editor)),this._command("section"),this._toolbar("Section")}}var Ut={de:{small:"klein"}};class Ze extends n{static get name(){return"small"}static get dependencies(){return[a]}init(){this._i18n(Ut),this._tag({name:"small",group:"format"}),this._command("small"),this._toolbar("small","w",!0)}}var Kt={de:{strikethrough:"durchgestrichen"}};class Ge extends n{static get name(){return"strikethrough"}static get dependencies(){return[a]}init(){this._i18n(Kt),this._tag({name:"s",group:"format"}),this._command("s"),this._toolbar("strikethrough","r",!0)}}var Vt={de:{"strongly emphasized":"stark betont"}};class Je extends n{static get name(){return"strong"}static get dependencies(){return[a]}init(){this._i18n(Vt),this._tag({name:"strong",group:"format"}),this._command("strong"),this._toolbar("strongly emphasized","s",!0)}}var Qt={de:{Subheading:"Unter\xFCberschrift"}};class Xe extends n{static get name(){return"subheading"}static get dependencies(){return[a]}init(){this._i18n(Qt),this._tag({name:"h3",group:"heading",deletable:!0,editable:!0,focusable:!0,navigable:!0,sortable:!0,enter:"p"}),this._command("h3"),this._toolbar("Subheading")}}var $t={de:{subscript:"tiefgestellt"}};class Ye extends n{static get name(){return"subscript"}static get dependencies(){return[a]}init(){this._i18n($t),this._tag({name:"sub",group:"format"}),this._command("sub"),this._toolbar("subscript","x",!0)}}var Wt={de:{superscript:"hochgestellt"}};class et extends n{static get name(){return"superscript"}static get dependencies(){return[a]}init(){this._i18n(Wt),this._tag({name:"sup",group:"format"}),this._command("sup"),this._toolbar("superscript","y",!0)}}class tt extends S{constructor(e){super(e,"table","table")}_insert({rows:e=1,cols:t=1}={}){e=e>1?e:1,t=t>1?t:1;const i=this._editor.createElement("figure",{attributes:{class:"table"}}),r=this._editor.createElement("table"),s=this._editor.createElement("tbody");for(let d=0;d<e;d++){const o=this._editor.createElement("tr");s.appendChild(o);for(let c=0;c<t;++c)o.appendChild(this._editor.createElement("td"))}r.appendChild(s),i.appendChild(r),this._editor.insert(i)}}class it extends p{constructor(e){super(e,"table")}_initFieldset(e){e.appendChild(this._editor.createElement("legend",{html:this._("Table")})),e.appendChild(this._createInput("rows","number",this._("Rows"),{min:"1",required:"required",value:"1"})),e.appendChild(this._createInput("cols","number",this._("Columns"),{min:"1",required:"required",value:"1"}))}}class rt extends g{filter(e){e instanceof HTMLElement&&e.localName==="figure"&&e.classList.contains("table")&&e.querySelector(":scope > table")&&!e.querySelector(":scope > figcaption")?(e.insertAdjacentElement("beforebegin",e.querySelector(":scope > table")),e.innerHTML=""):(e instanceof HTMLTableElement&&e.querySelector(":scope > thead, :scope > tfoot")&&!e.querySelector(":scope > tbody")||(e instanceof HTMLTableSectionElement&&e.rows.length<=0||e instanceof HTMLTableRowElement&&!e.querySelector(":scope > th:not(:empty), :scope > td:not(:empty)")))&&(e.innerHTML="")}}class nt extends m{constructor(e){super(e);this._editor.root.addEventListener("inserttable",this),this._editor.root.addEventListener("inserttd",this),this._editor.root.addEventListener("insertth",this)}inserttable(e){this._editor.wrap(e.detail.element,"figure",{attributes:{class:"table"}}),e.detail.element.tBodies.length>0&&e.detail.element.tBodies[0].rows[0]&&(!e.detail.element.tHead||!e.detail.element.tFoot)&&(e.detail.element.tHead||this.__row(e.detail.element.createTHead(),e.detail.element.tBodies[0].rows[0].cells.length),e.detail.element.tFoot||this.__row(e.detail.element.createTFoot(),e.detail.element.tBodies[0].rows[0].cells.length))}inserttd(e){e.detail.element.addEventListener("keydown",this)}insertth(e){e.detail.element.addEventListener("keydown",this)}keydown(e){const t=e.target,i=t.parentElement,r=i.parentElement,s=r instanceof HTMLTableElement?r:r.parentElement,d=["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"],o=this._editor.isKey(e,d),c=this._editor.isKey(e,d,{ctrl:!0}),E=this._editor.isKey(e,d,{alt:!0}),y=this._editor.isKey(e,d,{alt:!0,shift:!0});if(t instanceof HTMLTableCellElement&&i instanceof HTMLTableRowElement&&(r instanceof HTMLTableElement||r instanceof HTMLTableSectionElement)&&s instanceof HTMLTableElement&&(o&&this.__enabled(t,e.key)||c||E||y)){const h=t.cellIndex,b=i.cells.length,D=r.rows.length,j=r instanceof HTMLTableElement?i.rowIndex:i.sectionRowIndex,k=h===0,M=h===b-1,ii=j===0,ri=j===D-1,ut=i.rowIndex===0,gt=i.rowIndex===s.rows.length-1;e.preventDefault(),e.stopPropagation(),o?e.key==="ArrowLeft"&&!k?this._editor.focusEnd(i.cells[h-1]):e.key==="ArrowLeft"&&ut?this._editor.focusEnd(s.rows[s.rows.length-1].cells[b-1]):e.key==="ArrowLeft"?this._editor.focusEnd(s.rows[i.rowIndex-1].cells[b-1]):e.key==="ArrowRight"&&!M?i.cells[h+1].focus():e.key==="ArrowRight"&&gt?s.rows[0].cells[0].focus():e.key==="ArrowRight"?s.rows[i.rowIndex+1].cells[0].focus():e.key==="ArrowUp"&&ut?s.rows[s.rows.length-1].cells[h].focus():e.key==="ArrowUp"?s.rows[i.rowIndex-1].cells[h].focus():e.key==="ArrowDown"&&gt?s.rows[0].cells[h].focus():e.key==="ArrowDown"&&s.rows[i.rowIndex+1].cells[h].focus():c?(e.key==="ArrowLeft"&&b>1&&k?Array.from(s.rows).forEach(u=>u.appendChild(u.cells[h])):e.key==="ArrowLeft"&&b>1?Array.from(s.rows).forEach(u=>u.insertBefore(u.cells[h],u.cells[h-1])):e.key==="ArrowRight"&&b>1&&M?Array.from(s.rows).forEach(u=>u.insertBefore(u.cells[h],u.cells[0])):e.key==="ArrowRight"&&b>1?Array.from(s.rows).forEach(u=>u.insertBefore(u.cells[h+1],u.cells[h])):e.key==="ArrowUp"&&D>1&&ii?r.appendChild(i):e.key==="ArrowUp"&&D>1?r.insertBefore(i,r.rows[j-1]):e.key==="ArrowDown"&&D>1&&ri?r.insertBefore(i,r.rows[0]):e.key==="ArrowDown"&&D>1&&r.insertBefore(r.rows[j+1],i),t.focus()):E?e.key==="ArrowLeft"?Array.from(s.rows).forEach(u=>this.__cell(u,u.cells[h])):e.key==="ArrowRight"?Array.from(s.rows).forEach(u=>this.__cell(u,u.cells[h+1])):e.key==="ArrowUp"?this.__row(r,b,j):e.key==="ArrowDown"&&this.__row(r,b,j+1):y&&(e.key==="ArrowLeft"&&!k?Array.from(s.rows).forEach(u=>u.deleteCell(h-1)):e.key==="ArrowRight"&&!M?Array.from(s.rows).forEach(u=>u.deleteCell(h+1)):e.key==="ArrowUp"&&j>0?r.deleteRow(j-1):e.key==="ArrowDown"&&j<D-1&&r.deleteRow(j+1))}}__row(e,t,i=0){const r=e.insertRow(i);for(let s=0;s<t;s++)this.__cell(r)}__cell(e,t=null){const i=e.parentElement.localName==="thead"?"th":"td";e.insertBefore(this._editor.createElement(i),t)}__enabled(e,t){if(["ArrowUp","ArrowDown"].includes(t))return!0;const i=this._editor.window.getSelection();if(!i.isCollapsed)return!1;if(t==="ArrowLeft"){const s=e.firstChild instanceof HTMLElement?e.firstChild.firstChild:e.firstChild;return i.anchorOffset===0&&[e,s].includes(i.anchorNode)}let r=e.lastChild;return e.lastChild instanceof HTMLBRElement&&e.lastChild.previousSibling&&(r=e.lastChild.previousSibling),r instanceof HTMLElement&&(r=r.lastChild),i.anchorOffset===i.anchorNode.textContent.length&&[e,r].includes(i.anchorNode)}}var Zt={de:{Cancel:"Abbrechen",Columns:"Spalten",Rows:"Zeilen",Save:"Speichern",Table:"Tabelle"}};class at extends n{static get name(){return"table"}static get dependencies(){return[a,w,f]}init(){this._i18n(Zt),this._tag({name:"table",group:"table",children:["tablesection"],deletable:!0,navigable:!0}),this._tag({name:"thead",group:"tablesection",children:["tablerow"]}),this._tag({name:"tbody",group:"tablesection",children:["tablerow"]}),this._tag({name:"tfoot",group:"tablesection",children:["tablerow"]}),this._tag({name:"tr",group:"tablerow",children:["tablecell"]}),this._tag({name:"th",group:"tablecell",children:["break","format"],editable:!0,empty:!0}),this._tag({name:"td",group:"tablecell",children:["break","format"],editable:!0,empty:!0}),new nt(this._editor),this._editor.filters.add(new rt(this._editor)),this._editor.dialogs.set(new it(this._editor)),this._editor.commands.set(new tt(this._editor)),this._toolbar("Table")}}class st extends p{constructor(e){super(e,"time")}_initFieldset(e){e.appendChild(this._editor.createElement("legend",{html:this._("Time")})),e.appendChild(this._createInput("datetime","text",this._("Machine-readable Datetime"),{placeholder:this._("Insert date and/or time or leave empty to remove it")}))}}var Gt={de:{Cancel:"Abbrechen","Machine-readable Datetime":"Maschinenlesbare Datums-/Zeitangabe","Insert date and/or time or leave empty to remove it":"Datum und/oder Zeit eingeben oder zum Entfernen leer lassen",Save:"Speichern",Time:"Zeit"}};class ot extends n{static get name(){return"time"}static get dependencies(){return[a]}init(){this._i18n(Gt),this._tag({name:"time",group:"format",attributes:["datetime"]}),this._editor.dialogs.set(new st(this._editor)),this._command("time"),this._toolbar("Time","t",!0)}}var Jt={de:{underline:"unterstrichen"}};class lt extends n{static get name(){return"underline"}static get dependencies(){return[a]}init(){this._i18n(Jt),this._tag({name:"u",group:"format"}),this._command("u"),this._toolbar("underline","u",!0)}}var Xt={de:{"Unordered List":"Ungeordnete Liste"}};class dt extends n{static get name(){return"unorderedlist"}static get dependencies(){return[a,x]}init(){this._i18n(Xt),this._tag({name:"ul",group:"list",children:["listitem"],arbitrary:!0,deletable:!0,focusable:!0,navigable:!0,sortable:!0}),this._command("ul"),this._toolbar("Unordered List")}}var Yt={de:{Variable:"Variable"}};class mt extends n{static get name(){return"variable"}static get dependencies(){return[a]}init(){this._i18n(Yt),this._tag({name:"var",group:"format"}),this._command("var"),this._toolbar("Variable","v",!0)}}class ct extends p{constructor(e){super(e,"video")}_initFieldset(e){e.appendChild(this._editor.createElement("legend",{html:this._("Video")})),e.appendChild(this._createInput("src","text",this._("URL"),{pattern:"(https?|/).+",placeholder:this._("Insert URL to video"),required:"required"})),e.appendChild(this._createInput("width","number",this._("Width"))),e.appendChild(this._createInput("height","number",this._("Height")))}}class pt extends m{constructor(e){super(e);this._editor.root.addEventListener("sethtml",this),this._editor.root.addEventListener("insertvideo",this)}sethtml(e){Array.from(e.detail.element.getElementsByTagName("video")).forEach(t=>this.__init(t))}insertvideo(e){this.__init(e.detail.element)}__init(e){const t=e.getAttribute("src");t?(e.setAttribute("src",this._editor.url(t)),e.controls=!0,this._editor.wrap(e,"figure",{attributes:{class:"video"}})):e.parentElement.removeChild(e)}}var ei={de:{Cancel:"Abbrechen",Height:"H\xF6he","Insert URL to video":"URL zur Videodatei eingeben",Save:"Speichern",URL:"URL",Video:"Video",Width:"Breite"}};class ht extends n{static get name(){return"video"}static get dependencies(){return[a,f]}static get config(){return{browser:null}}init(){this._i18n(ei),this._tag({name:"video",group:"video",attributes:["controls","height","src","width"],empty:!0,navigable:!0}),new pt(this._editor),this._editor.config.video.browser?this._editor.dialogs.set(new L(this._editor,"video",this._editor.config.video.browser)):this._editor.dialogs.set(new ct(this._editor)),this._command("video"),this._toolbar("Video")}}class ti extends _{static get defaultConfig(){return{base:{plugins:[me,He,Je,je,lt,Ge,Pe,Oe,Ze,ge,G,Ve,ce,pe,Ae,Qe,mt,Ye,et,ot,ue,Me,fe,Ne,De,Xe,dt,Re,ye,de,ke,ht,te,ve,at,Ke,We,Ee,we,ae]}}}}export{ti as default};
