class T{constructor(t,e,i=null){if(this._editor=void 0,this.name=void 0,this._tag=null,this._dialog=null,!(t instanceof L)||!e||typeof e!="string"||i&&typeof i!="string")throw"Invalid argument";this._editor=t,this.name=e,this._tag=i?this._editor.tags.get(i):null,this._dialog=this._editor.dialogs.get(e)}execute(){this._dialog?this._openDialog():this._insert(this._selectedAttributes())}_insert(t={}){if(this._tag){Object.keys(t).forEach(i=>this._tag.attributes.includes(i)&&t[i]||delete t[i]);const e=this._selectedElement();this._tag.group!=="format"?this._editor.insert(this._editor.createElement(this._tag.name,{attributes:t})):e&&Object.keys(t).length>0?e.parentElement.replaceChild(this._editor.createElement(this._tag.name,{attributes:t,html:e.textContent}),e):e?e.parentElement.replaceChild(this._editor.createText(e.textContent),e):this._editor.format(this._editor.createElement(this._tag.name,{attributes:t}))}}_openDialog(){this._dialog.open(t=>this._insert(t),this._selectedAttributes())}_selectedElement(){var t;const e=this._editor.getSelectedElement();return e&&e.localName===((t=this._tag)==null?void 0:t.name)?e:null}_selectedAttributes(){const t=this._selectedElement(),e={};return t&&this._tag&&Array.from(t.attributes).forEach(i=>{this._tag.attributes.includes(i.nodeName)&&(e[i.nodeName]=i.nodeValue)}),e}}class N{constructor(t=[]){this.__items=new Map(),t.forEach(e=>this.set(e))}get(t){return this.__items.get(t)||null}set(t){if(!(t instanceof T))throw"Invalid argument";this.__items.set(t.name,t)}execute(t){this.get(t).execute()}}class U{constructor(t=[]){this.__items=new Map(),t.forEach(e=>this.set(e))}get(t){return this.__items.get(t)||null}set(t){if(!(t instanceof f))throw"Invalid argument";this.__items.set(t.name,t)}}class k{constructor(t){if(this.__element=void 0,!(t instanceof HTMLElement))throw"Invalid argument";this.__element=t,this.register(this.__observe.bind(this))}dispatch(t,e,i){if(!t||typeof t!="string"||!(e instanceof HTMLElement)||!(i instanceof HTMLElement))throw"Invalid argument";this.__element.dispatchEvent(new CustomEvent(t,{detail:{element:e,target:i}}))}register(t,e={childList:!0,subtree:!0}){if(typeof t!="function")throw"Invalid argument";const i=new MutationObserver(t);i.observe(this.__element,e)}__dispatch(t,e,i){e instanceof HTMLElement&&i instanceof HTMLElement&&(this.dispatch(t,e,i),this.dispatch(`${t}${e.localName.replace("-","")}`,e,i))}__observe(t){t.forEach(e=>{e.addedNodes.forEach(i=>{i instanceof HTMLElement&&(this.__dispatch("insert",i,e.target),Array.from(i.getElementsByTagName("*")).forEach(r=>this.__dispatch("insert",r,e.target)))}),e.removedNodes.forEach(i=>i instanceof HTMLElement&&this.__dispatch("delete",i,e.target))})}}class E{constructor(t){if(this._editor=void 0,!(t instanceof L))throw"Invalid argument";this._editor=t}filter(t){throw"Not implemented"}}class ${constructor(){this.__items=new Set()}add(t){if(!(t instanceof E))throw"Invalid argument";this.__items.add(t)}filter(t){if(!(t instanceof HTMLElement))throw"Invalid argument";this.__items.forEach(e=>{t.normalize(),e.filter(t)})}}var B=Object.prototype.hasOwnProperty,H=Object.getOwnPropertySymbols,F=Object.prototype.propertyIsEnumerable,P=(t,e)=>{var i={};for(var r in t)B.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(t!=null&&H)for(var r of H(t))e.indexOf(r)<0&&F.call(t,r)&&(i[r]=t[r]);return i};class M{constructor(t={}){this.name=void 0,this.group=void 0,this.children=[],this.attributes=[],this.alignable=!1,this.arbitrary=!1,this.deletable=!1,this.editable=!1,this.empty=!1,this.focusable=!1,this.navigable=!1,this.slotable=!1,this.sortable=!1,this.enter=null;var{name:e,group:i}=t,r=P(t,["name","group"]);const s=a=>a&&typeof a=="string",l=a=>typeof a=="undefined"||a&&typeof a=="string",n=a=>typeof a=="undefined"||Array.isArray(a)&&!a.find(g=>!s(g));if(!s(e)||!s(i)||!l(r.enter)||!n(r.children)||!n(r.attributes))throw"Invalid argument";this.name=e,this.group=i,this.children=r.children||[],this.attributes=r.attributes||[],this.arbitrary=r.arbitrary===!0,this.alignable=r.alignable===!0,this.deletable=r.deletable===!0,this.editable=r.editable===!0,this.empty=r.empty===!0,this.focusable=r.focusable===!0,this.navigable=r.navigable===!0,this.slotable=r.slotable===!0,this.sortable=r.sortable===!0,this.enter=r.enter||null}}class o{constructor(t){if(this._editor=void 0,!(t instanceof L))throw"Invalid argument";this._editor=t}static get name(){throw"Missing plugin name"}static get dependencies(){return[]}static get config(){return{}}init(){throw"Not implemented"}_(t){return this._editor.translator.translate(this.constructor.name,t)}_i18n(t){t[this._editor.config.base.lang]&&this._editor.translator.set(this.constructor.name,t[this._editor.config.base.lang])}_command(t){this._editor.commands.set(new T(this._editor,this.constructor.name,t))}_tag(t){this._editor.tags.set(new M(t))}_toolbar(t,e=null,i=!1){if(!t||typeof t!="string"||e&&typeof e!="string")throw"Invalid argument";t=this._(t);const r=this._editor.createElement("button",{attributes:{type:"button","data-command":this.constructor.name,title:t,"data-key":e},html:t});i?this._editor.formats.appendChild(r):this._editor.toolbar.appendChild(r)}}class j{constructor(t=[]){this.__items=new Map(),t.forEach(e=>this.set(e))}get(t){return this.__items.get(t)||null}set(t){if(!(t instanceof o))throw"Invalid argument";this.__items.set(t.constructor.name,t)}init(){this.__items.forEach(t=>t.init())}}class O{constructor(t=[]){this.__items=new Map(),t.forEach(e=>this.set(e))}get(t){return this.__items.get(t instanceof HTMLElement?t.localName:t)||null}set(t){if(!(t instanceof M))throw"Invalid argument";this.__items.set(t.name,t)}allowed(t,e,i=!1){var r,s;const l=i?e:(r=this.get(e))==null?void 0:r.group;return!!((s=this.get(t))==null?void 0:s.children.includes(l))}}class z{constructor(){this.__items=new Map()}get(t){return this.__items.get(t)||null}set(t,e){if(!t||typeof t!="string"||!(e instanceof Object))throw"Invalid argument";this.__items.set(t,e)}translate(t,e){var i;return((i=this.get(t))==null?void 0:i[e])||e}}class L{constructor(t,e={}){if(this.orig=void 0,this.document=void 0,this.window=void 0,this.element=void 0,this.toolbar=void 0,this.toolbarEvents=void 0,this.formats=void 0,this.formatsEvents=void 0,this.root=void 0,this.rootEvents=void 0,this.config={},this.translator=new z(),this.tags=new O(),this.filters=new $(),this.dialogs=new U(),this.commands=new N(),this.plugins=new j(),!(t instanceof HTMLElement)||!(e instanceof Object))throw"Invalid argument";this.orig=t,this.document=this.orig.ownerDocument,this.window=this.document.defaultView,this.element=this.createElement("akilli-editor"),this.toolbar=this.createElement("editor-toolbar",{attributes:{role:"toolbar"}}),this.element.appendChild(this.toolbar),this.toolbarEvents=new k(this.toolbar),this.formats=this.createElement("editor-formats",{attributes:{role:"toolbar"}}),this.formats.hidden=!0,this.element.appendChild(this.formats),this.formatsEvents=new k(this.formats),this.root=this.createElement("editor-root"),this.element.appendChild(this.root),this.rootEvents=new k(this.root),this.config=e}static get defaultConfig(){return{}}init(){var t,e;const i=this.config;this.config={};const r=((t=this.constructor.defaultConfig.base)==null?void 0:t.plugins)||[];let s=r;Array.isArray((e=i.base)==null?void 0:e.plugins)&&i.base.plugins.length>0&&(s=[],i.base.plugins.forEach(a=>{const g=r.find(_=>_.name===a);g&&s.push(g)}));const l=new Set(),n=a=>{a.dependencies&&a.dependencies.forEach(n),l.add(a)};s.map(n),l.forEach(a=>{Object.entries(a.config).forEach(([g,_])=>{var c,m;this.config.hasOwnProperty(a.name)||(this.config[a.name]={}),this.config[a.name][g]=((c=i[a.name])==null?void 0:c[g])||((m=this.constructor.defaultConfig[a.name])==null?void 0:m[g])||_}),this.plugins.set(new a(this))}),this.plugins.init()}load(){this.orig instanceof HTMLTextAreaElement?(this.orig.form.addEventListener("submit",()=>this.save()),this.setHtml(this.orig.value.replace("/&nbsp;/g"," "))):this.setHtml(this.orig.innerHTML),this.orig.insertAdjacentElement("afterend",this.element),this.orig.hidden=!0}destroy(){this.element.parentElement.removeChild(this.element),this.orig.hidden=!1}getHtml(){const t=this.createElement(this.root.localName,{html:this.root.innerHTML});return this.filters.filter(t),this.rootEvents.dispatch("gethtml",t,this.root),t.innerHTML}setHtml(t){const e=this.createElement(this.root.localName,{html:t});this.rootEvents.dispatch("sethtml",e,this.root),this.filters.filter(e),this.root.innerHTML=e.innerHTML}save(){this.orig instanceof HTMLTextAreaElement?this.orig.value=this.getHtml():this.orig.innerHTML=this.getHtml()}insert(t){var e;if(!(t instanceof HTMLElement))throw"Invalid argument";const i=this.getSelectedEditable();if(i&&i instanceof HTMLSlotElement&&this.tags.allowed(i.parentElement,t))i.insertAdjacentElement("beforebegin",t);else if(i)(e=this.closest(i,t))==null||e.insertAdjacentElement("afterend",t),i.hasAttribute("data-deletable")&&!i.textContent.trim()&&i.parentElement.removeChild(i);else if(this.tags.allowed(this.root,t))this.root.appendChild(t);else throw"Invalid argument"}insertText(t){const e=this.getSelectedEditable();if(e){const i=this.window.getSelection().getRangeAt(0);i.deleteContents(),i.insertNode(this.createText(t)),i.collapse(),e.normalize()}}format(t){if(!(t instanceof HTMLElement))throw"Invalid argument";const e=this.window.getSelection(),i=e.rangeCount>0?e.getRangeAt(0):null,r=this.getSelectedEditable();if(!i||i.collapsed||!i.toString().trim()||!r||!this.tags.allowed(r,t))return;i.startContainer instanceof Text&&i.startContainer.parentElement!==r&&i.setStartBefore(i.startContainer.parentElement),i.endContainer instanceof Text&&i.endContainer.parentElement!==r&&i.setEndAfter(i.endContainer.parentElement);const s=i.toString(),l=Array.from(i.cloneContents().childNodes).every(n=>n instanceof Text&&!n.textContent.trim()||n instanceof HTMLElement&&n.localName===t.localName);i.deleteContents(),l?i.insertNode(this.createText(s)):(t.textContent=s,i.insertNode(t)),r.normalize()}arbitrary(t){return t instanceof HTMLElement&&(t===this.root||t.hasAttribute("data-arbitrary"))}closest(t,e){if(!(t instanceof HTMLElement)||!this.contains(t.parentElement))throw"Invalid argument";let i=t,r=t.parentElement;do if(this.arbitrary(r)&&this.tags.allowed(r,e))return i;while((i=r)&&(r=r.parentElement)&&this.contains(r));return null}wrap(t,e,i={}){let r;if(t instanceof HTMLElement){if(t.parentElement.localName!==e&&(r=this.closest(t,e))){const s=this.createElement(e,i);r.insertAdjacentElement("afterend",s),s.appendChild(t)}}else throw"Invalid argument"}contains(t){var e;if(!(t instanceof HTMLElement))throw"Invalid argument";return this.root.contains(t)||((e=t.closest(this.root.localName))==null?void 0:e.parentElement)===null}registerElement(t,e,i=null){typeof this.window.customElements.get(t)=="undefined"&&this.window.customElements.define(t,e,i?{extends:i}:null)}createElement(t,{attributes:e={},html:i=""}={}){const r=this.document.createElement(t);return r.innerHTML=i,Object.entries(e).forEach(([s,l])=>l&&r.setAttribute(s,`${l}`)),r}createText(t){return this.document.createTextNode(t)}getSelectedElement(){try{const t=this.window.getSelection(),e=t.anchorNode instanceof Text?t.anchorNode.parentElement:t.anchorNode,i=t.focusNode instanceof Text?t.focusNode.parentElement:t.focusNode;if(e instanceof HTMLElement&&i instanceof HTMLElement&&e===i&&this.contains(e))return e}catch(t){this.window.console.error(t)}return null}getSelectedEditable(){try{const t=this.window.getSelection(),e=t.anchorNode instanceof Text?t.anchorNode.parentElement:t.anchorNode,i=t.focusNode instanceof Text?t.focusNode.parentElement:t.focusNode;if(e instanceof HTMLElement&&i instanceof HTMLElement){const r=e.closest("[contenteditable=true]"),s=i.closest("[contenteditable=true]");if(r instanceof HTMLElement&&r===s&&this.contains(r))return r}}catch(t){this.window.console.error(t)}return null}focusEnd(t){if(!(t instanceof HTMLElement))throw"Invalid argument";const e=this.document.createRange(),i=this.window.getSelection();t.focus(),e.selectNodeContents(t),e.collapse(),i.removeAllRanges(),i.addRange(e)}isKey(t,e,{alt:i=!1,ctrl:r=!1,shift:s=!1}={}){return(Array.isArray(e)&&e.includes(t.key)||t.key===e)&&t.altKey===i&&t.ctrlKey===r&&t.shiftKey===s}url(t){const e=this.window.origin||this.window.location.origin,i=this.createElement("a",{attributes:{href:t}});return e===i.origin?i.pathname:i.href}static create(t,e={}){const i=new this(t,e);return i.init(),i.load(),i}}class f{constructor(t,e){if(this._editor=void 0,this.name=void 0,!(t instanceof L)||!e||typeof e!="string")throw"Invalid argument";this._editor=t,this.name=e}open(t,e={}){const i=()=>Array.from(this._editor.element.getElementsByTagName("editor-dialog")).forEach(c=>{c.parentElement.removeChild(c)}),r=this._editor.window.getSelection(),s=r.rangeCount>0?r.getRangeAt(0):null,l=()=>{s&&(r.removeAllRanges(),r.addRange(s)),i()};i();const n=this._editor.createElement("form"),a=this._editor.createElement("fieldset"),g=this._editor.createElement("button",{attributes:{type:"button"},html:this._("Cancel")});g.addEventListener("click",l),n.appendChild(a),n.appendChild(g),n.appendChild(this._editor.createElement("button",{html:this._("Save")})),this._initFieldset(a),n.addEventListener("submit",c=>{c.preventDefault(),c.stopPropagation(),l();const m={};Array.from(a.elements).forEach(b=>m[b.name]=b.value),t(m)}),Object.entries(e).forEach(([c,m])=>a.elements[c]&&(a.elements[c].value=m));const _=this._editor.createElement("editor-dialog");_.addEventListener("close",l),_.appendChild(n),_.show(),this._editor.element.appendChild(_)}_(t){return this._editor.translator.translate(this.name,t)}_initFieldset(t){throw"Not implemented"}_createInput(t,e,i,r={}){if(!t||typeof t!="string"||!e||typeof e!="string"||!i||typeof i!="string")throw"Invalid argument";Object.assign(r,{id:`editor-${t}`,name:t,type:e});const s=this._editor.createElement("div");return s.appendChild(this._editor.createElement("label",{attributes:{for:r.id},html:i})),s.appendChild(this._editor.createElement("input",{attributes:r})),r.required&&s.setAttribute("data-required",""),s}}class K extends f{constructor(t){super(t,"abbreviation")}_initFieldset(t){t.appendChild(this._editor.createElement("legend",{html:this._("Abbreviation")})),t.appendChild(this._createInput("title","text",this._("Full term"),{placeholder:this._("Insert full term or leave empty to remove it")}))}}class u{constructor(t){if(this._editor=void 0,!(t instanceof L))throw"Invalid argument";this._editor=t}handleEvent(t){typeof this[t.type]=="function"&&this[t.type](t)}}class V extends u{constructor(t){super(t);this._editor.root.addEventListener("insert",this)}insert(t){t.detail.element.hasAttribute("data-alignable")&&t.detail.element.addEventListener("keydown",this)}keydown(t){const e={ArrowUp:null,ArrowLeft:"left",ArrowDown:"center",ArrowRight:"right"};t.target===t.currentTarget&&this._editor.isKey(t,Object.keys(e),{shift:!0})&&(t.preventDefault(),t.stopPropagation(),t.target.classList.remove(...Object.values(e)),e[t.key]&&t.target.classList.add(e[t.key]))}}class Q extends E{filter(t){const e=this._editor.tags.get(t),i=this._editor.tags.allowed(t,"p"),r=e.editable||e.group==="format";let s=[];const l=(n=null)=>{i&&s.length>0&&(t.insertBefore(this._editor.createElement("p",{html:s.join(" ")}),n),s=[])};Array.from(t.childNodes).forEach(n=>{const a=n.textContent.trim();if(n instanceof HTMLElement){n=this.__convert(n);const g=this._editor.tags.get(n);g&&this._editor.tags.allowed(t,n)?(l(n),this.__element(n,g)):g&&g.group==="format"&&i?(n=this.__element(n,g))&&(s.push(n.outerHTML),t.removeChild(n)):!r&&a&&i?(s.push(a),t.removeChild(n)):r&&a?t.replaceChild(this._editor.createText(a),n):t.removeChild(n)}else n instanceof Text?(!r&&a&&i&&s.push(a),(!r||!a)&&t.removeChild(n)):n instanceof Node&&t.removeChild(n)}),l()}__convert(t){const e=this._editor.config.base.filter[t.localName];if(!e)return t;const i=this._editor.createElement(e,{html:t.innerHTML});return t.parentElement.replaceChild(i,t),i}__element(t,e){return Array.from(t.attributes).forEach(i=>!e.attributes.includes(i.name)&&t.removeAttribute(i.name)),t.hasChildNodes()&&this._editor.filters.filter(t),t.hasChildNodes()||e.empty?t:(t.parentElement.removeChild(t),null)}}class W extends u{constructor(t){super(t);this._editor.root.addEventListener("insert",this)}insert(t){t.detail.element.hasAttribute("data-deletable")&&t.detail.element.addEventListener("keydown",this)}keydown(t){t.target===t.currentTarget&&this._editor.isKey(t,"Delete",{ctrl:!0})&&(t.target.previousElementSibling instanceof HTMLElement&&this._editor.focusEnd(t.target.previousElementSibling),t.target.parentElement.removeChild(t.target),t.preventDefault(),t.stopPropagation())}}class Z extends HTMLElement{constructor(){super();this.addEventListener("keydown",t=>t.key==="Escape"&&this.close()),this.addEventListener("click",t=>t.target===this&&this.close())}connectedCallback(){this.setAttribute("role","dialog"),this.tabIndex=-1,this.focus()}get open(){return this.hasAttribute("open")}set open(t){t===!0?this.setAttribute("open",""):this.removeAttribute("open")}show(){this.open=!0,this.dispatchEvent(new CustomEvent("show",{detail:{element:this,target:this}}))}close(){this.open=!1,this.dispatchEvent(new CustomEvent("close",{detail:{element:this,target:this}}))}}class G extends u{constructor(t){super(t);this._editor.root.addEventListener("insert",this)}insert(t){t.detail.element.contentEditable==="true"&&t.detail.element.addEventListener("keydown",this)}keydown(t){var e,i,r,s;if(this._editor.isKey(t,"Enter",{shift:!0})&&!this._editor.tags.allowed(t.target,"br"))t.preventDefault(),t.stopPropagation();else if(this._editor.isKey(t,"Enter")){t.preventDefault(),t.stopPropagation();const l=(e=this._editor.tags.get(t.target))==null?void 0:e.enter;l&&(t.target.textContent.trim()||!t.target.hasAttribute("data-deletable")?(i=this._editor.closest(t.target,l))==null||i.insertAdjacentElement("afterend",this._editor.createElement(l)):t.target instanceof HTMLParagraphElement||((r=this._editor.closest(t.target,"p"))==null||r.insertAdjacentElement("afterend",this._editor.createElement("p")),t.target.parentElement.removeChild(t.target)))}else this._editor.isKey(t,"Backspace")&&!t.target.textContent&&t.target.hasAttribute("data-deletable")?(t.target.previousElementSibling instanceof HTMLElement&&this._editor.focusEnd(t.target.previousElementSibling),t.target.parentElement.removeChild(t.target),t.preventDefault(),t.stopPropagation()):/^[A-Z]$/.test(t.key)&&this._editor.isKey(t,t.key,{alt:!0,shift:!0})&&(t.preventDefault(),t.stopPropagation(),(s=this._editor.formats.querySelector(`button[data-key=${t.key.toLowerCase()}]`))==null||s.click())}}class J extends u{constructor(t){super(t);this._editor.root.addEventListener("insert",this)}insert(t){t.detail.element.hasAttribute("data-focusable")&&t.detail.element.focus()}}class X extends u{constructor(t){super(t);this._editor.root.addEventListener("insert",this)}insert(t){t.detail.element.hasAttribute("data-navigable")&&(t.detail.element.tabIndex=0,t.detail.element.addEventListener("keydown",this))}keydown(t){if(t.target===t.currentTarget&&this._editor.isKey(t,["ArrowUp","ArrowDown","Home","End"])&&this.__enabled(t.target)){const e=t.target.previousElementSibling,i=t.target.nextElementSibling,r=t.target.parentElement.firstElementChild,s=t.target.parentElement.lastElementChild,l=t.target===r,n=t.target===s;t.key==="ArrowUp"&&!l&&e.hasAttribute("data-navigable")?e.focus():t.key==="ArrowDown"&&!n&&i.hasAttribute("data-navigable")?i.focus():(t.key==="Home"||t.key==="ArrowDown"&&n)&&r.hasAttribute("data-navigable")?r.focus():(t.key==="End"||t.key==="ArrowUp"&&l)&&s.hasAttribute("data-navigable")&&s.focus(),t.preventDefault(),t.stopPropagation()}}__enabled(t){if(t.contentEditable!=="true")return!0;const e=this._editor.window.getSelection(),i=this._editor.getSelectedEditable(),r=this._editor.getSelectedElement();return e.isCollapsed&&e.anchorOffset===0&&[i,t.firstChild].includes(r)}}class Y extends u{constructor(t){super(t);this._editor.root.addEventListener("insert",this)}insert(t){t.detail.element instanceof HTMLSlotElement?t.detail.element.addEventListener("keydown",this):t.detail.element.hasAttribute("data-slotable")&&!t.detail.element.querySelector(":scope > slot")&&t.detail.element.appendChild(this._editor.createElement("slot"))}keydown(t){t.preventDefault(),t.stopPropagation()}}class tt extends u{constructor(t){super(t);this._editor.root.addEventListener("insert",this)}insert(t){t.detail.element.hasAttribute("data-sortable")&&(t.detail.element.addEventListener("keydown",this),t.detail.element.addEventListener("pointerdown",this),t.detail.element.addEventListener("pointermove",this),t.detail.element.addEventListener("pointerup",this))}keydown(t){if(t.target===t.currentTarget&&this._editor.isKey(t,["ArrowUp","ArrowDown","Home","End"],{ctrl:!0})){const e=t.target.parentElement,i=t.target.previousElementSibling,r=t.target.nextElementSibling,s=e.firstElementChild,l=e.lastElementChild,n=t.target===s,a=t.target===l;t.key==="ArrowUp"&&!n&&i.hasAttribute("data-sortable")?(i.insertAdjacentHTML("beforebegin",t.target.outerHTML),e.removeChild(t.target)):t.key==="ArrowDown"&&!a&&r.hasAttribute("data-sortable")?(r.insertAdjacentHTML("afterend",t.target.outerHTML),e.removeChild(t.target)):(t.key==="Home"&&!n||t.key==="ArrowDown"&&a)&&s.hasAttribute("data-sortable")?(s.insertAdjacentHTML("beforebegin",t.target.outerHTML),e.removeChild(t.target)):(t.key==="End"&&!a||t.key==="ArrowUp"&&n)&&l.hasAttribute("data-sortable")&&(l.insertAdjacentHTML("afterend",t.target.outerHTML),e.removeChild(t.target)),t.preventDefault(),t.stopPropagation()}}pointerdown(t){t.target.hasAttribute("data-sortable")&&(t.target.setAttribute("data-sort",""),t.target.setPointerCapture(t.pointerId))}pointermove(t){const e=this._editor.document.elementFromPoint(t.x,t.y);this.__sortover(),this.__droppable(t.target,e)&&e.setAttribute("data-sortover","")}pointerup(t){if(t.target.hasAttribute("data-sortable")){const e=this._editor.document.elementFromPoint(t.x,t.y);this.__sortover(),t.target.removeAttribute("data-sort"),t.target.releasePointerCapture(t.pointerId),this.__droppable(t.target,e)&&e.insertAdjacentElement("beforebegin",t.target)}}__sortover(){this._editor.root.querySelectorAll("[data-sortover]").forEach(t=>t.removeAttribute("data-sortover"))}__droppable(t,e){return t instanceof HTMLElement&&e instanceof HTMLElement&&this._editor.contains(e)&&![this._editor.root,t].includes(e)&&e.hasAttribute("data-sortable")&&(t.parentElement===e.parentElement||this._editor.arbitrary(t.parentElement)&&this._editor.arbitrary(e.parentElement))&&this._editor.tags.allowed(e.parentElement,t)}}class et extends u{constructor(t){super(t);this._editor.root.addEventListener("insert",this)}insert(t){const e=this._editor.tags.get(t.detail.element);e&&(e.editable&&(t.detail.element.contentEditable="true"),["alignable","arbitrary","deletable","focusable","navigable","slotable","sortable"].forEach(i=>{e[i]&&(t.detail.element.dataset[i]="")}))}}class it extends u{constructor(t){super(t);this._editor.toolbar.addEventListener("insertbutton",this),this._editor.formats.addEventListener("insertbutton",this),this._editor.document.addEventListener("selectionchange",this)}insertbutton(t){const e=t.detail.element.getAttribute("data-key");if(e){const i=this._editor.translator.translate("base","Alt"),r=this._editor.translator.translate("base","Shift");t.detail.element.title+=` [${i} + ${r} + ${e}]`}t.detail.element.getAttribute("data-command")&&t.detail.element.addEventListener("click",this),t.detail.element.parentElement===this._editor.toolbar&&(t.detail.element.tabIndex=-1,t.detail.element.addEventListener("keydown",this))}click(t){this._editor.commands.execute(t.target.getAttribute("data-command"))}keydown(t){if(this._editor.isKey(t,["ArrowLeft","ArrowRight","Home","End"])){const e=t.target.previousElementSibling,i=t.target.nextElementSibling,r=t.target.parentElement.firstElementChild,s=t.target.parentElement.lastElementChild,l=t.target===r,n=t.target===s;t.key==="ArrowLeft"&&!l?e.focus():t.key==="ArrowRight"&&!n?i.focus():t.key==="Home"||t.key==="ArrowRight"&&n?r.focus():(t.key==="End"||t.key==="ArrowLeft"&&l)&&s.focus(),t.preventDefault(),t.stopPropagation()}}selectionchange(){const t=this._editor.getSelectedEditable();t&&!this._editor.window.getSelection().isCollapsed&&this._editor.tags.allowed(t,"format",!0)?(this._editor.formats.hidden=!1,this._editor.formats.style.top=`${t.offsetTop+t.offsetParent.offsetTop-this._editor.formats.clientHeight}px`):(this._editor.formats.hidden=!0,this._editor.formats.removeAttribute("style"))}}const rt={de:{Alt:"Alt",Shift:"Umschalt"}};class d extends o{static get name(){return"base"}static get config(){return{browser:{},filter:{},lang:null,plugins:[]}}init(){this._i18n(rt),this._editor.registerElement("editor-dialog",Z),this._tag({name:"editor-root",group:"root",children:["audio","block","container","figure","heading","iframe","image","list","paragraph","preformat","quote","rule","table","video"]}),this._tag({name:"slot",group:"slot",editable:!0,focusable:!0,navigable:!0,sortable:!0}),new it(this._editor),new et(this._editor),new G(this._editor),new W(this._editor),new X(this._editor),new tt(this._editor),new V(this._editor),new J(this._editor),new Y(this._editor),this._editor.filters.add(new Q(this._editor))}}const st={de:{Abbreviation:"Abkürzung",Cancel:"Abbrechen","Full term":"Langform","Insert full term or leave empty to remove it":"Langform eingeben oder zum Entfernen leer lassen",Save:"Speichern"}};class nt extends o{static get name(){return"abbreviation"}static get dependencies(){return[d]}init(){this._i18n(st),this._tag({name:"abbr",group:"format",attributes:["title"]}),this._editor.dialogs.set(new K(this._editor)),this._command("abbr"),this._toolbar("Abbreviation","a",!0)}}class at extends f{constructor(t){super(t,"audio")}_initFieldset(t){t.appendChild(this._editor.createElement("legend",{html:this._("Audio")})),t.appendChild(this._createInput("src","text",this._("URL"),{pattern:"(https?|/).+",placeholder:this._("Insert URL to audio"),required:"required"}))}}class ot extends u{constructor(t){super(t);this._editor.root.addEventListener("sethtml",this),this._editor.root.addEventListener("insertaudio",this)}sethtml(t){Array.from(t.detail.element.getElementsByTagName("audio")).forEach(e=>this.__init(e))}insertaudio(t){this.__init(t.detail.element)}__init(t){const e=t.getAttribute("src");e?(t.setAttribute("src",this._editor.url(e)),t.controls=!0,this._editor.wrap(t,"figure",{attributes:{class:"audio"}})):t.parentElement.removeChild(t)}}class y extends f{constructor(t,e,i){super(t,e);if(this.__url=void 0,this.opts=Object.assign({alwaysRaised:"yes",dependent:"yes",height:`${this._editor.window.screen.height}`,location:"no",menubar:"no",minimizable:"no",modal:"yes",resizable:"yes",scrollbars:"yes",toolbar:"no",width:`${this._editor.window.screen.width}`},this._editor.config.base.browser),!i||typeof i!="string")throw"Invalid argument";this.__url=i}open(t,e={}){const i=Object.entries(this.opts).map(n=>`${n[0]}=${n[1]}`).join(","),r=this._editor.createElement("a",{attributes:{href:this.__url}}),s=new URL(r.href);Object.entries(e).forEach(([n,a])=>s.searchParams.set(n,`${a}`));const l=this._editor.window.open(s.toString(),this.name,i);this._editor.window.addEventListener("message",n=>{n.origin===s.origin&&n.source===l&&(t(n.data),l.close())},!1)}}class lt extends E{filter(t){t.querySelectorAll("figure > figcaption:only-child").forEach(e=>e.parentElement.removeChild(e))}}class dt extends u{constructor(t){super(t);this._editor.root.addEventListener("insertfigure",this)}insertfigure(t){t.detail.element.querySelector(":scope > figcaption")||t.detail.element.appendChild(this._editor.createElement("figcaption"))}}class w extends o{static get name(){return"figure"}static get dependencies(){return[d]}init(){this._tag({name:"figure",group:"figure",children:["audio","caption","iframe","image","preformat","quote","table","video"],attributes:["class"],alignable:!0,deletable:!0,focusable:!0,navigable:!0,sortable:!0}),this._tag({name:"figcaption",group:"caption",children:["format"],editable:!0,navigable:!0,enter:"p"}),new dt(this._editor),this._editor.filters.add(new lt(this._editor))}}const ct={de:{Audio:"Audio",Cancel:"Abbrechen","Insert URL to audio":"URL zur Audiodatei eingeben",Save:"Speichern",URL:"URL"}};class ht extends o{static get name(){return"audio"}static get dependencies(){return[d,w]}static get config(){return{browser:null}}init(){this._i18n(ct),this._tag({name:"audio",group:"audio",attributes:["controls","src"],empty:!0,navigable:!0}),new ot(this._editor),this._editor.config.audio.browser?this._editor.dialogs.set(new y(this._editor,"audio",this._editor.config.audio.browser)):this._editor.dialogs.set(new at(this._editor)),this._command("audio"),this._toolbar("Audio")}}class ut extends f{constructor(t){super(t,"block")}_initFieldset(t){t.appendChild(this._editor.createElement("legend",{html:this._("Block")})),t.appendChild(this._createInput("id","text",this._("ID"),{required:"required"}))}}class gt extends HTMLElement{constructor(){super();this.attachShadow({mode:"open"})}get content(){return this.shadowRoot.innerHTML}set content(t){this.shadowRoot.innerHTML=t}}class mt extends u{constructor(t){super(t);this._editor.root.addEventListener("sethtml",this),this._editor.root.addEventListener("inserteditorblock",this)}sethtml(t){Array.from(t.detail.element.getElementsByTagName("editor-block")).forEach(e=>e.id||e.parentElement.removeChild(e))}async inserteditorblock(t){if(t.detail.element.id){if(!this._editor.config.block.api)return}else{t.detail.element.parentElement.removeChild(t.detail.element);return}try{const e=await fetch(this._editor.config.block.api.replace("{id}",t.detail.element.id),{mode:"no-cors"});if(e.ok){let i="";this._editor.config.block.css&&(i=this._editor.config.block.css.split(",").map(s=>`<link rel="stylesheet" href="${s}">`).join(""));const r=await e.text();t.detail.element.content=i+r}}catch(e){this._editor.window.console.error(e)}}}const I={de:{Cancel:"Abbrechen",Height:"Höhe",Ifrane:"Iframe","Insert URL to embedded page":"URL zur eingebetteten Seite eingeben",Save:"Speichern",URL:"URL",Width:"Breite"}};class ft extends o{static get name(){return"block"}static get dependencies(){return[d]}static get config(){return{api:null,browser:null,css:null}}init(){this._i18n(I),this._editor.registerElement("editor-block",gt),this._tag({name:"editor-block",group:"block",attributes:["id"],deletable:!0,empty:!0,focusable:!0,navigable:!0,sortable:!0}),new mt(this._editor),this._editor.config.block.browser?this._editor.dialogs.set(new y(this._editor,"block",this._editor.config.block.browser)):this._editor.dialogs.set(new ut(this._editor)),this._command("editor-block"),this._toolbar("Block")}}class _t extends E{filter(t){t instanceof HTMLElement&&t.localName==="figure"&&t.classList.contains("quote")&&t.querySelector(":scope > blockquote")&&!t.querySelector(":scope > figcaption")&&(t.insertAdjacentElement("beforebegin",t.querySelector(":scope > blockquote")),t.innerHTML="")}}class pt extends u{constructor(t){super(t);this._editor.root.addEventListener("insertblockquote",this),this._editor.root.addEventListener("deleteblockquote",this)}insertblockquote(t){this._editor.wrap(t.detail.element,"figure",{attributes:{class:"quote"}})}deleteblockquote(t){t.detail.target.localName==="figure"&&t.detail.target.classList.contains("quote")&&t.detail.target.parentElement.removeChild(t.detail.target)}}class bt extends E{filter(t){if(t instanceof HTMLPreElement){t.outerHTML=t.outerHTML.replace(/(<br\s*\/?>)/gi,`
`);return}t.innerHTML=t.innerHTML.replace(/^\s*(<br\s*\/?>\s*)+/gi,"").replace(/\s*(<br\s*\/?>\s*)+$/gi,""),t instanceof HTMLParagraphElement?t.outerHTML=t.outerHTML.replace(/\s*(<br\s*\/?>\s*){2,}/gi,"</p><p>"):t.innerHTML=t.innerHTML.replace(/\s*(<br\s*\/?>\s*){2,}/gi,"<br>")}}class A extends o{static get name(){return"break"}static get dependencies(){return[d]}init(){this._tag({name:"br",group:"break",empty:!0}),this._editor.filters.add(new bt(this._editor))}}const Et={de:{"Block Quote":"Blockzitat"}};class wt extends o{static get name(){return"blockquote"}static get dependencies(){return[d,A,w]}init(){this._i18n(Et),this._tag({name:"blockquote",group:"quote",children:["break","format"],deletable:!0,editable:!0,navigable:!0,enter:"p"}),new pt(this._editor),this._command("blockquote"),this._toolbar("Block Quote"),this._editor.filters.add(new _t(this._editor))}}const Lt={de:{bold:"fett"}};class yt extends o{static get name(){return"bold"}static get dependencies(){return[d]}init(){this._i18n(Lt),this._tag({name:"b",group:"format"}),this._command("b"),this._toolbar("bold","b",!0)}}const At={de:{Citation:"Zitatquelle"}};class Ct extends o{static get name(){return"cite"}static get dependencies(){return[d]}init(){this._i18n(At),this._tag({name:"cite",group:"format"}),this._command("cite"),this._toolbar("Citation","z",!0)}}const xt={de:{Code:"Quelltext"}};class Tt extends o{static get name(){return"code"}static get dependencies(){return[d]}init(){this._i18n(xt),this._tag({name:"code",group:"format"}),this._command("code"),this._toolbar("Code","c",!0)}}class kt extends f{constructor(t){super(t,"data")}_initFieldset(t){t.appendChild(this._editor.createElement("legend",{html:this._("Data")})),t.appendChild(this._createInput("value","text",this._("Machine-readable Value"),{placeholder:this._("Insert value or leave empty to remove it")}))}}const vt={de:{Cancel:"Abbrechen",Data:"Data","Machine-readable Value":"Maschinenlesbarer Wert","Insert value or leave empty to remove it":"Wert eingeben oder zum Entfernen leer lassen",Save:"Speichern"}};class St extends o{static get name(){return"data"}static get dependencies(){return[d]}init(){this._i18n(vt),this._tag({name:"data",group:"format",attributes:["value"]}),this._editor.dialogs.set(new kt(this._editor)),this._command("data"),this._toolbar("Data","j",!0)}}const Ht={de:{Definition:"Definition"}};class Mt extends o{static get name(){return"definition"}static get dependencies(){return[d]}init(){this._i18n(Ht),this._tag({name:"dfn",group:"format"}),this._command("dfn"),this._toolbar("Definition","d",!0)}}const It={de:{"Text Deletion":"Textlöschung"}};class Dt extends o{static get name(){return"deletion"}static get dependencies(){return[d]}init(){this._i18n(It),this._tag({name:"del",group:"format"}),this._command("del"),this._toolbar("Text Deletion","g",!0)}}class Rt extends E{filter(t){t.querySelectorAll("summary:not(:first-child)").forEach(e=>e.parentElement.removeChild(e)),t.querySelectorAll("summary:only-child").forEach(e=>e.parentElement.removeChild(e))}}class qt extends u{constructor(t){super(t);this._editor.root.addEventListener("insertdetails",this),this._editor.root.addEventListener("insertsummary",this)}insertdetails(t){t.detail.element.open=!0,t.detail.element.querySelector(":scope > summary:first-child")||t.detail.element.insertAdjacentElement("afterbegin",this._editor.createElement("summary"))}insertsummary(t){this.__empty(t.detail.element),t.detail.element.addEventListener("blur",this),t.detail.element.addEventListener("keydown",this)}blur(t){this.__empty(t.target)}keydown(t){this._editor.isKey(t," ")?(t.preventDefault(),t.stopPropagation(),this._editor.insertText(" ")):this._editor.isKey(t,"Enter")&&(t.preventDefault(),t.stopPropagation(),t.target.parentElement.open=!0)}__empty(t){t.textContent.trim()?t.querySelectorAll("br:not(:last-child)").forEach(e=>e.parentElement.removeChild(e)):t.textContent=this._editor.translator.translate("details","Details"),t.lastElementChild instanceof HTMLBRElement||t.appendChild(this._editor.createElement("br"))}}const Nt={de:{Details:"Details"}};class Ut extends o{static get name(){return"details"}static get dependencies(){return[d]}init(){this._i18n(Nt),this._tag({name:"details",group:"container",children:["audio","figure","iframe","image","list","paragraph","preformat","quote","rule","summary","table","video"],arbitrary:!0,deletable:!0,focusable:!0,navigable:!0,slotable:!0,sortable:!0}),this._tag({name:"summary",group:"summary",editable:!0,navigable:!0,enter:"p"}),new qt(this._editor),this._command("details"),this._toolbar("Details"),this._editor.filters.add(new Rt(this._editor))}}class $t extends f{constructor(t){super(t,"division")}_initFieldset(t){t.appendChild(this._editor.createElement("legend",{html:this._("Division")})),t.appendChild(this._createInput("class","text",this._("CSS class"),{placeholder:this._("Insert CSS class")}))}}const Bt={de:{Cancel:"Abbrechen","CSS class":"CSS-Klasse",Division:"Division","Insert CSS class":"CSS-Klasse eingeben",Save:"Speichern"}};class Ft extends o{static get name(){return"division"}static get dependencies(){return[d]}init(){this._i18n(Bt),this._tag({name:"div",group:"container",children:["audio","block","figure","iframe","image","preformat","quote","rule","table","video"],attributes:["class"],arbitrary:!0,deletable:!0,focusable:!0,navigable:!0,slotable:!0,sortable:!0}),this._editor.dialogs.set(new $t(this._editor)),this._command("div"),this._toolbar("Division")}}const Pt={de:{emphasized:"betont"}};class jt extends o{static get name(){return"emphasis"}static get dependencies(){return[d]}init(){this._i18n(Pt),this._tag({name:"em",group:"format"}),this._command("em"),this._toolbar("emphasized","e",!0)}}const Ot={de:{Heading:"Überschrift"}};class zt extends o{static get name(){return"heading"}static get dependencies(){return[d]}init(){this._i18n(Ot),this._tag({name:"h2",group:"heading",deletable:!0,editable:!0,focusable:!0,navigable:!0,sortable:!0,enter:"p"}),this._command("h2"),this._toolbar("Heading")}}const Kt={de:{"Horizontal Rule":"Horizontale Linie"}};class Vt extends o{static get name(){return"horizontalrule"}static get dependencies(){return[d]}init(){this._i18n(Kt),this._tag({name:"hr",group:"rule",deletable:!0,empty:!0,focusable:!0,navigable:!0,sortable:!0}),this._command("hr"),this._toolbar("Horizontal Rule")}}class Qt extends f{constructor(t){super(t,"iframe")}_initFieldset(t){t.appendChild(this._editor.createElement("legend",{html:this._("Iframe")})),t.appendChild(this._createInput("src","text",this._("URL"),{pattern:"(https?|/).+",placeholder:this._("Insert URL to embedded page"),required:"required"})),t.appendChild(this._createInput("width","number",this._("Width"))),t.appendChild(this._createInput("height","number",this._("Height")))}}class Wt extends u{constructor(t){super(t);this._editor.root.addEventListener("sethtml",this),this._editor.root.addEventListener("insertiframe",this)}sethtml(t){Array.from(t.detail.element.getElementsByTagName("iframe")).forEach(e=>this.__init(e))}insertiframe(t){this.__init(t.detail.element)}__init(t){const e=t.getAttribute("src");e?(t.setAttribute("src",this._editor.url(e)),t.allowFullscreen=!0,this._editor.wrap(t,"figure",{attributes:{class:"iframe"}})):t.parentElement.removeChild(t)}}class Zt extends o{static get name(){return"iframe"}static get dependencies(){return[d,w]}static get config(){return{browser:null}}init(){this._i18n(I),this._tag({name:"iframe",group:"iframe",attributes:["allowfullscreen","height","src","width"],empty:!0,navigable:!0}),new Wt(this._editor),this._editor.config.iframe.browser?this._editor.dialogs.set(new y(this._editor,"iframe",this._editor.config.iframe.browser)):this._editor.dialogs.set(new Qt(this._editor)),this._command("iframe"),this._toolbar("Iframe")}}class Gt extends f{constructor(t){super(t,"image")}_initFieldset(t){t.appendChild(this._editor.createElement("legend",{html:this._("Image")})),t.appendChild(this._createInput("src","text",this._("URL"),{pattern:"(https?|/).+",placeholder:this._("Insert URL to image"),required:"required"})),t.appendChild(this._createInput("alt","text",this._("Alternative text"),{placeholder:this._("Replacement text for use when media elements are not available")})),t.appendChild(this._createInput("width","number",this._("Width"))),t.appendChild(this._createInput("height","number",this._("Height")))}}class Jt extends u{constructor(t){super(t);this._editor.root.addEventListener("sethtml",this),this._editor.root.addEventListener("insertimg",this)}sethtml(t){Array.from(t.detail.element.getElementsByTagName("img")).forEach(e=>this.__init(e))}insertimg(t){this.__init(t.detail.element)}__init(t){const e=t.getAttribute("src");e?(t.setAttribute("src",this._editor.url(e)),this._editor.wrap(t,"figure",{attributes:{class:"image"}})):t.parentElement.removeChild(t)}}const Xt={de:{"Alternative text":"Alternativtext",Cancel:"Abbrechen",Height:"Höhe",Image:"Bild","Insert URL to image":"URL zur Bilddatei eingeben","Replacement text for use when media elements are not available":"Ersatztext, falls Medienelemente nicht verfügbar sind",Save:"Speichern",URL:"URL",Width:"Breite"}};class Yt extends o{static get name(){return"image"}static get dependencies(){return[d,w]}static get config(){return{browser:null}}init(){this._i18n(Xt),this._tag({name:"img",group:"image",attributes:["alt","height","src","width"],empty:!0,navigable:!0}),new Jt(this._editor),this._editor.config.image.browser?this._editor.dialogs.set(new y(this._editor,"image",this._editor.config.image.browser)):this._editor.dialogs.set(new Gt(this._editor)),this._command("img"),this._toolbar("Image")}}const te={de:{"Text Insertion":"Texteinfügung"}};class ee extends o{static get name(){return"insertion"}static get dependencies(){return[d]}init(){this._i18n(te),this._tag({name:"ins",group:"format"}),this._command("ins"),this._toolbar("Text Insertion","f",!0)}}const ie={de:{italic:"kursiv"}};class re extends o{static get name(){return"italic"}static get dependencies(){return[d]}init(){this._i18n(ie),this._tag({name:"i",group:"format"}),this._command("i"),this._toolbar("italic","i",!0)}}const se={de:{"User Input":"Benutzereingabe"}};class ne extends o{static get name(){return"keyboard"}static get dependencies(){return[d]}init(){this._i18n(se),this._tag({name:"kbd",group:"format"}),this._command("kbd"),this._toolbar("User Input","k",!0)}}class ae extends f{constructor(t){super(t,"link")}_initFieldset(t){t.appendChild(this._editor.createElement("legend",{html:this._("Link")})),t.appendChild(this._createInput("href","text",this._("URL"),{pattern:"(https?|/|mailto:|tel:).+",placeholder:this._("Insert URL to add a link or leave empty to unlink")}))}}class oe extends u{constructor(t){super(t);this._editor.root.addEventListener("sethtml",this),this._editor.root.addEventListener("inserta",this)}sethtml(t){Array.from(t.detail.element.getElementsByTagName("a")).forEach(e=>this.__init(e))}inserta(t){this.__init(t.detail.element)}__init(t){const e=t.getAttribute("href");e?t.setAttribute("href",this._editor.url(e)):t.parentElement.replaceChild(this._editor.createText(t.textContent),t)}}const le={de:{Cancel:"Abbrechen","Insert URL to add a link or leave empty to unlink":"URL zum Verlinken eingeben oder zum Entfernen leer lassen",Link:"Link",Save:"Speichern",URL:"URL"}};class de extends o{static get name(){return"link"}static get dependencies(){return[d]}init(){this._i18n(le),this._tag({name:"a",group:"format",attributes:["href"]}),new oe(this._editor),this._editor.dialogs.set(new ae(this._editor)),this._command("a"),this._toolbar("Link","l",!0)}}const ce={de:{mark:"markiert"}};class he extends o{static get name(){return"mark"}static get dependencies(){return[d]}init(){this._i18n(ce),this._tag({name:"mark",group:"format"}),this._command("mark"),this._toolbar("mark","m",!0)}}class ue extends u{constructor(t){super(t);this._editor.root.addEventListener("sethtml",this),this._editor.root.addEventListener("insertli",this),this._editor.root.addEventListener("deleteli",this),this._editor.root.addEventListener("insertol",this),this._editor.root.addEventListener("insertul",this)}sethtml(t){Array.from(t.detail.element.getElementsByTagName("li")).forEach(e=>this.__init(e))}insertli(t){this.__init(t.detail.element)}deleteli(t){t.detail.target.children.length===0&&t.detail.target.parentElement.removeChild(t.detail.target)}insertol(t){t.detail.element.children.length===0&&t.detail.element.appendChild(this._editor.createElement("li"))}insertul(t){this.insertol(t)}__init(t){!(t.parentElement instanceof HTMLOListElement)&&!(t.parentElement instanceof HTMLUListElement)&&this._editor.wrap(t,"ul")}}class D extends o{static get name(){return"list"}static get dependencies(){return[d,A]}init(){this._tag({name:"li",group:"listitem",children:["break","format"],deletable:!0,editable:!0,focusable:!0,navigable:!0,sortable:!0,enter:"li"}),new ue(this._editor)}}const ge={de:{"Ordered List":"Geordnete Liste"}};class me extends o{static get name(){return"orderedlist"}static get dependencies(){return[d,D]}init(){this._i18n(ge),this._tag({name:"ol",group:"list",children:["listitem"],arbitrary:!0,deletable:!0,focusable:!0,navigable:!0,sortable:!0}),this._command("ol"),this._toolbar("Ordered List")}}class fe extends u{constructor(t){super(t);this._editor.root.addEventListener("sethtml",this),this._editor.root.addEventListener("insertp",this)}sethtml(t){Array.from(t.detail.element.getElementsByTagName("p")).forEach(e=>this.__init(e))}insertp(t){this.__init(t.detail.element)}__init(t){t.addEventListener("paste",this)}paste(t){this._editor.window.setTimeout(()=>this._editor.filters.filter(t.target))}}const _e={de:{Paragraph:"Absatz"}};class pe extends o{static get name(){return"paragraph"}static get dependencies(){return[d,A]}init(){this._i18n(_e),this._tag({name:"p",group:"paragraph",children:["break","format"],deletable:!0,editable:!0,focusable:!0,navigable:!0,sortable:!0,enter:"p"}),new fe(this._editor),this._command("p"),this._toolbar("Paragraph")}}class be extends E{filter(t){t instanceof HTMLElement&&t.localName==="figure"&&t.classList.contains("preformat")&&t.querySelector(":scope > pre")&&!t.querySelector(":scope > figcaption")&&(t.insertAdjacentElement("beforebegin",t.querySelector(":scope > pre")),t.innerHTML="")}}class Ee extends u{constructor(t){super(t);this._editor.root.addEventListener("insertpre",this),this._editor.root.addEventListener("deletepre",this)}insertpre(t){this._editor.wrap(t.detail.element,"figure",{attributes:{class:"preformat"}})}deletepre(t){t.detail.target.localName==="figure"&&t.detail.target.classList.contains("preformat")&&t.detail.target.parentElement.removeChild(t.detail.target)}}const we={de:{"Preformatted Text":"Vorformatierter Text"}};class Le extends o{static get name(){return"preformat"}static get dependencies(){return[d,A,w]}init(){this._i18n(we),this._tag({name:"pre",group:"preformat",children:["break"],deletable:!0,editable:!0,navigable:!0,enter:"p"}),new Ee(this._editor),this._command("pre"),this._toolbar("Preformatted Text"),this._editor.filters.add(new be(this._editor))}}const ye={de:{Quote:"Zitat"}};class Ae extends o{static get name(){return"quote"}static get dependencies(){return[d]}init(){this._i18n(ye),this._tag({name:"q",group:"format"}),this._command("q"),this._toolbar("Quote","q",!0)}}const Ce={de:{"Sample Output":"Beispielausgabe"}};class xe extends o{static get name(){return"sample"}static get dependencies(){return[d]}init(){this._i18n(Ce),this._tag({name:"samp",group:"format"}),this._command("samp"),this._toolbar("Sample Output","o",!0)}}class Te extends f{constructor(t){super(t,"section")}_initFieldset(t){t.appendChild(this._editor.createElement("legend",{html:this._("Section")})),t.appendChild(this._createInput("class","text",this._("CSS class"),{placeholder:this._("Insert CSS class")}))}}const ke={de:{Cancel:"Abbrechen","CSS class":"CSS-Klasse","Insert CSS class":"CSS-Klasse eingeben",Save:"Speichern",Section:"Sektion"}};class ve extends o{static get name(){return"section"}static get dependencies(){return[d]}init(){this._i18n(ke),this._tag({name:"section",group:"container",children:["audio","figure","heading","iframe","image","list","paragraph","preformat","quote","rule","table","video"],attributes:["class"],arbitrary:!0,deletable:!0,focusable:!0,navigable:!0,slotable:!0,sortable:!0}),this._editor.dialogs.set(new Te(this._editor)),this._command("section"),this._toolbar("Section")}}const Se={de:{small:"klein"}};class He extends o{static get name(){return"small"}static get dependencies(){return[d]}init(){this._i18n(Se),this._tag({name:"small",group:"format"}),this._command("small"),this._toolbar("small","w",!0)}}const Me={de:{strikethrough:"durchgestrichen"}};class Ie extends o{static get name(){return"strikethrough"}static get dependencies(){return[d]}init(){this._i18n(Me),this._tag({name:"s",group:"format"}),this._command("s"),this._toolbar("strikethrough","r",!0)}}const De={de:{"strongly emphasized":"stark betont"}};class Re extends o{static get name(){return"strong"}static get dependencies(){return[d]}init(){this._i18n(De),this._tag({name:"strong",group:"format"}),this._command("strong"),this._toolbar("strongly emphasized","s",!0)}}const qe={de:{Subheading:"Unterüberschrift"}};class Ne extends o{static get name(){return"subheading"}static get dependencies(){return[d]}init(){this._i18n(qe),this._tag({name:"h3",group:"heading",deletable:!0,editable:!0,focusable:!0,navigable:!0,sortable:!0,enter:"p"}),this._command("h3"),this._toolbar("Subheading")}}const Ue={de:{subscript:"tiefgestellt"}};class $e extends o{static get name(){return"subscript"}static get dependencies(){return[d]}init(){this._i18n(Ue),this._tag({name:"sub",group:"format"}),this._command("sub"),this._toolbar("subscript","x",!0)}}const Be={de:{superscript:"hochgestellt"}};class Fe extends o{static get name(){return"superscript"}static get dependencies(){return[d]}init(){this._i18n(Be),this._tag({name:"sup",group:"format"}),this._command("sup"),this._toolbar("superscript","y",!0)}}class Pe extends T{constructor(t){super(t,"table","table")}_insert({rows:t=1,cols:e=1}={}){t=t>1?t:1,e=e>1?e:1;const i=this._editor.createElement("figure",{attributes:{class:"table"}}),r=this._editor.createElement("table"),s=this._editor.createElement("tbody");for(let l=0;l<t;l++){const n=this._editor.createElement("tr");s.appendChild(n);for(let a=0;a<e;++a)n.appendChild(this._editor.createElement("td"))}r.appendChild(s),i.appendChild(r),this._editor.insert(i)}}class je extends f{constructor(t){super(t,"table")}_initFieldset(t){t.appendChild(this._editor.createElement("legend",{html:this._("Table")})),t.appendChild(this._createInput("rows","number",this._("Rows"),{min:"1",required:"required",value:"1"})),t.appendChild(this._createInput("cols","number",this._("Columns"),{min:"1",required:"required",value:"1"}))}}class Oe extends E{filter(t){t instanceof HTMLElement&&t.localName==="figure"&&t.classList.contains("table")&&t.querySelector(":scope > table")&&!t.querySelector(":scope > figcaption")?(t.insertAdjacentElement("beforebegin",t.querySelector(":scope > table")),t.innerHTML=""):(t instanceof HTMLTableElement&&t.querySelector(":scope > thead, :scope > tfoot")&&!t.querySelector(":scope > tbody")||(t instanceof HTMLTableSectionElement&&t.rows.length<=0||t instanceof HTMLTableRowElement&&!t.querySelector(":scope > th:not(:empty), :scope > td:not(:empty)")))&&(t.innerHTML="")}}class ze extends u{constructor(t){super(t);this._editor.root.addEventListener("inserttable",this),this._editor.root.addEventListener("inserttd",this),this._editor.root.addEventListener("insertth",this)}inserttable(t){this._editor.wrap(t.detail.element,"figure",{attributes:{class:"table"}}),t.detail.element.tBodies.length>0&&t.detail.element.tBodies[0].rows[0]&&(!t.detail.element.tHead||!t.detail.element.tFoot)&&(t.detail.element.tHead||this.__row(t.detail.element.createTHead(),t.detail.element.tBodies[0].rows[0].cells.length),t.detail.element.tFoot||this.__row(t.detail.element.createTFoot(),t.detail.element.tBodies[0].rows[0].cells.length))}inserttd(t){t.detail.element.addEventListener("keydown",this)}insertth(t){t.detail.element.addEventListener("keydown",this)}keydown(t){const e=t.target,i=e.parentElement,r=i.parentElement,s=r instanceof HTMLTableElement?r:r.parentElement,l=["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"],n=this._editor.isKey(t,l),a=this._editor.isKey(t,l,{ctrl:!0}),g=this._editor.isKey(t,l,{alt:!0}),_=this._editor.isKey(t,l,{alt:!0,shift:!0});if(e instanceof HTMLTableCellElement&&i instanceof HTMLTableRowElement&&(r instanceof HTMLTableElement||r instanceof HTMLTableSectionElement)&&s instanceof HTMLTableElement&&(n&&this.__enabled(e,t.key)||a||g||_)){const c=e.cellIndex,m=i.cells.length,b=r.rows.length,p=r instanceof HTMLTableElement?i.rowIndex:i.sectionRowIndex,C=c===0,x=c===m-1,R=p===0,q=p===b-1,v=i.rowIndex===0,S=i.rowIndex===s.rows.length-1;t.preventDefault(),t.stopPropagation(),n?t.key==="ArrowLeft"&&!C?this._editor.focusEnd(i.cells[c-1]):t.key==="ArrowLeft"&&v?this._editor.focusEnd(s.rows[s.rows.length-1].cells[m-1]):t.key==="ArrowLeft"?this._editor.focusEnd(s.rows[i.rowIndex-1].cells[m-1]):t.key==="ArrowRight"&&!x?i.cells[c+1].focus():t.key==="ArrowRight"&&S?s.rows[0].cells[0].focus():t.key==="ArrowRight"?s.rows[i.rowIndex+1].cells[0].focus():t.key==="ArrowUp"&&v?s.rows[s.rows.length-1].cells[c].focus():t.key==="ArrowUp"?s.rows[i.rowIndex-1].cells[c].focus():t.key==="ArrowDown"&&S?s.rows[0].cells[c].focus():t.key==="ArrowDown"&&s.rows[i.rowIndex+1].cells[c].focus():a?(t.key==="ArrowLeft"&&m>1&&C?Array.from(s.rows).forEach(h=>h.appendChild(h.cells[c])):t.key==="ArrowLeft"&&m>1?Array.from(s.rows).forEach(h=>h.insertBefore(h.cells[c],h.cells[c-1])):t.key==="ArrowRight"&&m>1&&x?Array.from(s.rows).forEach(h=>h.insertBefore(h.cells[c],h.cells[0])):t.key==="ArrowRight"&&m>1?Array.from(s.rows).forEach(h=>h.insertBefore(h.cells[c+1],h.cells[c])):t.key==="ArrowUp"&&b>1&&R?r.appendChild(i):t.key==="ArrowUp"&&b>1?r.insertBefore(i,r.rows[p-1]):t.key==="ArrowDown"&&b>1&&q?r.insertBefore(i,r.rows[0]):t.key==="ArrowDown"&&b>1&&r.insertBefore(r.rows[p+1],i),e.focus()):g?t.key==="ArrowLeft"?Array.from(s.rows).forEach(h=>this.__cell(h,h.cells[c])):t.key==="ArrowRight"?Array.from(s.rows).forEach(h=>this.__cell(h,h.cells[c+1])):t.key==="ArrowUp"?this.__row(r,m,p):t.key==="ArrowDown"&&this.__row(r,m,p+1):_&&(t.key==="ArrowLeft"&&!C?Array.from(s.rows).forEach(h=>h.deleteCell(c-1)):t.key==="ArrowRight"&&!x?Array.from(s.rows).forEach(h=>h.deleteCell(c+1)):t.key==="ArrowUp"&&p>0?r.deleteRow(p-1):t.key==="ArrowDown"&&p<b-1&&r.deleteRow(p+1))}}__row(t,e,i=0){const r=t.insertRow(i);for(let s=0;s<e;s++)this.__cell(r)}__cell(t,e=null){const i=t.parentElement.localName==="thead"?"th":"td";t.insertBefore(this._editor.createElement(i),e)}__enabled(t,e){if(["ArrowUp","ArrowDown"].includes(e))return!0;const i=this._editor.window.getSelection();if(!i.isCollapsed)return!1;if(e==="ArrowLeft"){const s=t.firstChild instanceof HTMLElement?t.firstChild.firstChild:t.firstChild;return i.anchorOffset===0&&[t,s].includes(i.anchorNode)}let r=t.lastChild;return t.lastChild instanceof HTMLBRElement&&t.lastChild.previousSibling&&(r=t.lastChild.previousSibling),r instanceof HTMLElement&&(r=r.lastChild),i.anchorOffset===i.anchorNode.textContent.length&&[t,r].includes(i.anchorNode)}}const Ke={de:{Cancel:"Abbrechen",Columns:"Spalten",Rows:"Zeilen",Save:"Speichern",Table:"Tabelle"}};class Ve extends o{static get name(){return"table"}static get dependencies(){return[d,A,w]}init(){this._i18n(Ke),this._tag({name:"table",group:"table",children:["tablesection"],deletable:!0,navigable:!0}),this._tag({name:"thead",group:"tablesection",children:["tablerow"]}),this._tag({name:"tbody",group:"tablesection",children:["tablerow"]}),this._tag({name:"tfoot",group:"tablesection",children:["tablerow"]}),this._tag({name:"tr",group:"tablerow",children:["tablecell"]}),this._tag({name:"th",group:"tablecell",children:["break","format"],editable:!0,empty:!0}),this._tag({name:"td",group:"tablecell",children:["break","format"],editable:!0,empty:!0}),new ze(this._editor),this._editor.filters.add(new Oe(this._editor)),this._editor.dialogs.set(new je(this._editor)),this._editor.commands.set(new Pe(this._editor)),this._toolbar("Table")}}class Qe extends f{constructor(t){super(t,"time")}_initFieldset(t){t.appendChild(this._editor.createElement("legend",{html:this._("Time")})),t.appendChild(this._createInput("datetime","text",this._("Machine-readable Datetime"),{placeholder:this._("Insert date and/or time or leave empty to remove it")}))}}const We={de:{Cancel:"Abbrechen","Machine-readable Datetime":"Maschinenlesbare Datums-/Zeitangabe","Insert date and/or time or leave empty to remove it":"Datum und/oder Zeit eingeben oder zum Entfernen leer lassen",Save:"Speichern",Time:"Zeit"}};class Ze extends o{static get name(){return"time"}static get dependencies(){return[d]}init(){this._i18n(We),this._tag({name:"time",group:"format",attributes:["datetime"]}),this._editor.dialogs.set(new Qe(this._editor)),this._command("time"),this._toolbar("Time","t",!0)}}const Ge={de:{underline:"unterstrichen"}};class Je extends o{static get name(){return"underline"}static get dependencies(){return[d]}init(){this._i18n(Ge),this._tag({name:"u",group:"format"}),this._command("u"),this._toolbar("underline","u",!0)}}const Xe={de:{"Unordered List":"Ungeordnete Liste"}};class Ye extends o{static get name(){return"unorderedlist"}static get dependencies(){return[d,D]}init(){this._i18n(Xe),this._tag({name:"ul",group:"list",children:["listitem"],arbitrary:!0,deletable:!0,focusable:!0,navigable:!0,sortable:!0}),this._command("ul"),this._toolbar("Unordered List")}}const ti={de:{Variable:"Variable"}};class ei extends o{static get name(){return"variable"}static get dependencies(){return[d]}init(){this._i18n(ti),this._tag({name:"var",group:"format"}),this._command("var"),this._toolbar("Variable","v",!0)}}class ii extends f{constructor(t){super(t,"video")}_initFieldset(t){t.appendChild(this._editor.createElement("legend",{html:this._("Video")})),t.appendChild(this._createInput("src","text",this._("URL"),{pattern:"(https?|/).+",placeholder:this._("Insert URL to video"),required:"required"})),t.appendChild(this._createInput("width","number",this._("Width"))),t.appendChild(this._createInput("height","number",this._("Height")))}}class ri extends u{constructor(t){super(t);this._editor.root.addEventListener("sethtml",this),this._editor.root.addEventListener("insertvideo",this)}sethtml(t){Array.from(t.detail.element.getElementsByTagName("video")).forEach(e=>this.__init(e))}insertvideo(t){this.__init(t.detail.element)}__init(t){const e=t.getAttribute("src");e?(t.setAttribute("src",this._editor.url(e)),t.controls=!0,this._editor.wrap(t,"figure",{attributes:{class:"video"}})):t.parentElement.removeChild(t)}}const si={de:{Cancel:"Abbrechen",Height:"Höhe","Insert URL to video":"URL zur Videodatei eingeben",Save:"Speichern",URL:"URL",Video:"Video",Width:"Breite"}};class ni extends o{static get name(){return"video"}static get dependencies(){return[d,w]}static get config(){return{browser:null}}init(){this._i18n(si),this._tag({name:"video",group:"video",attributes:["controls","height","src","width"],empty:!0,navigable:!0}),new ri(this._editor),this._editor.config.video.browser?this._editor.dialogs.set(new y(this._editor,"video",this._editor.config.video.browser)):this._editor.dialogs.set(new ii(this._editor)),this._command("video"),this._toolbar("Video")}}class ai extends L{static get defaultConfig(){return{base:{plugins:[yt,re,Re,jt,Je,Ie,de,he,He,Mt,nt,Ae,Ct,Tt,ne,xe,ei,$e,Fe,Ze,St,ee,Dt,pe,zt,Ne,Ye,me,Vt,wt,Yt,ni,ht,Zt,Ve,Le,ve,Ut,Ft,ft]}}}}export default ai;
